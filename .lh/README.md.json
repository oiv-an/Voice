{
    "sourceFile": "README.md",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1764477882792,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1764477882792,
            "name": "Commit-0",
            "content": "# VoiceCapture\r\n\r\nVoiceCapture is a small desktop utility for Windows that lets you dictate text into any application using a global hotkey. It records audio, sends it to a speech‑to‑text backend (Groq, OpenAI, or local model), optionally post‑processes the text with an LLM, copies the result to the clipboard, and pastes it into the active window.\r\n\r\nThe project is written in Python with PySide6 for the UI and is designed to be safe to publish on GitHub without leaking API keys.\r\n\r\n---\r\n\r\n## Features\r\n\r\n- Global hotkey to start/stop recording (default: `Ctrl + Win`)\r\n- Floating always‑on‑top window with compact mode\r\n- System tray icon with quick actions\r\n- Multiple recognition backends:\r\n  - Groq Whisper API\r\n  - OpenAI Whisper API (or any OpenAI‑compatible endpoint)\r\n  - Local ASR backend (currently GigaAM; Whisper via `faster-whisper` planned)\r\n- Text post‑processing:\r\n  - Regex cleanup\r\n  - Optional LLM correction via Groq / OpenAI\r\n- Clipboard integration:\r\n  - Copies recognized text\r\n  - Simulates `Ctrl+V` into the active window with retries\r\n- Configurable hotkeys and models via settings dialog\r\n- Log files with rotation for debugging and transcript history\r\n\r\n---\r\n\r\n## Architecture Overview\r\n\r\nHigh‑level components:\r\n\r\n- Core application:\r\n  - [`src/main.py`](src/main.py)\r\n  - [`App`](src/main.py:34) orchestrates recording, recognition, post‑processing, clipboard, UI, and hotkeys.\r\n- Configuration:\r\n  - [`AppSettings`](src/config/settings.py:121) loads YAML config into typed dataclasses.\r\n  - [`src/config/config.yaml`](src/config/config.yaml) is the default, **generic** config (no real keys).\r\n- Audio:\r\n  - [`AudioRecorder`](src/audio/recorder.py:21) records audio from the default input device using `sounddevice`.\r\n- Recognition backends:\r\n  - [`create_recognizer`](src/recogniction/__init__.py:1) (factory, chooses backend).\r\n  - [`GroqWhisperRecognizer`](src/recognition/groq_api.py:19) — Groq Whisper API.\r\n  - [`OpenAIWhisperRecognizer`](src/recognition/openai_api.py:19) — OpenAI / OpenAI‑compatible API.\r\n  - [`GigaAMRecognizer`](src/recognition/gigaam_local.py:12) — local ASR model (GigaAM).\r\n- Post‑processing:\r\n  - [`TextPostprocessor`](src/recognition/postprocessor.py:1) — regex cleanup + optional LLM correction.\r\n- Clipboard:\r\n  - [`ClipboardManager`](src/clipboard/clipboard_manager.py:1) — copy & paste with retries.\r\n- UI:\r\n  - [`FloatingWindow`](src/ui/floating_window.py:33) — main always‑on‑top window.\r\n  - [`SystemTrayIcon`](src/ui/system_tray.py:1) — tray icon and menu.\r\n  - [`SettingsDialog`](src/ui/settings_dialog.py:1) — configuration dialog.\r\n- Hotkeys:\r\n  - [`HotKeyManager`](src/hotkey/hotkey_manager.py:1) — global hotkeys via `pynput`.\r\n- Logging:\r\n  - [`setup_logging`](src/utils/logger.py:1) — loguru‑based logging with rotation.\r\n\r\nA more detailed module‑level description is planned for [`docs/ARCHITECTURE.md`](docs/ARCHITECTURE.md).\r\n\r\n---\r\n\r\n## Security and Configuration of API Keys\r\n\r\n### What is already implemented\r\n\r\n- Config is split into:\r\n  - `recognition.openai` (`OpenAIRecognitionConfig`)\r\n  - `recognition.groq` (`GroqRecognitionConfig`)\r\n- Post‑processing LLM keys are **reused** from recognition:\r\n  - In [`App.__init__`](src/main.py:41), `post_cfg.groq.api_key` and `post_cfg.openai.api_key` are filled from `recognition.groq.api_key` and `recognition.openai.api_key`.\r\n- `.gitignore` protects local configs and `.env` files:\r\n  - Ignored:\r\n    - `.env`, `.env.*`, `*.env`\r\n    - `config.local.yaml`, `config.local.yml`, `config.local.json`\r\n    - `*.local.yaml`, `*.local.yml`, `*.local.json`\r\n  - Comment in `.gitignore` explicitly states:\r\n    - Do **not** commit real keys in default config; keep `src/config/config.yaml` generic.\r\n- [`src/config/config.yaml`](src/config/config.yaml:1) is sanitized:\r\n  - Real keys have been removed and replaced with placeholders:\r\n\r\n    ```yaml\r\n    recognition:\r\n      backend: groq  # local, openai, groq\r\n      local:\r\n        model: large-v3\r\n        device: cuda\r\n        compute_type: float16\r\n        language: ru\r\n        beam_size: 5\r\n        temperature: 0.0\r\n      openai:\r\n        api_key: sk-...        # FILL LOCALLY in config.local.yaml or via UI\r\n        model: whisper-1\r\n        model_process: gpt-4\r\n        language: ru\r\n        base_url: https://api.openai.com/v1\r\n      groq:\r\n        api_key: gsk-...       # FILL LOCALLY in config.local.yaml or via UI\r\n        model: whisper-large-v3\r\n        model_process: mixtral-8x7b-32768\r\n        language: ru\r\n    ```\r\n\r\nThis means `config.yaml` is safe to commit to a public repository.\r\n\r\n### Recommended workflow with git and secrets\r\n\r\n1. **Never store real API keys in `src/config/config.yaml`.**\r\n2. For your own keys, use one of:\r\n   - `src/config/config.local.yaml` (preferred; ignored by git).\r\n   - Or enter keys via the settings UI; before committing, make sure to remove them from `config.yaml` if they were saved there.\r\n3. Recommended local config: `config.local.yaml`.\r\n\r\nExample `src/config/config.local.yaml` (do **not** commit):\r\n\r\n```yaml\r\nrecognition:\r\n  openai:\r\n    api_key: sk-YOUR_KEY\r\n    model: whisper-1\r\n    model_process: gpt-4o-mini\r\n    base_url: https://api.openai.com/v1\r\n\r\n  groq:\r\n    api_key: gsk_YOUR_KEY\r\n    model: whisper-large-v3\r\n    model_process: mixtral-8x7b-32768\r\n\r\npostprocess:\r\n  llm_backend: groq\r\n```\r\n\r\nPlanned improvement (not yet implemented):\r\n\r\n- [`AppSettings.load_default()`](src/config/settings.py:132) will be extended to:\r\n  - Load `config.yaml`.\r\n  - If present, load `config.local.yaml`.\r\n  - Merge `config.local.yaml` **over** `config.yaml` (local overrides default).\r\n\r\n### Optional: `.env` support\r\n\r\nNot implemented yet, but the codebase is ready to add `python-dotenv` and read keys from environment variables such as:\r\n\r\n- `GROQ_API_KEY`\r\n- `OPENAI_API_KEY`\r\n\r\nThis would be an additional option for secret management.\r\n\r\n---\r\n\r\n## Installation\r\n\r\n### 1. Clone and create virtual environment\r\n\r\n```bash\r\ngit clone <your-repo-url>\r\ncd Voice\r\n\r\npython -m venv .venv\r\n.venv\\Scripts\\activate\r\n\r\npip install -r requirements.txt\r\n```\r\n\r\nThe project targets Windows 11 and uses the default system microphone.\r\n\r\n---\r\n\r\n## Configuration\r\n\r\n### 1. Base config\r\n\r\nThe base config lives in [`src/config/config.yaml`](src/config/config.yaml:1). It contains **no real keys** and can be safely committed.\r\n\r\nKey sections:\r\n\r\n- `recognition.backend`: `local` | `openai` | `groq`\r\n- `recognition.local`: parameters for the local ASR backend (currently GigaAM).\r\n- `recognition.openai`: OpenAI / OpenAI‑compatible endpoint.\r\n- `recognition.groq`: Groq Whisper API.\r\n- `postprocess`: LLM backend and models for text correction.\r\n- `audio`: sample rate, channels, max duration.\r\n- `ui`: window size, opacity, compact mode.\r\n- `hotkeys`: global hotkey combinations.\r\n\r\n### 2. Local overrides: `config.local.yaml`\r\n\r\nFor your own keys and machine‑specific settings, create:\r\n\r\n```text\r\nsrc/config/config.local.yaml\r\n```\r\n\r\nThis file is ignored by `.gitignore` and should **never** be committed.\r\n\r\nExample:\r\n\r\n```yaml\r\nrecognition:\r\n  backend: groq  # or openai or local\r\n\r\n  groq:\r\n    api_key: gsk_YOUR_KEY\r\n    model: whisper-large-v3\r\n    model_process: mixtral-8x7b-32768\r\n\r\n  openai:\r\n    api_key: sk_YOUR_KEY\r\n    model: whisper-1\r\n    model_process: gpt-4o-mini\r\n    base_url: https://api.openai.com/v1\r\n\r\npostprocess:\r\n  llm_backend: groq\r\n```\r\n\r\nPlanned behavior:\r\n\r\n- `config.yaml` provides defaults.\r\n- `config.local.yaml` overrides any subset of fields (keys, models, language, etc.).\r\n\r\n### 3. Configure via UI\r\n\r\nAlternatively, you can:\r\n\r\n1. Run the app.\r\n2. Open the settings dialog (⚙️ icon / double‑click on the floating window / tray menu).\r\n3. Enter:\r\n   - Recognition backend (`local`, `openai`, `groq`).\r\n   - API keys for Groq / OpenAI.\r\n   - Models and language.\r\n   - Hotkeys.\r\n\r\nBefore committing, ensure that `config.yaml` does not contain real keys if the UI saved them there.\r\n\r\n---\r\n\r\n## Running the Application\r\n\r\nFrom the project root:\r\n\r\n```bash\r\n.venv\\Scripts\\activate\r\npython src/main.py\r\n```\r\n\r\nAfter startup:\r\n\r\n- A system tray icon appears.\r\n- A small floating window is shown, always on top.\r\n- Default hotkeys (can be changed in settings):\r\n\r\n  - `Ctrl + Win` — hold to record, release to stop.\r\n  - `Esc` — cancel recording.\r\n  - `Ctrl + Alt + S` — show/hide window.\r\n  - `Ctrl + Alt + D` — toggle debug mode (partially implemented).\r\n\r\nWorkflow:\r\n\r\n1. Focus any text field (editor, browser, messenger, etc.).\r\n2. Hold `Ctrl + Win` and speak.\r\n3. Release the keys.\r\n4. The app:\r\n   - Records audio.\r\n   - Sends it to the selected recognition backend.\r\n   - Optionally post‑processes the text with an LLM.\r\n   - Copies the final text to the clipboard.\r\n   - Simulates `Ctrl+V` into the active window.\r\n\r\n---\r\n\r\n## Git Usage and Safety Checklist\r\n\r\nTo keep your repository clean and free of secrets:\r\n\r\n1. Initialize git (if not already):\r\n\r\n   ```bash\r\n   git init\r\n   git add .\r\n   git commit -m \"Initial VoiceCapture MVP\"\r\n   ```\r\n\r\n2. Before pushing to GitHub:\r\n\r\n   - Ensure `src/config/config.yaml` contains **no real keys**.\r\n   - Ensure no local config files are staged:\r\n\r\n     ```bash\r\n     git status\r\n     git restore --staged src/config/config.local.yaml  # if it was accidentally added\r\n     ```\r\n\r\n3. Add remote and push:\r\n\r\n   ```bash\r\n   git remote add origin git@github.com:YOUR_USER/VoiceCapture.git\r\n   git push -u origin main\r\n   ```\r\n\r\n---\r\n\r\n## Roadmap / Missing Pieces vs Original Spec\r\n\r\nThe current MVP implements the full basic workflow, but some items from the original specification are still planned:\r\n\r\n- Config and secrets:\r\n  - [ ] Merge `config.local.yaml` over `config.yaml` in [`AppSettings.load_default()`](src/config/settings.py:132).\r\n  - [ ] Optional `.env` support via `python-dotenv`.\r\n- Local Whisper:\r\n  - [ ] Add [`whisper_local.py`](src/recognition/whisper_local.py:1) using `faster-whisper`.\r\n  - [ ] Allow choosing between GigaAM and Whisper in config/UI.\r\n  - [ ] Add [`gpu_check.py`](src/utils/gpu_check.py:1) to detect CUDA / GPU info.\r\n- Audio / VAD:\r\n  - [ ] Add [`vad.py`](src/audio/vad.py:1) with simple VAD (RMS/energy).\r\n  - [ ] Auto‑stop recording on silence > 1.5s.\r\n- UI / UX:\r\n  - [ ] Refine tray behavior (close to tray vs full exit).\r\n  - [ ] Add sounds for start/stop/error (e.g. `assets/sounds/*.wav`).\r\n- Debug:\r\n  - [ ] Implement full debug mode in [`App.toggle_debug_mode`](src/main.py:332) (log level switch, optional debug panel).\r\n- Tests:\r\n  - [ ] Unit tests for audio recorder, local recognizer, clipboard, config.\r\n  - [ ] Integration tests for end‑to‑end workflow.\r\n\r\n---\r\n\r\n## Development Notes\r\n\r\n- Logging:\r\n  - [`setup_logging`](src/utils/logger.py:1) configures loguru with rotation.\r\n  - Transcripts are additionally logged to `logs/transcripts.log` with size‑based rotation.\r\n- Manual LLM test:\r\n  - [`tests/manual_llm_test.py`](tests/manual_llm_test.py:1) can be used to manually verify LLM post‑processing with your keys.\r\n\r\n---\r\n\r\n## License\r\n\r\nAdd your preferred license here (e.g. MIT, Apache‑2.0). Until then, the project is effectively “all rights reserved” by default."
        }
    ]
}