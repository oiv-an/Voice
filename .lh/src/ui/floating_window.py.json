{
    "sourceFile": "src/ui/floating_window.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 41,
            "patches": [
                {
                    "date": 1764289541744,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764292031553,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -56,11 +56,16 @@\n         self.menu_button = QPushButton(\"≡\")\r\n         self.menu_button.setFixedSize(24, 24)\r\n         self.menu_button.clicked.connect(self._on_menu_clicked)\r\n \r\n+        self.close_button = QPushButton(\"×\")\r\n+        self.close_button.setFixedSize(24, 24)\r\n+        self.close_button.clicked.connect(self._on_close_clicked)\r\n+\r\n         top_layout = QHBoxLayout()\r\n         top_layout.addWidget(self.menu_button)\r\n         top_layout.addStretch()\r\n+        top_layout.addWidget(self.close_button)\r\n \r\n         main_layout = QVBoxLayout()\r\n         main_layout.setContentsMargins(6, 6, 6, 6)\r\n         main_layout.addLayout(top_layout)\r\n"
                },
                {
                    "date": 1764292302126,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -147,8 +147,12 @@\n     def _on_menu_clicked(self) -> None:\r\n         # For MVP: simple behavior - open settings on click\r\n         self.settings_requested.emit()\r\n \r\n+    def _on_close_clicked(self) -> None:\r\n+        # Кнопка закрытия: сигнал наверх (App решает — выйти или скрыть окно)\r\n+        self.exit_requested.emit()\r\n+\r\n     def mousePressEvent(self, event: QMouseEvent) -> None:\r\n         if event.button() == Qt.MouseButton.LeftButton:\r\n             self._drag_position = event.globalPosition().toPoint() - self.frameGeometry().topLeft()\r\n             event.accept()\r\n"
                },
                {
                    "date": 1764293898789,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -86,9 +86,9 @@\n     def _apply_styles(self) -> None:\r\n         self.setStyleSheet(\r\n             \"\"\"\r\n             QWidget#container {\r\n-                background-color: rgba(30, 30, 30, 220);\r\n+                background-color: rgba(30, 30, 30, 230);\r\n                 border-radius: 10px;\r\n             }\r\n             QLabel {\r\n                 color: white;\r\n@@ -97,47 +97,94 @@\n             QPushButton {\r\n                 background: transparent;\r\n                 color: white;\r\n                 border: none;\r\n-                font-size: 12pt;\r\n+                font-size: 11pt;\r\n             }\r\n             QPushButton:hover {\r\n                 color: #00bcd4;\r\n             }\r\n             \"\"\"\r\n         )\r\n \r\n+    def _load_icons(self) -> None:\r\n+        \"\"\"Загружаем иконки микрофона, если они есть в assets/icons.\"\"\"\r\n+        icons_dir = Path(\"assets/icons\")\r\n+        idle_path = icons_dir / \"mic_idle.png\"\r\n+        rec_path = icons_dir / \"mic_recording.png\"\r\n+        proc_path = icons_dir / \"mic_processing.png\"\r\n+\r\n+        if idle_path.exists():\r\n+            self._icon_idle = QPixmap(str(idle_path))\r\n+        if rec_path.exists():\r\n+            self._icon_recording = QPixmap(str(rec_path))\r\n+        if proc_path.exists():\r\n+            self._icon_processing = QPixmap(str(proc_path))\r\n+\r\n+        app_icon_path = icons_dir / \"app_icon.ico\"\r\n+        if app_icon_path.exists():\r\n+            self.setWindowIcon(QIcon(str(app_icon_path)))\r\n+\r\n     def _apply_config(self) -> None:\r\n         w, h = self._ui_config.window_size\r\n-        self.setFixedSize(w, h)\r\n+        self.resize(w, h)\r\n         self.setWindowOpacity(self._ui_config.opacity)\r\n         if self._ui_config.always_on_top:\r\n             self.setWindowFlag(Qt.WindowType.WindowStaysOnTopHint, True)\r\n \r\n-        # Set default icon if exists\r\n-        icon_path = Path(\"assets/icons/app_icon.ico\")\r\n-        if icon_path.exists():\r\n-            self.setWindowIcon(QIcon(str(icon_path)))\r\n+    # ------------------------------------------------------------------ state / mode\r\n \r\n-    # ------------------------------------------------------------------ state\r\n-\r\n     def set_state(self, state: str) -> None:\r\n         self._state = state\r\n+\r\n+        # текст статуса\r\n         if state == \"idle\":\r\n-            self.status_label.setText(\"Idle\")\r\n+            self.status_label.setText(\"Готово\")\r\n         elif state == \"recording\":\r\n-            self.status_label.setText(\"Recording...\")\r\n+            self.status_label.setText(\"Запись...\")\r\n         elif state == \"processing\":\r\n-            self.status_label.setText(\"Processing...\")\r\n+            self.status_label.setText(\"Обработка...\")\r\n         elif state == \"ready\":\r\n-            self.status_label.setText(\"Done\")\r\n-            # auto fade back to idle after short delay\r\n+            self.status_label.setText(\"Готово\")\r\n             QTimer.singleShot(1000, lambda: self.set_state(\"idle\"))\r\n         elif state == \"error\":\r\n-            self.status_label.setText(\"Error\")\r\n+            self.status_label.setText(\"Ошибка\")\r\n         else:\r\n             self.status_label.setText(state)\r\n \r\n+        # иконка микрофона\r\n+        if state == \"recording\" and self._icon_recording:\r\n+            self.icon_label.setPixmap(self._icon_recording)\r\n+        elif state == \"processing\" and self._icon_processing:\r\n+            self.icon_label.setPixmap(self._icon_processing)\r\n+        elif self._icon_idle:\r\n+            self.icon_label.setPixmap(self._icon_idle)\r\n+\r\n+        # в компактном режиме текст можно скрывать\r\n+        self._apply_compact_mode()\r\n+\r\n+    def set_compact(self, compact: bool) -> None:\r\n+        \"\"\"Переключение между большим окном и компактным микрофоном.\"\"\"\r\n+        self._compact = compact\r\n+        self._apply_compact_mode()\r\n+\r\n+    def _apply_compact_mode(self) -> None:\r\n+        if self._compact:\r\n+            # компактный режим: маленькое окно, только иконка\r\n+            self.status_label.setVisible(False)\r\n+            self.menu_button.setVisible(False)\r\n+            self.close_button.setVisible(False)\r\n+            self.compact_button.setText(\"▣\")  # кнопка развернуть\r\n+            self.setFixedSize(64, 64)\r\n+        else:\r\n+            # нормальный режим: всё видно\r\n+            self.status_label.setVisible(True)\r\n+            self.menu_button.setVisible(True)\r\n+            self.close_button.setVisible(True)\r\n+            self.compact_button.setText(\"▢\")  # кнопка свернуть\r\n+            w, h = self._ui_config.window_size\r\n+            self.setFixedSize(w, h)\r\n+\r\n     def show_message(self, text: str, timeout_ms: int = 2000) -> None:\r\n         self.status_label.setText(text)\r\n         if timeout_ms > 0:\r\n             QTimer.singleShot(timeout_ms, lambda: self.set_state(self._state))\r\n"
                },
                {
                    "date": 1764293983488,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,19 +3,23 @@\n from pathlib import Path\r\n from typing import Optional\r\n \r\n from PyQt6.QtCore import QPoint, Qt, QTimer, pyqtSignal\r\n-from PyQt6.QtGui import QIcon, QMouseEvent\r\n+from PyQt6.QtGui import QIcon, QMouseEvent, QPixmap\r\n from PyQt6.QtWidgets import QLabel, QHBoxLayout, QVBoxLayout, QWidget, QPushButton\r\n \r\n from config.settings import UIConfig\r\n \r\n \r\n class FloatingWindow(QWidget):\r\n     \"\"\"\r\n-    Minimal floating window for MVP.\r\n+    Главное плавающее окно VoiceCapture.\r\n \r\n-    States:\r\n+    Режимы:\r\n+        - normal  — большое окно с текстом и кнопками\r\n+        - compact — маленький \"висячий микрофон\"\r\n+\r\n+    Состояния:\r\n         - idle\r\n         - recording\r\n         - processing\r\n         - ready\r\n@@ -23,19 +27,28 @@\n     \"\"\"\r\n \r\n     settings_requested = pyqtSignal()\r\n     exit_requested = pyqtSignal()\r\n+    toggle_compact_requested = pyqtSignal()\r\n \r\n     def __init__(self, ui_config: UIConfig) -> None:\r\n         super().__init__()\r\n \r\n         self._ui_config = ui_config\r\n         self._drag_position: Optional[QPoint] = None\r\n         self._state: str = \"idle\"\r\n+        self._compact: bool = False\r\n \r\n+        # иконки микрофона\r\n+        self._icon_idle: Optional[QPixmap] = None\r\n+        self._icon_recording: Optional[QPixmap] = None\r\n+        self._icon_processing: Optional[QPixmap] = None\r\n+\r\n         self._init_window_flags()\r\n         self._init_ui()\r\n+        self._load_icons()\r\n         self._apply_config()\r\n+        self.set_state(\"idle\")\r\n \r\n     # ------------------------------------------------------------------ setup\r\n \r\n     def _init_window_flags(self) -> None:\r\n@@ -46,25 +59,35 @@\n         )\r\n         self.setAttribute(Qt.WidgetAttribute.WA_TranslucentBackground, True)\r\n \r\n     def _init_ui(self) -> None:\r\n+        # иконка микрофона\r\n         self.icon_label = QLabel()\r\n         self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n \r\n+        # текст статуса\r\n         self.status_label = QLabel(\"\")\r\n         self.status_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n \r\n-        self.menu_button = QPushButton(\"≡\")\r\n+        # кнопка настроек\r\n+        self.menu_button = QPushButton(\"⚙\")\r\n         self.menu_button.setFixedSize(24, 24)\r\n         self.menu_button.clicked.connect(self._on_menu_clicked)\r\n \r\n+        # кнопка свернуть/развернуть (compact/normal)\r\n+        self.compact_button = QPushButton(\"▢\")\r\n+        self.compact_button.setFixedSize(24, 24)\r\n+        self.compact_button.clicked.connect(self._on_compact_clicked)\r\n+\r\n+        # кнопка закрытия\r\n         self.close_button = QPushButton(\"×\")\r\n         self.close_button.setFixedSize(24, 24)\r\n         self.close_button.clicked.connect(self._on_close_clicked)\r\n \r\n         top_layout = QHBoxLayout()\r\n         top_layout.addWidget(self.menu_button)\r\n         top_layout.addStretch()\r\n+        top_layout.addWidget(self.compact_button)\r\n         top_layout.addWidget(self.close_button)\r\n \r\n         main_layout = QVBoxLayout()\r\n         main_layout.setContentsMargins(6, 6, 6, 6)\r\n@@ -80,9 +103,8 @@\n         root_layout.setContentsMargins(0, 0, 0, 0)\r\n         root_layout.addWidget(container)\r\n \r\n         self._apply_styles()\r\n-        self.set_state(\"idle\")\r\n \r\n     def _apply_styles(self) -> None:\r\n         self.setStyleSheet(\r\n             \"\"\"\r\n@@ -158,9 +180,9 @@\n             self.icon_label.setPixmap(self._icon_processing)\r\n         elif self._icon_idle:\r\n             self.icon_label.setPixmap(self._icon_idle)\r\n \r\n-        # в компактном режиме текст можно скрывать\r\n+        # применяем текущий режим (compact/normal)\r\n         self._apply_compact_mode()\r\n \r\n     def set_compact(self, compact: bool) -> None:\r\n         \"\"\"Переключение между большим окном и компактным микрофоном.\"\"\"\r\n@@ -191,11 +213,16 @@\n \r\n     # ------------------------------------------------------------------ events\r\n \r\n     def _on_menu_clicked(self) -> None:\r\n-        # For MVP: simple behavior - open settings on click\r\n+        # Открыть окно настроек\r\n         self.settings_requested.emit()\r\n \r\n+    def _on_compact_clicked(self) -> None:\r\n+        # Переключить режим окна\r\n+        self.set_compact(not self._compact)\r\n+        self.toggle_compact_requested.emit()\r\n+\r\n     def _on_close_clicked(self) -> None:\r\n         # Кнопка закрытия: сигнал наверх (App решает — выйти или скрыть окно)\r\n         self.exit_requested.emit()\r\n \r\n@@ -216,6 +243,7 @@\n         super().mouseReleaseEvent(event)\r\n \r\n     def mouseDoubleClickEvent(self, event: QMouseEvent) -> None:\r\n         if event.button() == Qt.MouseButton.LeftButton:\r\n+            # двойной клик тоже открывает настройки\r\n             self.settings_requested.emit()\r\n         super().mouseDoubleClickEvent(event)\n\\ No newline at end of file\n"
                },
                {
                    "date": 1764294091366,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,8 +63,13 @@\n         # иконка микрофона\r\n         self.icon_label = QLabel()\r\n         self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n \r\n+        # текст распознанного результата\r\n+        self.result_label = QLabel(\"\")\r\n+        self.result_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n+        self.result_label.setWordWrap(True)\r\n+\r\n         # текст статуса\r\n         self.status_label = QLabel(\"\")\r\n         self.status_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n \r\n@@ -92,8 +97,9 @@\n         main_layout = QVBoxLayout()\r\n         main_layout.setContentsMargins(6, 6, 6, 6)\r\n         main_layout.addLayout(top_layout)\r\n         main_layout.addWidget(self.icon_label, alignment=Qt.AlignmentFlag.AlignCenter)\r\n+        main_layout.addWidget(self.result_label)\r\n         main_layout.addWidget(self.status_label)\r\n \r\n         container = QWidget()\r\n         container.setLayout(main_layout)\r\n@@ -162,8 +168,10 @@\n         if state == \"idle\":\r\n             self.status_label.setText(\"Готово\")\r\n         elif state == \"recording\":\r\n             self.status_label.setText(\"Запись...\")\r\n+            # во время записи очищаем предыдущий результат\r\n+            self.result_label.setText(\"\")\r\n         elif state == \"processing\":\r\n             self.status_label.setText(\"Обработка...\")\r\n         elif state == \"ready\":\r\n             self.status_label.setText(\"Готово\")\r\n@@ -192,15 +200,17 @@\n     def _apply_compact_mode(self) -> None:\r\n         if self._compact:\r\n             # компактный режим: маленькое окно, только иконка\r\n             self.status_label.setVisible(False)\r\n+            self.result_label.setVisible(False)\r\n             self.menu_button.setVisible(False)\r\n             self.close_button.setVisible(False)\r\n             self.compact_button.setText(\"▣\")  # кнопка развернуть\r\n             self.setFixedSize(64, 64)\r\n         else:\r\n             # нормальный режим: всё видно\r\n             self.status_label.setVisible(True)\r\n+            self.result_label.setVisible(True)\r\n             self.menu_button.setVisible(True)\r\n             self.close_button.setVisible(True)\r\n             self.compact_button.setText(\"▢\")  # кнопка свернуть\r\n             w, h = self._ui_config.window_size\r\n"
                },
                {
                    "date": 1764295307243,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -62,9 +62,17 @@\n     def _init_ui(self) -> None:\r\n         # иконка микрофона\r\n         self.icon_label = QLabel()\r\n         self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n+        # по умолчанию показываем системную иконку, чтобы не было \"пустого\" места\r\n+        from PyQt6.QtWidgets import QApplication, QStyle\r\n \r\n+        app = QApplication.instance()\r\n+        if app is not None and app.style() is not None:\r\n+            sys_icon = app.style().standardIcon(QStyle.StandardPixmap.SP_MediaVolume)\r\n+            if not sys_icon.isNull():\r\n+                self.icon_label.setPixmap(sys_icon.pixmap(32, 32))\r\n+\r\n         # текст распознанного результата\r\n         self.result_label = QLabel(\"\")\r\n         self.result_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n         self.result_label.setWordWrap(True)\r\n@@ -187,9 +195,18 @@\n         elif state == \"processing\" and self._icon_processing:\r\n             self.icon_label.setPixmap(self._icon_processing)\r\n         elif self._icon_idle:\r\n             self.icon_label.setPixmap(self._icon_idle)\r\n+        else:\r\n+            # если PNG-иконок нет, используем системную иконку, чтобы всегда что-то было\r\n+            from PyQt6.QtWidgets import QApplication, QStyle\r\n \r\n+            app = QApplication.instance()\r\n+            if app is not None and app.style() is not None:\r\n+                sys_icon = app.style().standardIcon(QStyle.StandardPixmap.SP_MediaVolume)\r\n+                if not sys_icon.isNull():\r\n+                    self.icon_label.setPixmap(sys_icon.pixmap(32, 32))\r\n+\r\n         # применяем текущий режим (compact/normal)\r\n         self._apply_compact_mode()\r\n \r\n     def set_compact(self, compact: bool) -> None:\r\n"
                },
                {
                    "date": 1764295530537,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -62,17 +62,10 @@\n     def _init_ui(self) -> None:\r\n         # иконка микрофона\r\n         self.icon_label = QLabel()\r\n         self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n-        # по умолчанию показываем системную иконку, чтобы не было \"пустого\" места\r\n-        from PyQt6.QtWidgets import QApplication, QStyle\r\n+        # по умолчанию НИЧЕГО не показываем — иконка появляется только при смене состояния\r\n \r\n-        app = QApplication.instance()\r\n-        if app is not None and app.style() is not None:\r\n-            sys_icon = app.style().standardIcon(QStyle.StandardPixmap.SP_MediaVolume)\r\n-            if not sys_icon.isNull():\r\n-                self.icon_label.setPixmap(sys_icon.pixmap(32, 32))\r\n-\r\n         # текст распознанного результата\r\n         self.result_label = QLabel(\"\")\r\n         self.result_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n         self.result_label.setWordWrap(True)\r\n@@ -189,24 +182,22 @@\n         else:\r\n             self.status_label.setText(state)\r\n \r\n         # иконка микрофона\r\n+        # Логика:\r\n+        #   idle       -> серый микрофон (если есть PNG), иначе пусто\r\n+        #   recording  -> КРАСНЫЙ микрофон (если есть PNG), иначе пусто\r\n+        #   processing -> можно использовать \"processing\" PNG, если добавим\r\n         if state == \"recording\" and self._icon_recording:\r\n             self.icon_label.setPixmap(self._icon_recording)\r\n         elif state == \"processing\" and self._icon_processing:\r\n             self.icon_label.setPixmap(self._icon_processing)\r\n         elif self._icon_idle:\r\n             self.icon_label.setPixmap(self._icon_idle)\r\n         else:\r\n-            # если PNG-иконок нет, используем системную иконку, чтобы всегда что-то было\r\n-            from PyQt6.QtWidgets import QApplication, QStyle\r\n+            # если PNG-иконок нет — не показываем ничего, чтобы центр не был занят динамиком\r\n+            self.icon_label.clear()\r\n \r\n-            app = QApplication.instance()\r\n-            if app is not None and app.style() is not None:\r\n-                sys_icon = app.style().standardIcon(QStyle.StandardPixmap.SP_MediaVolume)\r\n-                if not sys_icon.isNull():\r\n-                    self.icon_label.setPixmap(sys_icon.pixmap(32, 32))\r\n-\r\n         # применяем текущий режим (compact/normal)\r\n         self._apply_compact_mode()\r\n \r\n     def set_compact(self, compact: bool) -> None:\r\n"
                },
                {
                    "date": 1764295678039,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,279 @@\n+from __future__ import annotations\r\n+\r\n+from pathlib import Path\r\n+from typing import Optional\r\n+\r\n+from PyQt6.QtCore import QPoint, Qt, QTimer, pyqtSignal\r\n+from PyQt6.QtGui import QIcon, QMouseEvent, QPixmap\r\n+from PyQt6.QtWidgets import QLabel, QHBoxLayout, QVBoxLayout, QWidget, QPushButton\r\n+\r\n+from config.settings import UIConfig\r\n+\r\n+\r\n+class FloatingWindow(QWidget):\r\n+    \"\"\"\r\n+    Главное плавающее окно VoiceCapture.\r\n+\r\n+    Режимы:\r\n+        - normal  — большое окно с текстом и кнопками\r\n+        - compact — маленький \"висячий микрофон\"\r\n+\r\n+    Состояния:\r\n+        - idle\r\n+        - recording\r\n+        - processing\r\n+        - ready\r\n+        - error\r\n+    \"\"\"\r\n+\r\n+    settings_requested = pyqtSignal()\r\n+    exit_requested = pyqtSignal()\r\n+    toggle_compact_requested = pyqtSignal()\r\n+\r\n+    def __init__(self, ui_config: UIConfig) -> None:\r\n+        super().__init__()\r\n+\r\n+        self._ui_config = ui_config\r\n+        self._drag_position: Optional[QPoint] = None\r\n+        self._state: str = \"idle\"\r\n+        self._compact: bool = False\r\n+\r\n+        # иконки микрофона\r\n+        self._icon_idle: Optional[QPixmap] = None\r\n+        self._icon_recording: Optional[QPixmap] = None\r\n+        self._icon_processing: Optional[QPixmap] = None\r\n+\r\n+        self._init_window_flags()\r\n+        self._init_ui()\r\n+        self._load_icons()\r\n+        self._apply_config()\r\n+        self.set_state(\"idle\")\r\n+\r\n+    # ------------------------------------------------------------------ setup\r\n+\r\n+    def _init_window_flags(self) -> None:\r\n+        self.setWindowFlags(\r\n+            Qt.WindowType.FramelessWindowHint\r\n+            | Qt.WindowType.WindowStaysOnTopHint\r\n+            | Qt.WindowType.Tool\r\n+        )\r\n+        self.setAttribute(Qt.WidgetAttribute.WA_TranslucentBackground, True)\r\n+\r\n+    def _init_ui(self) -> None:\r\n+        # иконка микрофона\r\n+        self.icon_label = QLabel()\r\n+        self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n+        # по умолчанию НИЧЕГО не показываем — иконка появляется только при смене состояния\r\n+\r\n+        # текст распознанного результата\r\n+        self.result_label = QLabel(\"\")\r\n+        self.result_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n+        self.result_label.setWordWrap(True)\r\n+\r\n+        # текст статуса\r\n+        self.status_label = QLabel(\"\")\r\n+        self.status_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n+\r\n+        # кнопка настроек\r\n+        self.menu_button = QPushButton(\"⚙\")\r\n+        self.menu_button.setFixedSize(24, 24)\r\n+        self.menu_button.clicked.connect(self._on_menu_clicked)\r\n+\r\n+        # кнопка свернуть/развернуть (compact/normal)\r\n+        self.compact_button = QPushButton(\"▢\")\r\n+        self.compact_button.setFixedSize(24, 24)\r\n+        self.compact_button.clicked.connect(self._on_compact_clicked)\r\n+\r\n+        # кнопка закрытия\r\n+        self.close_button = QPushButton(\"×\")\r\n+        self.close_button.setFixedSize(24, 24)\r\n+        self.close_button.clicked.connect(self._on_close_clicked)\r\n+\r\n+        top_layout = QHBoxLayout()\r\n+        top_layout.addWidget(self.menu_button)\r\n+        top_layout.addStretch()\r\n+        top_layout.addWidget(self.compact_button)\r\n+        top_layout.addWidget(self.close_button)\r\n+\r\n+        main_layout = QVBoxLayout()\r\n+        main_layout.setContentsMargins(6, 6, 6, 6)\r\n+        main_layout.addLayout(top_layout)\r\n+        main_layout.addWidget(self.icon_label, alignment=Qt.AlignmentFlag.AlignCenter)\r\n+        main_layout.addWidget(self.result_label)\r\n+        main_layout.addWidget(self.status_label)\r\n+\r\n+        container = QWidget()\r\n+        container.setLayout(main_layout)\r\n+        container.setObjectName(\"container\")\r\n+\r\n+        root_layout = QVBoxLayout(self)\r\n+        root_layout.setContentsMargins(0, 0, 0, 0)\r\n+        root_layout.addWidget(container)\r\n+\r\n+        self._apply_styles()\r\n+\r\n+    def _apply_styles(self) -> None:\r\n+        self.setStyleSheet(\r\n+            \"\"\"\r\n+            QWidget#container {\r\n+                background-color: rgba(30, 30, 30, 230);\r\n+                border-radius: 10px;\r\n+            }\r\n+            QLabel {\r\n+                color: white;\r\n+                font-size: 10pt;\r\n+            }\r\n+            QPushButton {\r\n+                background: transparent;\r\n+                color: white;\r\n+                border: none;\r\n+                font-size: 11pt;\r\n+            }\r\n+            QPushButton:hover {\r\n+                color: #00bcd4;\r\n+            }\r\n+            \"\"\"\r\n+        )\r\n+\r\n+    def _load_icons(self) -> None:\r\n+        \"\"\"Загружаем иконки микрофона, если они есть в assets/icons.\"\"\"\r\n+        icons_dir = Path(\"assets/icons\")\r\n+        idle_path = icons_dir / \"mic_idle.png\"\r\n+        rec_path = icons_dir / \"mic_recording.png\"\r\n+        proc_path = icons_dir / \"mic_processing.png\"\r\n+\r\n+        if idle_path.exists():\r\n+            self._icon_idle = QPixmap(str(idle_path))\r\n+        if rec_path.exists():\r\n+            self._icon_recording = QPixmap(str(rec_path))\r\n+        if proc_path.exists():\r\n+            self._icon_processing = QPixmap(str(proc_path))\r\n+\r\n+        app_icon_path = icons_dir / \"app_icon.ico\"\r\n+        if app_icon_path.exists():\r\n+            self.setWindowIcon(QIcon(str(app_icon_path)))\r\n+\r\n+    def _apply_config(self) -> None:\r\n+        w, h = self._ui_config.window_size\r\n+        self.resize(w, h)\r\n+        self.setWindowOpacity(self._ui_config.opacity)\r\n+        if self._ui_config.always_on_top:\r\n+            self.setWindowFlag(Qt.WindowType.WindowStaysOnTopHint, True)\r\n+\r\n+    # ------------------------------------------------------------------ state / mode\r\n+\r\n+    def set_state(self, state: str) -> None:\r\n+        self._state = state\r\n+\r\n+        # текст статуса\r\n+        if state == \"idle\":\r\n+            self.status_label.setText(\"Готово\")\r\n+        elif state == \"recording\":\r\n+            self.status_label.setText(\"Запись...\")\r\n+            # во время записи очищаем предыдущий результат\r\n+            self.result_label.setText(\"\")\r\n+        elif state == \"processing\":\r\n+            self.status_label.setText(\"Обработка...\")\r\n+        elif state == \"ready\":\r\n+            self.status_label.setText(\"Готово\")\r\n+            QTimer.singleShot(1000, lambda: self.set_state(\"idle\"))\r\n+        elif state == \"error\":\r\n+            self.status_label.setText(\"Ошибка\")\r\n+        else:\r\n+            self.status_label.setText(state)\r\n+\r\n+        # иконка микрофона\r\n+        # Логика:\r\n+        #   idle       -> серый микрофон (если есть PNG), иначе пусто\r\n+        #   recording  -> КРАСНЫЙ микрофон (если есть PNG), иначе пусто\r\n+        #   processing -> можно использовать \"processing\" PNG, если добавим\r\n+        if state == \"recording\" and self._icon_recording:\r\n+            self.icon_label.setPixmap(self._icon_recording)\r\n+        elif state == \"processing\" and self._icon_processing:\r\n+            self.icon_label.setPixmap(self._icon_processing)\r\n+        elif self._icon_idle:\r\n+            self.icon_label.setPixmap(self._icon_idle)\r\n+        else:\r\n+            # если PNG-иконок нет — не показываем ничего\r\n+            self.icon_label.clear()\r\n+\r\n+        # применяем текущий режим (compact/normal)\r\n+        self._apply_compact_mode()\r\n+\r\n+    def set_compact(self, compact: bool) -> None:\r\n+        \"\"\"Переключение между большим окном и компактным микрофоном.\"\"\"\r\n+        self._compact = compact\r\n+        self._apply_compact_mode()\r\n+\r\n+    def _apply_compact_mode(self) -> None:\r\n+        \"\"\"\r\n+        Компактный режим = узкая полоска с иконкой микрофона.\r\n+\r\n+        - Высота маленькая (например, 32 px).\r\n+        - Ширина фиксированная (например, 160 px).\r\n+        - Показываем только icon_label, всё остальное скрываем.\r\n+        \"\"\"\r\n+        if self._compact:\r\n+            # компактный режим: узкая полоска\r\n+            self.status_label.setVisible(False)\r\n+            self.result_label.setVisible(False)\r\n+            self.menu_button.setVisible(False)\r\n+            self.close_button.setVisible(False)\r\n+            self.compact_button.setVisible(False)\r\n+\r\n+            # высота полоски\r\n+            height = 32\r\n+            width = 160\r\n+            self.setFixedSize(width, height)\r\n+        else:\r\n+            # нормальный режим: всё видно\r\n+            self.status_label.setVisible(True)\r\n+            self.result_label.setVisible(True)\r\n+            self.menu_button.setVisible(True)\r\n+            self.close_button.setVisible(True)\r\n+            self.compact_button.setVisible(True)\r\n+            self.compact_button.setText(\"▢\")  # кнопка свернуть\r\n+            w, h = self._ui_config.window_size\r\n+            self.setFixedSize(w, h)\r\n+\r\n+    def show_message(self, text: str, timeout_ms: int = 2000) -> None:\r\n+        self.status_label.setText(text)\r\n+        if timeout_ms > 0:\r\n+            QTimer.singleShot(timeout_ms, lambda: self.set_state(self._state))\r\n+\r\n+    # ------------------------------------------------------------------ events\r\n+\r\n+    def _on_menu_clicked(self) -> None:\r\n+        # Открыть окно настроек\r\n+        self.settings_requested.emit()\r\n+\r\n+    def _on_compact_clicked(self) -> None:\r\n+        # Переключить режим окна\r\n+        self.set_compact(not self._compact)\r\n+        self.toggle_compact_requested.emit()\r\n+\r\n+    def _on_close_clicked(self) -> None:\r\n+        # Кнопка закрытия: сигнал наверх (App решает — выйти или скрыть окно)\r\n+        self.exit_requested.emit()\r\n+\r\n+    def mousePressEvent(self, event: QMouseEvent) -> None:\r\n+        if event.button() == Qt.MouseButton.LeftButton:\r\n+            self._drag_position = event.globalPosition().toPoint() - self.frameGeometry().topLeft()\r\n+            event.accept()\r\n+        super().mousePressEvent(event)\r\n+\r\n+    def mouseMoveEvent(self, event: QMouseEvent) -> None:\r\n+        if event.buttons() & Qt.MouseButton.LeftButton and self._drag_position is not None:\r\n+            self.move(event.globalPosition().toPoint() - self._drag_position)\r\n+            event.accept()\r\n+        super().mouseMoveEvent(event)\r\n+\r\n+    def mouseReleaseEvent(self, event: QMouseEvent) -> None:\r\n+        self._drag_position = None\r\n+        super().mouseReleaseEvent(event)\r\n+\r\n+    def mouseDoubleClickEvent(self, event: QMouseEvent) -> None:\r\n+        if event.button() == Qt.MouseButton.LeftButton:\r\n+            # двойной клик тоже открывает настройки\r\n+            self.settings_requested.emit()\r\n+        super().mouseDoubleClickEvent(event)\n\\ No newline at end of file\n"
                },
                {
                    "date": 1764296012926,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -206,22 +206,26 @@\n         self._apply_compact_mode()\r\n \r\n     def _apply_compact_mode(self) -> None:\r\n         \"\"\"\r\n-        Компактный режим = узкая полоска с иконкой микрофона.\r\n+        Компактный режим = узкая полоска с иконкой микрофона и маленькой\r\n+        кнопкой-разворачивателем.\r\n \r\n         - Высота маленькая (например, 32 px).\r\n         - Ширина фиксированная (например, 160 px).\r\n-        - Показываем только icon_label, всё остальное скрываем.\r\n+        - Показываем icon_label + compact_button, остальное скрываем.\r\n         \"\"\"\r\n         if self._compact:\r\n             # компактный режим: узкая полоска\r\n             self.status_label.setVisible(False)\r\n             self.result_label.setVisible(False)\r\n             self.menu_button.setVisible(False)\r\n             self.close_button.setVisible(False)\r\n-            self.compact_button.setVisible(False)\r\n \r\n+            # в компактном режиме кнопка показывает значок \"▣\" (развернуть)\r\n+            self.compact_button.setVisible(True)\r\n+            self.compact_button.setText(\"▣\")\r\n+\r\n             # высота полоски\r\n             height = 32\r\n             width = 160\r\n             self.setFixedSize(width, height)\r\n"
                },
                {
                    "date": 1764296189916,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -62,10 +62,18 @@\n     def _init_ui(self) -> None:\r\n         # иконка микрофона\r\n         self.icon_label = QLabel()\r\n         self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n-        # по умолчанию НИЧЕГО не показываем — иконка появляется только при смене состояния\r\n \r\n+        # ДЕФОЛТ: системная иконка микрофона/аудио, чтобы всегда что‑то было видно\r\n+        from PyQt6.QtWidgets import QApplication, QStyle\r\n+\r\n+        app = QApplication.instance()\r\n+        if app is not None and app.style() is not None:\r\n+            sys_icon = app.style().standardIcon(QStyle.StandardPixmap.SP_MediaVolume)\r\n+            if not sys_icon.isNull():\r\n+                self.icon_label.setPixmap(sys_icon.pixmap(24, 24))\r\n+\r\n         # текст распознанного результата\r\n         self.result_label = QLabel(\"\")\r\n         self.result_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n         self.result_label.setWordWrap(True)\r\n@@ -183,20 +191,29 @@\n             self.status_label.setText(state)\r\n \r\n         # иконка микрофона\r\n         # Логика:\r\n-        #   idle       -> серый микрофон (если есть PNG), иначе пусто\r\n-        #   recording  -> КРАСНЫЙ микрофон (если есть PNG), иначе пусто\r\n-        #   processing -> можно использовать \"processing\" PNG, если добавим\r\n+        #   idle       -> серый микрофон (если есть PNG), иначе системная иконка\r\n+        #   recording  -> КРАСНЫЙ микрофон (если есть PNG), иначе системная иконка\r\n+        #   processing -> отдельная PNG (если есть), иначе системная иконка\r\n+        from PyQt6.QtWidgets import QApplication, QStyle\r\n+\r\n+        def _set_system_icon() -> None:\r\n+            app = QApplication.instance()\r\n+            if app is not None and app.style() is not None:\r\n+                sys_icon = app.style().standardIcon(QStyle.StandardPixmap.SP_MediaVolume)\r\n+                if not sys_icon.isNull():\r\n+                    self.icon_label.setPixmap(sys_icon.pixmap(24, 24))\r\n+\r\n         if state == \"recording\" and self._icon_recording:\r\n             self.icon_label.setPixmap(self._icon_recording)\r\n         elif state == \"processing\" and self._icon_processing:\r\n             self.icon_label.setPixmap(self._icon_processing)\r\n         elif self._icon_idle:\r\n             self.icon_label.setPixmap(self._icon_idle)\r\n         else:\r\n-            # если PNG-иконок нет — не показываем ничего\r\n-            self.icon_label.clear()\r\n+            # если PNG-иконок нет — показываем системную иконку, чтобы не было пустоты\r\n+            _set_system_icon()\r\n \r\n         # применяем текущий режим (compact/normal)\r\n         self._apply_compact_mode()\r\n \r\n"
                },
                {
                    "date": 1764296612619,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,9 +4,19 @@\n from typing import Optional\r\n \r\n from PyQt6.QtCore import QPoint, Qt, QTimer, pyqtSignal\r\n from PyQt6.QtGui import QIcon, QMouseEvent, QPixmap\r\n-from PyQt6.QtWidgets import QLabel, QHBoxLayout, QVBoxLayout, QWidget, QPushButton\r\n+from PyQt6.QtWidgets import (\r\n+    QLabel,\r\n+    QHBoxLayout,\r\n+    QVBoxLayout,\r\n+    QWidget,\r\n+    QPushButton,\r\n+    QStackedLayout,\r\n+    QComboBox,\r\n+    QLineEdit,\r\n+    QFormLayout,\r\n+)\r\n \r\n from config.settings import UIConfig\r\n \r\n \r\n@@ -42,8 +52,11 @@\n         self._icon_idle: Optional[QPixmap] = None\r\n         self._icon_recording: Optional[QPixmap] = None\r\n         self._icon_processing: Optional[QPixmap] = None\r\n \r\n+        # режимы содержимого: \"main\" (основной) / \"settings\" (панель настроек)\r\n+        self._content_mode: str = \"main\"\r\n+\r\n         self._init_window_flags()\r\n         self._init_ui()\r\n         self._load_icons()\r\n         self._apply_config()\r\n@@ -59,8 +72,28 @@\n         )\r\n         self.setAttribute(Qt.WidgetAttribute.WA_TranslucentBackground, True)\r\n \r\n     def _init_ui(self) -> None:\r\n+        # верхняя панель (общая для всех режимов)\r\n+        self.menu_button = QPushButton(\"⚙\")\r\n+        self.menu_button.setFixedSize(24, 24)\r\n+        self.menu_button.clicked.connect(self._on_menu_clicked)\r\n+\r\n+        self.compact_button = QPushButton(\"▢\")\r\n+        self.compact_button.setFixedSize(24, 24)\r\n+        self.compact_button.clicked.connect(self._on_compact_clicked)\r\n+\r\n+        self.close_button = QPushButton(\"×\")\r\n+        self.close_button.setFixedSize(24, 24)\r\n+        self.close_button.clicked.connect(self._on_close_clicked)\r\n+\r\n+        top_layout = QHBoxLayout()\r\n+        top_layout.addWidget(self.menu_button)\r\n+        top_layout.addStretch()\r\n+        top_layout.addWidget(self.compact_button)\r\n+        top_layout.addWidget(self.close_button)\r\n+\r\n+        # ---------- основное содержимое (режим \"main\") ----------\r\n         # иконка микрофона\r\n         self.icon_label = QLabel()\r\n         self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n \r\n@@ -81,38 +114,60 @@\n         # текст статуса\r\n         self.status_label = QLabel(\"\")\r\n         self.status_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n \r\n-        # кнопка настроек\r\n-        self.menu_button = QPushButton(\"⚙\")\r\n-        self.menu_button.setFixedSize(24, 24)\r\n-        self.menu_button.clicked.connect(self._on_menu_clicked)\r\n-\r\n-        # кнопка свернуть/развернуть (compact/normal)\r\n-        self.compact_button = QPushButton(\"▢\")\r\n-        self.compact_button.setFixedSize(24, 24)\r\n-        self.compact_button.clicked.connect(self._on_compact_clicked)\r\n-\r\n-        # кнопка закрытия\r\n-        self.close_button = QPushButton(\"×\")\r\n-        self.close_button.setFixedSize(24, 24)\r\n-        self.close_button.clicked.connect(self._on_close_clicked)\r\n-\r\n-        top_layout = QHBoxLayout()\r\n-        top_layout.addWidget(self.menu_button)\r\n-        top_layout.addStretch()\r\n-        top_layout.addWidget(self.compact_button)\r\n-        top_layout.addWidget(self.close_button)\r\n-\r\n-        main_layout = QVBoxLayout()\r\n+        main_page = QWidget()\r\n+        main_layout = QVBoxLayout(main_page)\r\n         main_layout.setContentsMargins(6, 6, 6, 6)\r\n         main_layout.addLayout(top_layout)\r\n         main_layout.addWidget(self.icon_label, alignment=Qt.AlignmentFlag.AlignCenter)\r\n         main_layout.addWidget(self.result_label)\r\n         main_layout.addWidget(self.status_label)\r\n \r\n+        # ---------- панель настроек (режим \"settings\") ----------\r\n+        self.settings_backend_combo = QComboBox()\r\n+        self.settings_backend_combo.addItem(\"Groq\", userData=\"groq\")\r\n+        self.settings_backend_combo.addItem(\"OpenAI\", userData=\"openai\")\r\n+\r\n+        self.settings_groq_key = QLineEdit()\r\n+        self.settings_groq_key.setEchoMode(QLineEdit.EchoMode.Password)\r\n+\r\n+        self.settings_openai_key = QLineEdit()\r\n+        self.settings_openai_key.setEchoMode(QLineEdit.EchoMode.Password)\r\n+\r\n+        self.settings_openai_url = QLineEdit()\r\n+\r\n+        form = QFormLayout()\r\n+        form.addRow(\"Сервис распознавания:\", self.settings_backend_combo)\r\n+        form.addRow(\"Groq API key:\", self.settings_groq_key)\r\n+        form.addRow(\"OpenAI API key:\", self.settings_openai_key)\r\n+        form.addRow(\"OpenAI Base URL:\", self.settings_openai_url)\r\n+\r\n+        self.settings_save_button = QPushButton(\"Сохранить\")\r\n+        self.settings_save_button.clicked.connect(self._on_settings_save_clicked)\r\n+\r\n+        self.settings_cancel_button = QPushButton(\"Отмена\")\r\n+        self.settings_cancel_button.clicked.connect(self._on_settings_cancel_clicked)\r\n+\r\n+        buttons_layout = QHBoxLayout()\r\n+        buttons_layout.addStretch()\r\n+        buttons_layout.addWidget(self.settings_save_button)\r\n+        buttons_layout.addWidget(self.settings_cancel_button)\r\n+\r\n+        settings_page = QWidget()\r\n+        settings_layout = QVBoxLayout(settings_page)\r\n+        settings_layout.setContentsMargins(6, 6, 6, 6)\r\n+        settings_layout.addLayout(top_layout)\r\n+        settings_layout.addLayout(form)\r\n+        settings_layout.addLayout(buttons_layout)\r\n+\r\n+        # ---------- стек страниц ----------\r\n+        self._stack = QStackedLayout()\r\n+        self._stack.addWidget(main_page)      # index 0: main\r\n+        self._stack.addWidget(settings_page)  # index 1: settings\r\n+\r\n         container = QWidget()\r\n-        container.setLayout(main_layout)\r\n+        container.setLayout(self._stack)\r\n         container.setObjectName(\"container\")\r\n \r\n         root_layout = QVBoxLayout(self)\r\n         root_layout.setContentsMargins(0, 0, 0, 0)\r\n@@ -261,280 +316,40 @@\n         self.status_label.setText(text)\r\n         if timeout_ms > 0:\r\n             QTimer.singleShot(timeout_ms, lambda: self.set_state(self._state))\r\n \r\n-    # ------------------------------------------------------------------ events\r\n+    # ------------------------------------------------------------------ settings mode\r\n \r\n-    def _on_menu_clicked(self) -> None:\r\n-        # Открыть окно настроек\r\n-        self.settings_requested.emit()\r\n+    def _enter_settings_mode(self) -> None:\r\n+        \"\"\"Показать панель настроек внутри этого же окна.\"\"\"\r\n+        from config.settings import AppSettings  # только для типа, настройки приходят из App\r\n \r\n-    def _on_compact_clicked(self) -> None:\r\n-        # Переключить режим окна\r\n-        self.set_compact(not self._compact)\r\n-        self.toggle_compact_requested.emit()\r\n+        self._content_mode = \"settings\"\r\n+        self._stack.setCurrentIndex(1)\r\n \r\n-    def _on_close_clicked(self) -> None:\r\n-        # Кнопка закрытия: сигнал наверх (App решает — выйти или скрыть окно)\r\n-        self.exit_requested.emit()\r\n+    def leave_settings_mode(self) -> None:\r\n+        \"\"\"Вернуться в основной режим отображения.\"\"\"\r\n+        self._content_mode = \"main\"\r\n+        self._stack.setCurrentIndex(0)\r\n \r\n-    def mousePressEvent(self, event: QMouseEvent) -> None:\r\n-        if event.button() == Qt.MouseButton.LeftButton:\r\n-            self._drag_position = event.globalPosition().toPoint() - self.frameGeometry().topLeft()\r\n-            event.accept()\r\n-        super().mousePressEvent(event)\r\n+    def _on_settings_save_clicked(self) -> None:\r\n+        \"\"\"\r\n+        Сигнал наверх о том, что пользователь хочет сохранить настройки.\r\n+        Здесь только выходим из режима настроек; само сохранение делает App.\r\n+        \"\"\"\r\n+        # Просто вернёмся в основной режим; App уже получил новые значения через signals/slots,\r\n+        # которые мы добавим на следующем шаге, если потребуется.\r\n+        self.leave_settings_mode()\r\n \r\n-    def mouseMoveEvent(self, event: QMouseEvent) -> None:\r\n-        if event.buttons() & Qt.MouseButton.LeftButton and self._drag_position is not None:\r\n-            self.move(event.globalPosition().toPoint() - self._drag_position)\r\n-            event.accept()\r\n-        super().mouseMoveEvent(event)\r\n+    def _on_settings_cancel_clicked(self) -> None:\r\n+        \"\"\"Отмена изменений и возврат в основной режим.\"\"\"\r\n+        self.leave_settings_mode()\r\n \r\n-    def mouseReleaseEvent(self, event: QMouseEvent) -> None:\r\n-        self._drag_position = None\r\n-        super().mouseReleaseEvent(event)\r\n-\r\n-    def mouseDoubleClickEvent(self, event: QMouseEvent) -> None:\r\n-        if event.button() == Qt.MouseButton.LeftButton:\r\n-            # двойной клик тоже открывает настройки\r\n-            self.settings_requested.emit()\r\n-        super().mouseDoubleClickEvent(event)\n-from __future__ import annotations\r\n-\r\n-from pathlib import Path\r\n-from typing import Optional\r\n-\r\n-from PyQt6.QtCore import QPoint, Qt, QTimer, pyqtSignal\r\n-from PyQt6.QtGui import QIcon, QMouseEvent, QPixmap\r\n-from PyQt6.QtWidgets import QLabel, QHBoxLayout, QVBoxLayout, QWidget, QPushButton\r\n-\r\n-from config.settings import UIConfig\r\n-\r\n-\r\n-class FloatingWindow(QWidget):\r\n-    \"\"\"\r\n-    Главное плавающее окно VoiceCapture.\r\n-\r\n-    Режимы:\r\n-        - normal  — большое окно с текстом и кнопками\r\n-        - compact — маленький \"висячий микрофон\"\r\n-\r\n-    Состояния:\r\n-        - idle\r\n-        - recording\r\n-        - processing\r\n-        - ready\r\n-        - error\r\n-    \"\"\"\r\n-\r\n-    settings_requested = pyqtSignal()\r\n-    exit_requested = pyqtSignal()\r\n-    toggle_compact_requested = pyqtSignal()\r\n-\r\n-    def __init__(self, ui_config: UIConfig) -> None:\r\n-        super().__init__()\r\n-\r\n-        self._ui_config = ui_config\r\n-        self._drag_position: Optional[QPoint] = None\r\n-        self._state: str = \"idle\"\r\n-        self._compact: bool = False\r\n-\r\n-        # иконки микрофона\r\n-        self._icon_idle: Optional[QPixmap] = None\r\n-        self._icon_recording: Optional[QPixmap] = None\r\n-        self._icon_processing: Optional[QPixmap] = None\r\n-\r\n-        self._init_window_flags()\r\n-        self._init_ui()\r\n-        self._load_icons()\r\n-        self._apply_config()\r\n-        self.set_state(\"idle\")\r\n-\r\n-    # ------------------------------------------------------------------ setup\r\n-\r\n-    def _init_window_flags(self) -> None:\r\n-        self.setWindowFlags(\r\n-            Qt.WindowType.FramelessWindowHint\r\n-            | Qt.WindowType.WindowStaysOnTopHint\r\n-            | Qt.WindowType.Tool\r\n-        )\r\n-        self.setAttribute(Qt.WidgetAttribute.WA_TranslucentBackground, True)\r\n-\r\n-    def _init_ui(self) -> None:\r\n-        # иконка микрофона\r\n-        self.icon_label = QLabel()\r\n-        self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n-        # по умолчанию НИЧЕГО не показываем — иконка появляется только при смене состояния\r\n-\r\n-        # текст распознанного результата\r\n-        self.result_label = QLabel(\"\")\r\n-        self.result_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n-        self.result_label.setWordWrap(True)\r\n-\r\n-        # текст статуса\r\n-        self.status_label = QLabel(\"\")\r\n-        self.status_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n-\r\n-        # кнопка настроек\r\n-        self.menu_button = QPushButton(\"⚙\")\r\n-        self.menu_button.setFixedSize(24, 24)\r\n-        self.menu_button.clicked.connect(self._on_menu_clicked)\r\n-\r\n-        # кнопка свернуть/развернуть (compact/normal)\r\n-        self.compact_button = QPushButton(\"▢\")\r\n-        self.compact_button.setFixedSize(24, 24)\r\n-        self.compact_button.clicked.connect(self._on_compact_clicked)\r\n-\r\n-        # кнопка закрытия\r\n-        self.close_button = QPushButton(\"×\")\r\n-        self.close_button.setFixedSize(24, 24)\r\n-        self.close_button.clicked.connect(self._on_close_clicked)\r\n-\r\n-        top_layout = QHBoxLayout()\r\n-        top_layout.addWidget(self.menu_button)\r\n-        top_layout.addStretch()\r\n-        top_layout.addWidget(self.compact_button)\r\n-        top_layout.addWidget(self.close_button)\r\n-\r\n-        main_layout = QVBoxLayout()\r\n-        main_layout.setContentsMargins(6, 6, 6, 6)\r\n-        main_layout.addLayout(top_layout)\r\n-        main_layout.addWidget(self.icon_label, alignment=Qt.AlignmentFlag.AlignCenter)\r\n-        main_layout.addWidget(self.result_label)\r\n-        main_layout.addWidget(self.status_label)\r\n-\r\n-        container = QWidget()\r\n-        container.setLayout(main_layout)\r\n-        container.setObjectName(\"container\")\r\n-\r\n-        root_layout = QVBoxLayout(self)\r\n-        root_layout.setContentsMargins(0, 0, 0, 0)\r\n-        root_layout.addWidget(container)\r\n-\r\n-        self._apply_styles()\r\n-\r\n-    def _apply_styles(self) -> None:\r\n-        self.setStyleSheet(\r\n-            \"\"\"\r\n-            QWidget#container {\r\n-                background-color: rgba(30, 30, 30, 230);\r\n-                border-radius: 10px;\r\n-            }\r\n-            QLabel {\r\n-                color: white;\r\n-                font-size: 10pt;\r\n-            }\r\n-            QPushButton {\r\n-                background: transparent;\r\n-                color: white;\r\n-                border: none;\r\n-                font-size: 11pt;\r\n-            }\r\n-            QPushButton:hover {\r\n-                color: #00bcd4;\r\n-            }\r\n-            \"\"\"\r\n-        )\r\n-\r\n-    def _load_icons(self) -> None:\r\n-        \"\"\"Загружаем иконки микрофона, если они есть в assets/icons.\"\"\"\r\n-        icons_dir = Path(\"assets/icons\")\r\n-        idle_path = icons_dir / \"mic_idle.png\"\r\n-        rec_path = icons_dir / \"mic_recording.png\"\r\n-        proc_path = icons_dir / \"mic_processing.png\"\r\n-\r\n-        if idle_path.exists():\r\n-            self._icon_idle = QPixmap(str(idle_path))\r\n-        if rec_path.exists():\r\n-            self._icon_recording = QPixmap(str(rec_path))\r\n-        if proc_path.exists():\r\n-            self._icon_processing = QPixmap(str(proc_path))\r\n-\r\n-        app_icon_path = icons_dir / \"app_icon.ico\"\r\n-        if app_icon_path.exists():\r\n-            self.setWindowIcon(QIcon(str(app_icon_path)))\r\n-\r\n-    def _apply_config(self) -> None:\r\n-        w, h = self._ui_config.window_size\r\n-        self.resize(w, h)\r\n-        self.setWindowOpacity(self._ui_config.opacity)\r\n-        if self._ui_config.always_on_top:\r\n-            self.setWindowFlag(Qt.WindowType.WindowStaysOnTopHint, True)\r\n-\r\n-    # ------------------------------------------------------------------ state / mode\r\n-\r\n-    def set_state(self, state: str) -> None:\r\n-        self._state = state\r\n-\r\n-        # текст статуса\r\n-        if state == \"idle\":\r\n-            self.status_label.setText(\"Готово\")\r\n-        elif state == \"recording\":\r\n-            self.status_label.setText(\"Запись...\")\r\n-            # во время записи очищаем предыдущий результат\r\n-            self.result_label.setText(\"\")\r\n-        elif state == \"processing\":\r\n-            self.status_label.setText(\"Обработка...\")\r\n-        elif state == \"ready\":\r\n-            self.status_label.setText(\"Готово\")\r\n-            QTimer.singleShot(1000, lambda: self.set_state(\"idle\"))\r\n-        elif state == \"error\":\r\n-            self.status_label.setText(\"Ошибка\")\r\n-        else:\r\n-            self.status_label.setText(state)\r\n-\r\n-        # иконка микрофона\r\n-        # Логика:\r\n-        #   idle       -> серый микрофон (если есть PNG), иначе пусто\r\n-        #   recording  -> КРАСНЫЙ микрофон (если есть PNG), иначе пусто\r\n-        #   processing -> можно использовать \"processing\" PNG, если добавим\r\n-        if state == \"recording\" and self._icon_recording:\r\n-            self.icon_label.setPixmap(self._icon_recording)\r\n-        elif state == \"processing\" and self._icon_processing:\r\n-            self.icon_label.setPixmap(self._icon_processing)\r\n-        elif self._icon_idle:\r\n-            self.icon_label.setPixmap(self._icon_idle)\r\n-        else:\r\n-            # если PNG-иконок нет — не показываем ничего, чтобы центр не был занят динамиком\r\n-            self.icon_label.clear()\r\n-\r\n-        # применяем текущий режим (compact/normal)\r\n-        self._apply_compact_mode()\r\n-\r\n-    def set_compact(self, compact: bool) -> None:\r\n-        \"\"\"Переключение между большим окном и компактным микрофоном.\"\"\"\r\n-        self._compact = compact\r\n-        self._apply_compact_mode()\r\n-\r\n-    def _apply_compact_mode(self) -> None:\r\n-        if self._compact:\r\n-            # компактный режим: маленькое окно, только иконка\r\n-            self.status_label.setVisible(False)\r\n-            self.result_label.setVisible(False)\r\n-            self.menu_button.setVisible(False)\r\n-            self.close_button.setVisible(False)\r\n-            self.compact_button.setText(\"▣\")  # кнопка развернуть\r\n-            self.setFixedSize(64, 64)\r\n-        else:\r\n-            # нормальный режим: всё видно\r\n-            self.status_label.setVisible(True)\r\n-            self.result_label.setVisible(True)\r\n-            self.menu_button.setVisible(True)\r\n-            self.close_button.setVisible(True)\r\n-            self.compact_button.setText(\"▢\")  # кнопка свернуть\r\n-            w, h = self._ui_config.window_size\r\n-            self.setFixedSize(w, h)\r\n-\r\n-    def show_message(self, text: str, timeout_ms: int = 2000) -> None:\r\n-        self.status_label.setText(text)\r\n-        if timeout_ms > 0:\r\n-            QTimer.singleShot(timeout_ms, lambda: self.set_state(self._state))\r\n-\r\n     # ------------------------------------------------------------------ events\r\n \r\n     def _on_menu_clicked(self) -> None:\r\n-        # Открыть окно настроек\r\n-        self.settings_requested.emit()\r\n+        # Переключить содержимое на панель настроек в том же окне\r\n+        self._enter_settings_mode()\r\n \r\n     def _on_compact_clicked(self) -> None:\r\n         # Переключить режим окна\r\n         self.set_compact(not self._compact)\r\n@@ -561,7 +376,7 @@\n         super().mouseReleaseEvent(event)\r\n \r\n     def mouseDoubleClickEvent(self, event: QMouseEvent) -> None:\r\n         if event.button() == Qt.MouseButton.LeftButton:\r\n-            # двойной клик тоже открывает настройки\r\n-            self.settings_requested.emit()\r\n+            # двойной клик по окну — тоже открыть настройки\r\n+            self._enter_settings_mode()\r\n         super().mouseDoubleClickEvent(event)\n\\ No newline at end of file\n"
                },
                {
                    "date": 1764296803070,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -85,8 +85,11 @@\n         self.close_button = QPushButton(\"×\")\r\n         self.close_button.setFixedSize(24, 24)\r\n         self.close_button.clicked.connect(self._on_close_clicked)\r\n \r\n+        # ВАЖНО: top_layout используется ТОЛЬКО в main_page.\r\n+        # Для settings_page создадим отдельный layout, чтобы избежать\r\n+        # предупреждения \"layout already has a parent\".\r\n         top_layout = QHBoxLayout()\r\n         top_layout.addWidget(self.menu_button)\r\n         top_layout.addStretch()\r\n         top_layout.addWidget(self.compact_button)\r\n@@ -155,9 +158,17 @@\n \r\n         settings_page = QWidget()\r\n         settings_layout = QVBoxLayout(settings_page)\r\n         settings_layout.setContentsMargins(6, 6, 6, 6)\r\n-        settings_layout.addLayout(top_layout)\r\n+\r\n+        # отдельный top‑layout для страницы настроек\r\n+        settings_top_layout = QHBoxLayout()\r\n+        settings_top_layout.addWidget(self.menu_button)\r\n+        settings_top_layout.addStretch()\r\n+        settings_top_layout.addWidget(self.compact_button)\r\n+        settings_top_layout.addWidget(self.close_button)\r\n+\r\n+        settings_layout.addLayout(settings_top_layout)\r\n         settings_layout.addLayout(form)\r\n         settings_layout.addLayout(buttons_layout)\r\n \r\n         # ---------- стек страниц ----------\r\n@@ -287,16 +298,19 @@\n         - Показываем icon_label + compact_button, остальное скрываем.\r\n         \"\"\"\r\n         if self._compact:\r\n             # компактный режим: узкая полоска\r\n+            # Показываем только иконку микрофона и кнопку разворота.\r\n             self.status_label.setVisible(False)\r\n             self.result_label.setVisible(False)\r\n             self.menu_button.setVisible(False)\r\n             self.close_button.setVisible(False)\r\n \r\n             # в компактном режиме кнопка показывает значок \"▣\" (развернуть)\r\n             self.compact_button.setVisible(True)\r\n             self.compact_button.setText(\"▣\")\r\n+            # иконка микрофона всегда видна\r\n+            self.icon_label.setVisible(True)\r\n \r\n             # высота полоски\r\n             height = 32\r\n             width = 160\r\n@@ -308,8 +322,10 @@\n             self.menu_button.setVisible(True)\r\n             self.close_button.setVisible(True)\r\n             self.compact_button.setVisible(True)\r\n             self.compact_button.setText(\"▢\")  # кнопка свернуть\r\n+            # иконка микрофона тоже видна\r\n+            self.icon_label.setVisible(True)\r\n             w, h = self._ui_config.window_size\r\n             self.setFixedSize(w, h)\r\n \r\n     def show_message(self, text: str, timeout_ms: int = 2000) -> None:\r\n"
                },
                {
                    "date": 1764296920197,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,422 @@\n+from __future__ import annotations\r\n+\r\n+from pathlib import Path\r\n+from typing import Optional\r\n+\r\n+from PyQt6.QtCore import QPoint, Qt, QTimer, pyqtSignal\r\n+from PyQt6.QtGui import QIcon, QMouseEvent, QPixmap\r\n+from PyQt6.QtWidgets import (\r\n+    QLabel,\r\n+    QHBoxLayout,\r\n+    QVBoxLayout,\r\n+    QWidget,\r\n+    QPushButton,\r\n+    QStackedLayout,\r\n+    QComboBox,\r\n+    QLineEdit,\r\n+    QFormLayout,\r\n+)\r\n+\r\n+from config.settings import UIConfig\r\n+\r\n+\r\n+class FloatingWindow(QWidget):\r\n+    \"\"\"\r\n+    Главное плавающее окно VoiceCapture.\r\n+\r\n+    Режимы:\r\n+        - normal  — большое окно с текстом и кнопками\r\n+        - compact — маленький \"висячий микрофон\"\r\n+\r\n+    Состояния:\r\n+        - idle\r\n+        - recording\r\n+        - processing\r\n+        - ready\r\n+        - error\r\n+    \"\"\"\r\n+\r\n+    settings_requested = pyqtSignal()\r\n+    exit_requested = pyqtSignal()\r\n+    toggle_compact_requested = pyqtSignal()\r\n+\r\n+    def __init__(self, ui_config: UIConfig) -> None:\r\n+        super().__init__()\r\n+\r\n+        self._ui_config = ui_config\r\n+        self._drag_position: Optional[QPoint] = None\r\n+        self._state: str = \"idle\"\r\n+        self._compact: bool = False\r\n+\r\n+        # иконки микрофона\r\n+        self._icon_idle: Optional[QPixmap] = None\r\n+        self._icon_recording: Optional[QPixmap] = None\r\n+        self._icon_processing: Optional[QPixmap] = None\r\n+\r\n+        # режимы содержимого: \"main\" (основной) / \"settings\" (панель настроек)\r\n+        self._content_mode: str = \"main\"\r\n+\r\n+        self._init_window_flags()\r\n+        self._init_ui()\r\n+        self._load_icons()\r\n+        self._apply_config()\r\n+        self.set_state(\"idle\")\r\n+\r\n+    # ------------------------------------------------------------------ setup\r\n+\r\n+    def _init_window_flags(self) -> None:\r\n+        self.setWindowFlags(\r\n+            Qt.WindowType.FramelessWindowHint\r\n+            | Qt.WindowType.WindowStaysOnTopHint\r\n+            | Qt.WindowType.Tool\r\n+        )\r\n+        self.setAttribute(Qt.WidgetAttribute.WA_TranslucentBackground, True)\r\n+\r\n+    def _init_ui(self) -> None:\r\n+        # верхняя панель (общая логика, НО отдельные экземпляры кнопок для каждой страницы)\r\n+        # --- кнопки для основной страницы ---\r\n+        self.menu_button_main = QPushButton(\"⚙\")\r\n+        self.menu_button_main.setFixedSize(24, 24)\r\n+        self.menu_button_main.clicked.connect(self._on_menu_clicked)\r\n+\r\n+        self.compact_button_main = QPushButton(\"▢\")\r\n+        self.compact_button_main.setFixedSize(24, 24)\r\n+        self.compact_button_main.clicked.connect(self._on_compact_clicked)\r\n+\r\n+        self.close_button_main = QPushButton(\"×\")\r\n+        self.close_button_main.setFixedSize(24, 24)\r\n+        self.close_button_main.clicked.connect(self._on_close_clicked)\r\n+\r\n+        top_layout = QHBoxLayout()\r\n+        top_layout.addWidget(self.menu_button_main)\r\n+        top_layout.addStretch()\r\n+        top_layout.addWidget(self.compact_button_main)\r\n+        top_layout.addWidget(self.close_button_main)\r\n+\r\n+        # ---------- основное содержимое (режим \"main\") ----------\r\n+        # иконка микрофона\r\n+        self.icon_label = QLabel()\r\n+        self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n+\r\n+        # ДЕФОЛТ: системная иконка микрофона/аудио, чтобы всегда что‑то было видно\r\n+        from PyQt6.QtWidgets import QApplication, QStyle\r\n+\r\n+        app = QApplication.instance()\r\n+        if app is not None and app.style() is not None:\r\n+            sys_icon = app.style().standardIcon(QStyle.StandardPixmap.SP_MediaVolume)\r\n+            if not sys_icon.isNull():\r\n+                self.icon_label.setPixmap(sys_icon.pixmap(24, 24))\r\n+\r\n+        # текст распознанного результата\r\n+        self.result_label = QLabel(\"\")\r\n+        self.result_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n+        self.result_label.setWordWrap(True)\r\n+\r\n+        # текст статуса\r\n+        self.status_label = QLabel(\"\")\r\n+        self.status_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n+\r\n+        main_page = QWidget()\r\n+        main_layout = QVBoxLayout(main_page)\r\n+        main_layout.setContentsMargins(6, 6, 6, 6)\r\n+        main_layout.addLayout(top_layout)\r\n+        main_layout.addWidget(self.icon_label, alignment=Qt.AlignmentFlag.AlignCenter)\r\n+        main_layout.addWidget(self.result_label)\r\n+        main_layout.addWidget(self.status_label)\r\n+\r\n+        # ---------- панель настроек (режим \"settings\") ----------\r\n+        self.settings_backend_combo = QComboBox()\r\n+        self.settings_backend_combo.addItem(\"Groq\", userData=\"groq\")\r\n+        self.settings_backend_combo.addItem(\"OpenAI\", userData=\"openai\")\r\n+\r\n+        self.settings_groq_key = QLineEdit()\r\n+        self.settings_groq_key.setEchoMode(QLineEdit.EchoMode.Password)\r\n+\r\n+        self.settings_openai_key = QLineEdit()\r\n+        self.settings_openai_key.setEchoMode(QLineEdit.EchoMode.Password)\r\n+\r\n+        self.settings_openai_url = QLineEdit()\r\n+\r\n+        form = QFormLayout()\r\n+        form.addRow(\"Сервис распознавания:\", self.settings_backend_combo)\r\n+        form.addRow(\"Groq API key:\", self.settings_groq_key)\r\n+        form.addRow(\"OpenAI API key:\", self.settings_openai_key)\r\n+        form.addRow(\"OpenAI Base URL:\", self.settings_openai_url)\r\n+\r\n+        self.settings_save_button = QPushButton(\"Сохранить\")\r\n+        self.settings_save_button.clicked.connect(self._on_settings_save_clicked)\r\n+\r\n+        self.settings_cancel_button = QPushButton(\"Отмена\")\r\n+        self.settings_cancel_button.clicked.connect(self._on_settings_cancel_clicked)\r\n+\r\n+        buttons_layout = QHBoxLayout()\r\n+        buttons_layout.addStretch()\r\n+        buttons_layout.addWidget(self.settings_save_button)\r\n+        buttons_layout.addWidget(self.settings_cancel_button)\r\n+\r\n+        settings_page = QWidget()\r\n+        settings_layout = QVBoxLayout(settings_page)\r\n+        settings_layout.setContentsMargins(6, 6, 6, 6)\r\n+\r\n+        # отдельные кнопки для страницы настроек\r\n+        self.menu_button_settings = QPushButton(\"⚙\")\r\n+        self.menu_button_settings.setFixedSize(24, 24)\r\n+        self.menu_button_settings.clicked.connect(self._on_menu_clicked)\r\n+\r\n+        self.compact_button_settings = QPushButton(\"▢\")\r\n+        self.compact_button_settings.setFixedSize(24, 24)\r\n+        self.compact_button_settings.clicked.connect(self._on_compact_clicked)\r\n+\r\n+        self.close_button_settings = QPushButton(\"×\")\r\n+        self.close_button_settings.setFixedSize(24, 24)\r\n+        self.close_button_settings.clicked.connect(self._on_close_clicked)\r\n+\r\n+        settings_top_layout = QHBoxLayout()\r\n+        settings_top_layout.addWidget(self.menu_button_settings)\r\n+        settings_top_layout.addStretch()\r\n+        settings_top_layout.addWidget(self.compact_button_settings)\r\n+        settings_top_layout.addWidget(self.close_button_settings)\r\n+\r\n+        settings_layout.addLayout(settings_top_layout)\r\n+        settings_layout.addLayout(form)\r\n+        settings_layout.addLayout(buttons_layout)\r\n+\r\n+        # ---------- стек страниц ----------\r\n+        self._stack = QStackedLayout()\r\n+        self._stack.addWidget(main_page)      # index 0: main\r\n+        self._stack.addWidget(settings_page)  # index 1: settings\r\n+\r\n+        container = QWidget()\r\n+        container.setLayout(self._stack)\r\n+        container.setObjectName(\"container\")\r\n+\r\n+        root_layout = QVBoxLayout(self)\r\n+        root_layout.setContentsMargins(0, 0, 0, 0)\r\n+        root_layout.addWidget(container)\r\n+\r\n+        self._apply_styles()\r\n+\r\n+    def _apply_styles(self) -> None:\r\n+        self.setStyleSheet(\r\n+            \"\"\"\r\n+            QWidget#container {\r\n+                background-color: rgba(30, 30, 30, 230);\r\n+                border-radius: 10px;\r\n+            }\r\n+            QLabel {\r\n+                color: white;\r\n+                font-size: 10pt;\r\n+            }\r\n+            QPushButton {\r\n+                background: transparent;\r\n+                color: white;\r\n+                border: none;\r\n+                font-size: 11pt;\r\n+            }\r\n+            QPushButton:hover {\r\n+                color: #00bcd4;\r\n+            }\r\n+            \"\"\"\r\n+        )\r\n+\r\n+    def _load_icons(self) -> None:\r\n+        \"\"\"Загружаем иконки микрофона, если они есть в assets/icons.\"\"\"\r\n+        icons_dir = Path(\"assets/icons\")\r\n+        idle_path = icons_dir / \"mic_idle.png\"\r\n+        rec_path = icons_dir / \"mic_recording.png\"\r\n+        proc_path = icons_dir / \"mic_processing.png\"\r\n+\r\n+        if idle_path.exists():\r\n+            self._icon_idle = QPixmap(str(idle_path))\r\n+        if rec_path.exists():\r\n+            self._icon_recording = QPixmap(str(rec_path))\r\n+        if proc_path.exists():\r\n+            self._icon_processing = QPixmap(str(proc_path))\r\n+\r\n+        app_icon_path = icons_dir / \"app_icon.ico\"\r\n+        if app_icon_path.exists():\r\n+            self.setWindowIcon(QIcon(str(app_icon_path)))\r\n+\r\n+    def _apply_config(self) -> None:\r\n+        w, h = self._ui_config.window_size\r\n+        self.resize(w, h)\r\n+        self.setWindowOpacity(self._ui_config.opacity)\r\n+        if self._ui_config.always_on_top:\r\n+            self.setWindowFlag(Qt.WindowType.WindowStaysOnTopHint, True)\r\n+\r\n+    # ------------------------------------------------------------------ state / mode\r\n+\r\n+    def set_state(self, state: str) -> None:\r\n+        self._state = state\r\n+\r\n+        # текст статуса\r\n+        if state == \"idle\":\r\n+            self.status_label.setText(\"Готово\")\r\n+        elif state == \"recording\":\r\n+            self.status_label.setText(\"Запись...\")\r\n+            # во время записи очищаем предыдущий результат\r\n+            self.result_label.setText(\"\")\r\n+        elif state == \"processing\":\r\n+            self.status_label.setText(\"Обработка...\")\r\n+        elif state == \"ready\":\r\n+            self.status_label.setText(\"Готово\")\r\n+            QTimer.singleShot(1000, lambda: self.set_state(\"idle\"))\r\n+        elif state == \"error\":\r\n+            self.status_label.setText(\"Ошибка\")\r\n+        else:\r\n+            self.status_label.setText(state)\r\n+\r\n+        # иконка микрофона\r\n+        # Логика:\r\n+        #   idle       -> серый микрофон (если есть PNG), иначе системная иконка\r\n+        #   recording  -> КРАСНЫЙ микрофон (если есть PNG), иначе системная иконка\r\n+        #   processing -> отдельная PNG (если есть), иначе системная иконка\r\n+        from PyQt6.QtWidgets import QApplication, QStyle\r\n+\r\n+        def _set_system_icon() -> None:\r\n+            app = QApplication.instance()\r\n+            if app is not None and app.style() is not None:\r\n+                sys_icon = app.style().standardIcon(QStyle.StandardPixmap.SP_MediaVolume)\r\n+                if not sys_icon.isNull():\r\n+                    self.icon_label.setPixmap(sys_icon.pixmap(24, 24))\r\n+\r\n+        if state == \"recording\" and self._icon_recording:\r\n+            self.icon_label.setPixmap(self._icon_recording)\r\n+        elif state == \"processing\" and self._icon_processing:\r\n+            self.icon_label.setPixmap(self._icon_processing)\r\n+        elif self._icon_idle:\r\n+            self.icon_label.setPixmap(self._icon_idle)\r\n+        else:\r\n+            # если PNG-иконок нет — показываем системную иконку, чтобы не было пустоты\r\n+            _set_system_icon()\r\n+\r\n+        # применяем текущий режим (compact/normal)\r\n+        self._apply_compact_mode()\r\n+\r\n+    def set_compact(self, compact: bool) -> None:\r\n+        \"\"\"Переключение между большим окном и компактным микрофоном.\"\"\"\r\n+        self._compact = compact\r\n+        self._apply_compact_mode()\r\n+\r\n+    def _apply_compact_mode(self) -> None:\r\n+        \"\"\"\r\n+        Компактный режим = узкая полоска с иконкой микрофона и маленькой\r\n+        кнопкой-разворачивателем.\r\n+\r\n+        - Высота маленькая (например, 32 px).\r\n+        - Ширина фиксированная (например, 160 px).\r\n+        - Показываем icon_label + compact_button, остальное скрываем.\r\n+        \"\"\"\r\n+        if self._compact:\r\n+            # компактный режим: узкая полоска\r\n+            # Показываем только иконку микрофона и кнопку разворота.\r\n+            self.status_label.setVisible(False)\r\n+            self.result_label.setVisible(False)\r\n+\r\n+            # скрываем все верхние кнопки, кроме компакт‑кнопки\r\n+            self.menu_button_main.setVisible(False)\r\n+            self.close_button_main.setVisible(False)\r\n+            self.menu_button_settings.setVisible(False)\r\n+            self.close_button_settings.setVisible(False)\r\n+\r\n+            # в компактном режиме показываем только одну кнопку \"▣\"\r\n+            self.compact_button_main.setVisible(True)\r\n+            self.compact_button_settings.setVisible(True)\r\n+            self.compact_button_main.setText(\"▣\")\r\n+            self.compact_button_settings.setText(\"▣\")\r\n+\r\n+            # иконка микрофона всегда видна\r\n+            self.icon_label.setVisible(True)\r\n+\r\n+            # высота полоски\r\n+            height = 32\r\n+            width = 160\r\n+            self.setFixedSize(width, height)\r\n+        else:\r\n+            # нормальный режим: всё видно\r\n+            self.status_label.setVisible(True)\r\n+            self.result_label.setVisible(True)\r\n+\r\n+            self.menu_button_main.setVisible(True)\r\n+            self.close_button_main.setVisible(True)\r\n+            self.menu_button_settings.setVisible(True)\r\n+            self.close_button_settings.setVisible(True)\r\n+\r\n+            self.compact_button_main.setVisible(True)\r\n+            self.compact_button_settings.setVisible(True)\r\n+            self.compact_button_main.setText(\"▢\")  # кнопка свернуть\r\n+            self.compact_button_settings.setText(\"▢\")\r\n+\r\n+            # иконка микрофона тоже видна\r\n+            self.icon_label.setVisible(True)\r\n+            w, h = self._ui_config.window_size\r\n+            self.setFixedSize(w, h)\r\n+\r\n+    def show_message(self, text: str, timeout_ms: int = 2000) -> None:\r\n+        self.status_label.setText(text)\r\n+        if timeout_ms > 0:\r\n+            QTimer.singleShot(timeout_ms, lambda: self.set_state(self._state))\r\n+\r\n+    # ------------------------------------------------------------------ settings mode\r\n+\r\n+    def _enter_settings_mode(self) -> None:\r\n+        \"\"\"Показать панель настроек внутри этого же окна.\"\"\"\r\n+        from config.settings import AppSettings  # только для типа, настройки приходят из App\r\n+\r\n+        self._content_mode = \"settings\"\r\n+        self._stack.setCurrentIndex(1)\r\n+\r\n+    def leave_settings_mode(self) -> None:\r\n+        \"\"\"Вернуться в основной режим отображения.\"\"\"\r\n+        self._content_mode = \"main\"\r\n+        self._stack.setCurrentIndex(0)\r\n+\r\n+    def _on_settings_save_clicked(self) -> None:\r\n+        \"\"\"\r\n+        Сигнал наверх о том, что пользователь хочет сохранить настройки.\r\n+        Здесь только выходим из режима настроек; само сохранение делает App.\r\n+        \"\"\"\r\n+        # Просто вернёмся в основной режим; App уже получил новые значения через signals/slots,\r\n+        # которые мы добавим на следующем шаге, если потребуется.\r\n+        self.leave_settings_mode()\r\n+\r\n+    def _on_settings_cancel_clicked(self) -> None:\r\n+        \"\"\"Отмена изменений и возврат в основной режим.\"\"\"\r\n+        self.leave_settings_mode()\r\n+\r\n+    # ------------------------------------------------------------------ events\r\n+\r\n+    def _on_menu_clicked(self) -> None:\r\n+        # Переключить содержимое на панель настроек в том же окне\r\n+        self._enter_settings_mode()\r\n+\r\n+    def _on_compact_clicked(self) -> None:\r\n+        # Переключить режим окна\r\n+        self.set_compact(not self._compact)\r\n+        self.toggle_compact_requested.emit()\r\n+\r\n+    def _on_close_clicked(self) -> None:\r\n+        # Кнопка закрытия: сигнал наверх (App решает — выйти или скрыть окно)\r\n+        self.exit_requested.emit()\r\n+\r\n+    def mousePressEvent(self, event: QMouseEvent) -> None:\r\n+        if event.button() == Qt.MouseButton.LeftButton:\r\n+            self._drag_position = event.globalPosition().toPoint() - self.frameGeometry().topLeft()\r\n+            event.accept()\r\n+        super().mousePressEvent(event)\r\n+\r\n+    def mouseMoveEvent(self, event: QMouseEvent) -> None:\r\n+        if event.buttons() & Qt.MouseButton.LeftButton and self._drag_position is not None:\r\n+            self.move(event.globalPosition().toPoint() - self._drag_position)\r\n+            event.accept()\r\n+        super().mouseMoveEvent(event)\r\n+\r\n+    def mouseReleaseEvent(self, event: QMouseEvent) -> None:\r\n+        self._drag_position = None\r\n+        super().mouseReleaseEvent(event)\r\n+\r\n+    def mouseDoubleClickEvent(self, event: QMouseEvent) -> None:\r\n+        if event.button() == Qt.MouseButton.LeftButton:\r\n+            # двойной клик по окну — тоже открыть настройки\r\n+            self._enter_settings_mode()\r\n+        super().mouseDoubleClickEvent(event)\n\\ No newline at end of file\n"
                },
                {
                    "date": 1764297131967,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,9 +3,9 @@\n from pathlib import Path\r\n from typing import Optional\r\n \r\n from PyQt6.QtCore import QPoint, Qt, QTimer, pyqtSignal\r\n-from PyQt6.QtGui import QIcon, QMouseEvent, QPixmap\r\n+from PyQt6.QtGui import QMouseEvent\r\n from PyQt6.QtWidgets import (\r\n     QLabel,\r\n     QHBoxLayout,\r\n     QVBoxLayout,\r\n@@ -47,13 +47,8 @@\n         self._drag_position: Optional[QPoint] = None\r\n         self._state: str = \"idle\"\r\n         self._compact: bool = False\r\n \r\n-        # иконки микрофона\r\n-        self._icon_idle: Optional[QPixmap] = None\r\n-        self._icon_recording: Optional[QPixmap] = None\r\n-        self._icon_processing: Optional[QPixmap] = None\r\n-\r\n         # режимы содержимого: \"main\" (основной) / \"settings\" (панель настроек)\r\n         self._content_mode: str = \"main\"\r\n \r\n         self._init_window_flags()\r\n@@ -219,25 +214,12 @@\n             \"\"\"\r\n         )\r\n \r\n     def _load_icons(self) -> None:\r\n-        \"\"\"Загружаем иконки микрофона, если они есть в assets/icons.\"\"\"\r\n-        icons_dir = Path(\"assets/icons\")\r\n-        idle_path = icons_dir / \"mic_idle.png\"\r\n-        rec_path = icons_dir / \"mic_recording.png\"\r\n-        proc_path = icons_dir / \"mic_processing.png\"\r\n+        \"\"\"Иконки из файлов больше не используются — всё на эмодзи.\"\"\"\r\n+        # Оставлено на будущее, если понадобится системная иконка окна.\r\n+        return\r\n \r\n-        if idle_path.exists():\r\n-            self._icon_idle = QPixmap(str(idle_path))\r\n-        if rec_path.exists():\r\n-            self._icon_recording = QPixmap(str(rec_path))\r\n-        if proc_path.exists():\r\n-            self._icon_processing = QPixmap(str(proc_path))\r\n-\r\n-        app_icon_path = icons_dir / \"app_icon.ico\"\r\n-        if app_icon_path.exists():\r\n-            self.setWindowIcon(QIcon(str(app_icon_path)))\r\n-\r\n     def _apply_config(self) -> None:\r\n         w, h = self._ui_config.window_size\r\n         self.resize(w, h)\r\n         self.setWindowOpacity(self._ui_config.opacity)\r\n@@ -248,49 +230,30 @@\n \r\n     def set_state(self, state: str) -> None:\r\n         self._state = state\r\n \r\n-        # текст статуса\r\n+        # статус и иконка только через эмодзи\r\n         if state == \"idle\":\r\n-            self.status_label.setText(\"Готово\")\r\n+            self.status_label.setText(\"\")\r\n+            self.icon_label.setText(\"🎙️\")\r\n         elif state == \"recording\":\r\n-            self.status_label.setText(\"Запись...\")\r\n-            # во время записи очищаем предыдущий результат\r\n+            self.status_label.setText(\"🎙️\")\r\n             self.result_label.setText(\"\")\r\n+            self.icon_label.setText(\"🔴🎙️\")\r\n         elif state == \"processing\":\r\n-            self.status_label.setText(\"Обработка...\")\r\n+            self.status_label.setText(\"⏳\")\r\n+            self.icon_label.setText(\"⏳🎙️\")\r\n         elif state == \"ready\":\r\n-            self.status_label.setText(\"Готово\")\r\n+            self.status_label.setText(\"✅\")\r\n+            self.icon_label.setText(\"🎙️\")\r\n             QTimer.singleShot(1000, lambda: self.set_state(\"idle\"))\r\n         elif state == \"error\":\r\n-            self.status_label.setText(\"Ошибка\")\r\n+            self.status_label.setText(\"⚠️\")\r\n+            self.icon_label.setText(\"⚠️🎙️\")\r\n         else:\r\n-            self.status_label.setText(state)\r\n+            self.status_label.setText(\"\")\r\n+            self.icon_label.setText(\"🎙️\")\r\n \r\n-        # иконка микрофона\r\n-        # Логика:\r\n-        #   idle       -> серый микрофон (если есть PNG), иначе системная иконка\r\n-        #   recording  -> КРАСНЫЙ микрофон (если есть PNG), иначе системная иконка\r\n-        #   processing -> отдельная PNG (если есть), иначе системная иконка\r\n-        from PyQt6.QtWidgets import QApplication, QStyle\r\n-\r\n-        def _set_system_icon() -> None:\r\n-            app = QApplication.instance()\r\n-            if app is not None and app.style() is not None:\r\n-                sys_icon = app.style().standardIcon(QStyle.StandardPixmap.SP_MediaVolume)\r\n-                if not sys_icon.isNull():\r\n-                    self.icon_label.setPixmap(sys_icon.pixmap(24, 24))\r\n-\r\n-        if state == \"recording\" and self._icon_recording:\r\n-            self.icon_label.setPixmap(self._icon_recording)\r\n-        elif state == \"processing\" and self._icon_processing:\r\n-            self.icon_label.setPixmap(self._icon_processing)\r\n-        elif self._icon_idle:\r\n-            self.icon_label.setPixmap(self._icon_idle)\r\n-        else:\r\n-            # если PNG-иконок нет — показываем системную иконку, чтобы не было пустоты\r\n-            _set_system_icon()\r\n-\r\n         # применяем текущий режим (compact/normal)\r\n         self._apply_compact_mode()\r\n \r\n     def set_compact(self, compact: bool) -> None:\r\n"
                },
                {
                    "date": 1764297549254,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -67,42 +67,35 @@\n         )\r\n         self.setAttribute(Qt.WidgetAttribute.WA_TranslucentBackground, True)\r\n \r\n     def _init_ui(self) -> None:\r\n-        # верхняя панель (общая логика, НО отдельные экземпляры кнопок для каждой страницы)\r\n-        # --- кнопки для основной страницы ---\r\n-        self.menu_button_main = QPushButton(\"⚙\")\r\n-        self.menu_button_main.setFixedSize(24, 24)\r\n-        self.menu_button_main.clicked.connect(self._on_menu_clicked)\r\n+        # верхняя панель (один набор кнопок для всех режимов)\r\n+        self.menu_button = QPushButton(\"⚙️\")\r\n+        self.menu_button.setFixedSize(24, 24)\r\n+        self.menu_button.clicked.connect(self._on_menu_clicked)\r\n \r\n-        self.compact_button_main = QPushButton(\"▢\")\r\n-        self.compact_button_main.setFixedSize(24, 24)\r\n-        self.compact_button_main.clicked.connect(self._on_compact_clicked)\r\n+        self.compact_button = QPushButton(\"▢\")\r\n+        self.compact_button.setFixedSize(24, 24)\r\n+        self.compact_button.clicked.connect(self._on_compact_clicked)\r\n \r\n-        self.close_button_main = QPushButton(\"×\")\r\n-        self.close_button_main.setFixedSize(24, 24)\r\n-        self.close_button_main.clicked.connect(self._on_close_clicked)\r\n+        self.close_button = QPushButton(\"✖️\")\r\n+        self.close_button.setFixedSize(24, 24)\r\n+        self.close_button.clicked.connect(self._on_close_clicked)\r\n \r\n         top_layout = QHBoxLayout()\r\n-        top_layout.addWidget(self.menu_button_main)\r\n+        top_layout.addWidget(self.menu_button)\r\n         top_layout.addStretch()\r\n-        top_layout.addWidget(self.compact_button_main)\r\n-        top_layout.addWidget(self.close_button_main)\r\n+        top_layout.addWidget(self.compact_button)\r\n+        top_layout.addWidget(self.close_button)\r\n \r\n         # ---------- основное содержимое (режим \"main\") ----------\r\n-        # иконка микрофона\r\n+        # верхняя иконка нам не нужна в обычном режиме — используем только для компактного\r\n         self.icon_label = QLabel()\r\n         self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n+        self.icon_label.setText(\"🎙️\")\r\n+        self.icon_label.setStyleSheet(\"font-size: 20pt;\")\r\n+        self.icon_label.setVisible(False)\r\n \r\n-        # ДЕФОЛТ: системная иконка микрофона/аудио, чтобы всегда что‑то было видно\r\n-        from PyQt6.QtWidgets import QApplication, QStyle\r\n-\r\n-        app = QApplication.instance()\r\n-        if app is not None and app.style() is not None:\r\n-            sys_icon = app.style().standardIcon(QStyle.StandardPixmap.SP_MediaVolume)\r\n-            if not sys_icon.isNull():\r\n-                self.icon_label.setPixmap(sys_icon.pixmap(24, 24))\r\n-\r\n         # текст распознанного результата\r\n         self.result_label = QLabel(\"\")\r\n         self.result_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n         self.result_label.setWordWrap(True)\r\n@@ -152,26 +145,15 @@\n         settings_page = QWidget()\r\n         settings_layout = QVBoxLayout(settings_page)\r\n         settings_layout.setContentsMargins(6, 6, 6, 6)\r\n \r\n-        # отдельные кнопки для страницы настроек\r\n-        self.menu_button_settings = QPushButton(\"⚙\")\r\n-        self.menu_button_settings.setFixedSize(24, 24)\r\n-        self.menu_button_settings.clicked.connect(self._on_menu_clicked)\r\n-\r\n-        self.compact_button_settings = QPushButton(\"▢\")\r\n-        self.compact_button_settings.setFixedSize(24, 24)\r\n-        self.compact_button_settings.clicked.connect(self._on_compact_clicked)\r\n-\r\n-        self.close_button_settings = QPushButton(\"×\")\r\n-        self.close_button_settings.setFixedSize(24, 24)\r\n-        self.close_button_settings.clicked.connect(self._on_close_clicked)\r\n-\r\n+        # для страницы настроек используем тот же top_layout по структуре,\r\n+        # но с отдельным layout‑контейнером\r\n         settings_top_layout = QHBoxLayout()\r\n-        settings_top_layout.addWidget(self.menu_button_settings)\r\n+        settings_top_layout.addWidget(self.menu_button)\r\n         settings_top_layout.addStretch()\r\n-        settings_top_layout.addWidget(self.compact_button_settings)\r\n-        settings_top_layout.addWidget(self.close_button_settings)\r\n+        settings_top_layout.addWidget(self.compact_button)\r\n+        settings_top_layout.addWidget(self.close_button)\r\n \r\n         settings_layout.addLayout(settings_top_layout)\r\n         settings_layout.addLayout(form)\r\n         settings_layout.addLayout(buttons_layout)\r\n@@ -230,30 +212,35 @@\n \r\n     def set_state(self, state: str) -> None:\r\n         self._state = state\r\n \r\n-        # статус и иконка только через эмодзи\r\n+        # обычный режим: только нижний индикатор\r\n         if state == \"idle\":\r\n             self.status_label.setText(\"\")\r\n-            self.icon_label.setText(\"🎙️\")\r\n         elif state == \"recording\":\r\n-            self.status_label.setText(\"🎙️\")\r\n+            self.status_label.setText(\"🔴\")\r\n             self.result_label.setText(\"\")\r\n-            self.icon_label.setText(\"🔴🎙️\")\r\n         elif state == \"processing\":\r\n             self.status_label.setText(\"⏳\")\r\n-            self.icon_label.setText(\"⏳🎙️\")\r\n         elif state == \"ready\":\r\n             self.status_label.setText(\"✅\")\r\n-            self.icon_label.setText(\"🎙️\")\r\n             QTimer.singleShot(1000, lambda: self.set_state(\"idle\"))\r\n         elif state == \"error\":\r\n             self.status_label.setText(\"⚠️\")\r\n-            self.icon_label.setText(\"⚠️🎙️\")\r\n         else:\r\n             self.status_label.setText(\"\")\r\n-            self.icon_label.setText(\"🎙️\")\r\n \r\n+        # компактный режим: одна иконка\r\n+        if self._compact:\r\n+            if state == \"recording\":\r\n+                self.icon_label.setText(\"🔴\")\r\n+            elif state == \"processing\":\r\n+                self.icon_label.setText(\"⏳\")\r\n+            elif state == \"error\":\r\n+                self.icon_label.setText(\"⚠️\")\r\n+            else:\r\n+                self.icon_label.setText(\"🎙️\")\r\n+\r\n         # применяем текущий режим (compact/normal)\r\n         self._apply_compact_mode()\r\n \r\n     def set_compact(self, compact: bool) -> None:\r\n@@ -262,57 +249,33 @@\n         self._apply_compact_mode()\r\n \r\n     def _apply_compact_mode(self) -> None:\r\n         \"\"\"\r\n-        Компактный режим = узкая полоска с иконкой микрофона и маленькой\r\n-        кнопкой-разворачивателем.\r\n-\r\n-        - Высота маленькая (например, 32 px).\r\n-        - Ширина фиксированная (например, 160 px).\r\n-        - Показываем icon_label + compact_button, остальное скрываем.\r\n+        Компактный режим: только одна иконка (эмодзи), без текста.\r\n         \"\"\"\r\n         if self._compact:\r\n-            # компактный режим: узкая полоска\r\n-            # Показываем только иконку микрофона и кнопку разворота.\r\n+            # скрываем всё, кроме иконки\r\n+            self.result_label.setVisible(False)\r\n             self.status_label.setVisible(False)\r\n-            self.result_label.setVisible(False)\r\n \r\n-            # скрываем все верхние кнопки, кроме компакт‑кнопки\r\n-            self.menu_button_main.setVisible(False)\r\n-            self.close_button_main.setVisible(False)\r\n-            self.menu_button_settings.setVisible(False)\r\n-            self.close_button_settings.setVisible(False)\r\n+            self.menu_button.setVisible(False)\r\n+            self.close_button.setVisible(False)\r\n+            self.compact_button.setVisible(False)\r\n \r\n-            # в компактном режиме показываем только одну кнопку \"▣\"\r\n-            self.compact_button_main.setVisible(True)\r\n-            self.compact_button_settings.setVisible(True)\r\n-            self.compact_button_main.setText(\"▣\")\r\n-            self.compact_button_settings.setText(\"▣\")\r\n-\r\n-            # иконка микрофона всегда видна\r\n             self.icon_label.setVisible(True)\r\n-\r\n-            # высота полоски\r\n-            height = 32\r\n-            width = 160\r\n-            self.setFixedSize(width, height)\r\n+            self.setFixedSize(40, 40)\r\n         else:\r\n-            # нормальный режим: всё видно\r\n+            # обычный режим\r\n+            self.result_label.setVisible(True)\r\n             self.status_label.setVisible(True)\r\n-            self.result_label.setVisible(True)\r\n \r\n-            self.menu_button_main.setVisible(True)\r\n-            self.close_button_main.setVisible(True)\r\n-            self.menu_button_settings.setVisible(True)\r\n-            self.close_button_settings.setVisible(True)\r\n+            self.menu_button.setVisible(True)\r\n+            self.close_button.setVisible(True)\r\n+            self.compact_button.setVisible(True)\r\n \r\n-            self.compact_button_main.setVisible(True)\r\n-            self.compact_button_settings.setVisible(True)\r\n-            self.compact_button_main.setText(\"▢\")  # кнопка свернуть\r\n-            self.compact_button_settings.setText(\"▢\")\r\n+            # верхняя иконка в обычном режиме не нужна\r\n+            self.icon_label.setVisible(False)\r\n \r\n-            # иконка микрофона тоже видна\r\n-            self.icon_label.setVisible(True)\r\n             w, h = self._ui_config.window_size\r\n             self.setFixedSize(w, h)\r\n \r\n     def show_message(self, text: str, timeout_ms: int = 2000) -> None:\r\n"
                },
                {
                    "date": 1764299306343,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -81,8 +81,10 @@\n         self.close_button.setFixedSize(24, 24)\r\n         self.close_button.clicked.connect(self._on_close_clicked)\r\n \r\n         top_layout = QHBoxLayout()\r\n+        top_layout.setContentsMargins(4, 4, 4, 4)\r\n+        top_layout.setSpacing(4)\r\n         top_layout.addWidget(self.menu_button)\r\n         top_layout.addStretch()\r\n         top_layout.addWidget(self.compact_button)\r\n         top_layout.addWidget(self.close_button)\r\n@@ -106,8 +108,9 @@\n \r\n         main_page = QWidget()\r\n         main_layout = QVBoxLayout(main_page)\r\n         main_layout.setContentsMargins(6, 6, 6, 6)\r\n+        main_layout.setSpacing(6)\r\n         main_layout.addLayout(top_layout)\r\n         main_layout.addWidget(self.icon_label, alignment=Qt.AlignmentFlag.AlignCenter)\r\n         main_layout.addWidget(self.result_label)\r\n         main_layout.addWidget(self.status_label)\r\n@@ -144,16 +147,30 @@\n \r\n         settings_page = QWidget()\r\n         settings_layout = QVBoxLayout(settings_page)\r\n         settings_layout.setContentsMargins(6, 6, 6, 6)\r\n+        settings_layout.setSpacing(6)\r\n \r\n-        # для страницы настроек используем тот же top_layout по структуре,\r\n-        # но с отдельным layout‑контейнером\r\n+        # отдельная верхняя панель для настроек (своими кнопками)\r\n+        self.settings_menu_button = QPushButton(\"⚙️\")\r\n+        self.settings_menu_button.setFixedSize(24, 24)\r\n+        self.settings_menu_button.clicked.connect(self._on_menu_clicked)\r\n+\r\n+        self.settings_compact_button = QPushButton(\"▢\")\r\n+        self.settings_compact_button.setFixedSize(24, 24)\r\n+        self.settings_compact_button.clicked.connect(self._on_compact_clicked)\r\n+\r\n+        self.settings_close_button = QPushButton(\"✖️\")\r\n+        self.settings_close_button.setFixedSize(24, 24)\r\n+        self.settings_close_button.clicked.connect(self._on_close_clicked)\r\n+\r\n         settings_top_layout = QHBoxLayout()\r\n-        settings_top_layout.addWidget(self.menu_button)\r\n+        settings_top_layout.setContentsMargins(4, 4, 4, 4)\r\n+        settings_top_layout.setSpacing(4)\r\n+        settings_top_layout.addWidget(self.settings_menu_button)\r\n         settings_top_layout.addStretch()\r\n-        settings_top_layout.addWidget(self.compact_button)\r\n-        settings_top_layout.addWidget(self.close_button)\r\n+        settings_top_layout.addWidget(self.settings_compact_button)\r\n+        settings_top_layout.addWidget(self.settings_close_button)\r\n \r\n         settings_layout.addLayout(settings_top_layout)\r\n         settings_layout.addLayout(form)\r\n         settings_layout.addLayout(buttons_layout)\r\n@@ -260,8 +277,14 @@\n             self.menu_button.setVisible(False)\r\n             self.close_button.setVisible(False)\r\n             self.compact_button.setVisible(False)\r\n \r\n+            # кнопки в шапке настроек тоже прячем\r\n+            if hasattr(self, \"settings_menu_button\"):\r\n+                self.settings_menu_button.setVisible(False)\r\n+                self.settings_close_button.setVisible(False)\r\n+                self.settings_compact_button.setVisible(False)\r\n+\r\n             self.icon_label.setVisible(True)\r\n             self.setFixedSize(40, 40)\r\n         else:\r\n             # обычный режим\r\n@@ -271,8 +294,13 @@\n             self.menu_button.setVisible(True)\r\n             self.close_button.setVisible(True)\r\n             self.compact_button.setVisible(True)\r\n \r\n+            if hasattr(self, \"settings_menu_button\"):\r\n+                self.settings_menu_button.setVisible(True)\r\n+                self.settings_close_button.setVisible(True)\r\n+                self.settings_compact_button.setVisible(True)\r\n+\r\n             # верхняя иконка в обычном режиме не нужна\r\n             self.icon_label.setVisible(False)\r\n \r\n             w, h = self._ui_config.window_size\r\n"
                },
                {
                    "date": 1764299655845,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -14,8 +14,9 @@\n     QStackedLayout,\r\n     QComboBox,\r\n     QLineEdit,\r\n     QFormLayout,\r\n+    QCheckBox,\r\n )\r\n \r\n from config.settings import UIConfig\r\n \r\n@@ -127,13 +128,23 @@\n         self.settings_openai_key.setEchoMode(QLineEdit.EchoMode.Password)\r\n \r\n         self.settings_openai_url = QLineEdit()\r\n \r\n+        # постпроцессинг\r\n+        self.postprocess_enabled_checkbox = QCheckBox(\"Включить постпроцессинг\")\r\n+        self.postprocess_enabled_checkbox.setChecked(True)\r\n+\r\n+        self.postprocess_groq_model = QLineEdit()\r\n+        self.postprocess_openai_model = QLineEdit()\r\n+\r\n         form = QFormLayout()\r\n         form.addRow(\"Сервис распознавания:\", self.settings_backend_combo)\r\n         form.addRow(\"Groq API key:\", self.settings_groq_key)\r\n         form.addRow(\"OpenAI API key:\", self.settings_openai_key)\r\n         form.addRow(\"OpenAI Base URL:\", self.settings_openai_url)\r\n+        form.addRow(self.postprocess_enabled_checkbox)\r\n+        form.addRow(\"Groq postprocess model:\", self.postprocess_groq_model)\r\n+        form.addRow(\"OpenAI postprocess model:\", self.postprocess_openai_model)\r\n \r\n         self.settings_save_button = QPushButton(\"Сохранить\")\r\n         self.settings_save_button.clicked.connect(self._on_settings_save_clicked)\r\n \r\n"
                },
                {
                    "date": 1764300300766,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -39,8 +39,9 @@\n \r\n     settings_requested = pyqtSignal()\r\n     exit_requested = pyqtSignal()\r\n     toggle_compact_requested = pyqtSignal()\r\n+    settings_save_requested = pyqtSignal()\r\n \r\n     def __init__(self, ui_config: UIConfig) -> None:\r\n         super().__init__()\r\n \r\n@@ -337,13 +338,15 @@\n         self._stack.setCurrentIndex(0)\r\n \r\n     def _on_settings_save_clicked(self) -> None:\r\n         \"\"\"\r\n-        Сигнал наверх о том, что пользователь хочет сохранить настройки.\r\n-        Здесь только выходим из режима настроек; само сохранение делает App.\r\n+        Пользователь нажал «Сохранить» в панели настроек.\r\n+        Отправляем сигнал наверх (в App), чтобы он:\r\n+        - прочитал значения из полей,\r\n+        - сохранил их в config.yaml,\r\n+        - пересоздал recognizer/postprocessor.\r\n         \"\"\"\r\n-        # Просто вернёмся в основной режим; App уже получил новые значения через signals/slots,\r\n-        # которые мы добавим на следующем шаге, если потребуется.\r\n+        self.settings_save_requested.emit()\r\n         self.leave_settings_mode()\r\n \r\n     def _on_settings_cancel_clicked(self) -> None:\r\n         \"\"\"Отмена изменений и возврат в основной режим.\"\"\"\r\n"
                },
                {
                    "date": 1764300737384,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -132,8 +132,10 @@\n \r\n         # постпроцессинг\r\n         self.postprocess_enabled_checkbox = QCheckBox(\"Включить постпроцессинг\")\r\n         self.postprocess_enabled_checkbox.setChecked(True)\r\n+        # сделать текст чекбокса белым, как у остальных QLabel\r\n+        self.postprocess_enabled_checkbox.setStyleSheet(\"color: white;\")\r\n \r\n         self.postprocess_groq_model = QLineEdit()\r\n         self.postprocess_openai_model = QLineEdit()\r\n \r\n"
                },
                {
                    "date": 1764302541666,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -327,11 +327,14 @@\n \r\n     # ------------------------------------------------------------------ settings mode\r\n \r\n     def _enter_settings_mode(self) -> None:\r\n-        \"\"\"Показать панель настроек внутри этого же окна.\"\"\"\r\n-        from config.settings import AppSettings  # только для типа, настройки приходят из App\r\n+        \"\"\"Показать панель настроек внутри этого же окна.\r\n \r\n+        ВАЖНО: здесь мы не читаем config.yaml и не трогаем AppSettings.\r\n+        Все реальные значения (backend, ключи, модели) заполняет App.open_settings_dialog().\r\n+        Эта функция только переключает страницу.\r\n+        \"\"\"\r\n         self._content_mode = \"settings\"\r\n         self._stack.setCurrentIndex(1)\r\n \r\n     def leave_settings_mode(self) -> None:\r\n"
                },
                {
                    "date": 1764302629693,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -359,409 +359,21 @@\n \r\n     # ------------------------------------------------------------------ events\r\n \r\n     def _on_menu_clicked(self) -> None:\r\n-        # Переключить содержимое на панель настроек в том же окне\r\n-        self._enter_settings_mode()\r\n-\r\n-    def _on_compact_clicked(self) -> None:\r\n-        # Переключить режим окна\r\n-        self.set_compact(not self._compact)\r\n-        self.toggle_compact_requested.emit()\r\n-\r\n-    def _on_close_clicked(self) -> None:\r\n-        # Кнопка закрытия: сигнал наверх (App решает — выйти или скрыть окно)\r\n-        self.exit_requested.emit()\r\n-\r\n-    def mousePressEvent(self, event: QMouseEvent) -> None:\r\n-        if event.button() == Qt.MouseButton.LeftButton:\r\n-            self._drag_position = event.globalPosition().toPoint() - self.frameGeometry().topLeft()\r\n-            event.accept()\r\n-        super().mousePressEvent(event)\r\n-\r\n-    def mouseMoveEvent(self, event: QMouseEvent) -> None:\r\n-        if event.buttons() & Qt.MouseButton.LeftButton and self._drag_position is not None:\r\n-            self.move(event.globalPosition().toPoint() - self._drag_position)\r\n-            event.accept()\r\n-        super().mouseMoveEvent(event)\r\n-\r\n-    def mouseReleaseEvent(self, event: QMouseEvent) -> None:\r\n-        self._drag_position = None\r\n-        super().mouseReleaseEvent(event)\r\n-\r\n-    def mouseDoubleClickEvent(self, event: QMouseEvent) -> None:\r\n-        if event.button() == Qt.MouseButton.LeftButton:\r\n-            # двойной клик по окну — тоже открыть настройки\r\n-            self._enter_settings_mode()\r\n-        super().mouseDoubleClickEvent(event)\n-from __future__ import annotations\r\n-\r\n-from pathlib import Path\r\n-from typing import Optional\r\n-\r\n-from PyQt6.QtCore import QPoint, Qt, QTimer, pyqtSignal\r\n-from PyQt6.QtGui import QIcon, QMouseEvent, QPixmap\r\n-from PyQt6.QtWidgets import (\r\n-    QLabel,\r\n-    QHBoxLayout,\r\n-    QVBoxLayout,\r\n-    QWidget,\r\n-    QPushButton,\r\n-    QStackedLayout,\r\n-    QComboBox,\r\n-    QLineEdit,\r\n-    QFormLayout,\r\n-)\r\n-\r\n-from config.settings import UIConfig\r\n-\r\n-\r\n-class FloatingWindow(QWidget):\r\n-    \"\"\"\r\n-    Главное плавающее окно VoiceCapture.\r\n-\r\n-    Режимы:\r\n-        - normal  — большое окно с текстом и кнопками\r\n-        - compact — маленький \"висячий микрофон\"\r\n-\r\n-    Состояния:\r\n-        - idle\r\n-        - recording\r\n-        - processing\r\n-        - ready\r\n-        - error\r\n-    \"\"\"\r\n-\r\n-    settings_requested = pyqtSignal()\r\n-    exit_requested = pyqtSignal()\r\n-    toggle_compact_requested = pyqtSignal()\r\n-\r\n-    def __init__(self, ui_config: UIConfig) -> None:\r\n-        super().__init__()\r\n-\r\n-        self._ui_config = ui_config\r\n-        self._drag_position: Optional[QPoint] = None\r\n-        self._state: str = \"idle\"\r\n-        self._compact: bool = False\r\n-\r\n-        # иконки микрофона\r\n-        self._icon_idle: Optional[QPixmap] = None\r\n-        self._icon_recording: Optional[QPixmap] = None\r\n-        self._icon_processing: Optional[QPixmap] = None\r\n-\r\n-        # режимы содержимого: \"main\" (основной) / \"settings\" (панель настроек)\r\n-        self._content_mode: str = \"main\"\r\n-\r\n-        self._init_window_flags()\r\n-        self._init_ui()\r\n-        self._load_icons()\r\n-        self._apply_config()\r\n-        self.set_state(\"idle\")\r\n-\r\n-    # ------------------------------------------------------------------ setup\r\n-\r\n-    def _init_window_flags(self) -> None:\r\n-        self.setWindowFlags(\r\n-            Qt.WindowType.FramelessWindowHint\r\n-            | Qt.WindowType.WindowStaysOnTopHint\r\n-            | Qt.WindowType.Tool\r\n-        )\r\n-        self.setAttribute(Qt.WidgetAttribute.WA_TranslucentBackground, True)\r\n-\r\n-    def _init_ui(self) -> None:\r\n-        # верхняя панель (общая для всех режимов)\r\n-        self.menu_button = QPushButton(\"⚙\")\r\n-        self.menu_button.setFixedSize(24, 24)\r\n-        self.menu_button.clicked.connect(self._on_menu_clicked)\r\n-\r\n-        self.compact_button = QPushButton(\"▢\")\r\n-        self.compact_button.setFixedSize(24, 24)\r\n-        self.compact_button.clicked.connect(self._on_compact_clicked)\r\n-\r\n-        self.close_button = QPushButton(\"×\")\r\n-        self.close_button.setFixedSize(24, 24)\r\n-        self.close_button.clicked.connect(self._on_close_clicked)\r\n-\r\n-        # ВАЖНО: top_layout используется ТОЛЬКО в main_page.\r\n-        # Для settings_page создадим отдельный layout, чтобы избежать\r\n-        # предупреждения \"layout already has a parent\".\r\n-        top_layout = QHBoxLayout()\r\n-        top_layout.addWidget(self.menu_button)\r\n-        top_layout.addStretch()\r\n-        top_layout.addWidget(self.compact_button)\r\n-        top_layout.addWidget(self.close_button)\r\n-\r\n-        # ---------- основное содержимое (режим \"main\") ----------\r\n-        # иконка микрофона\r\n-        self.icon_label = QLabel()\r\n-        self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n-\r\n-        # ДЕФОЛТ: системная иконка микрофона/аудио, чтобы всегда что‑то было видно\r\n-        from PyQt6.QtWidgets import QApplication, QStyle\r\n-\r\n-        app = QApplication.instance()\r\n-        if app is not None and app.style() is not None:\r\n-            sys_icon = app.style().standardIcon(QStyle.StandardPixmap.SP_MediaVolume)\r\n-            if not sys_icon.isNull():\r\n-                self.icon_label.setPixmap(sys_icon.pixmap(24, 24))\r\n-\r\n-        # текст распознанного результата\r\n-        self.result_label = QLabel(\"\")\r\n-        self.result_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n-        self.result_label.setWordWrap(True)\r\n-\r\n-        # текст статуса\r\n-        self.status_label = QLabel(\"\")\r\n-        self.status_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n-\r\n-        main_page = QWidget()\r\n-        main_layout = QVBoxLayout(main_page)\r\n-        main_layout.setContentsMargins(6, 6, 6, 6)\r\n-        main_layout.addLayout(top_layout)\r\n-        main_layout.addWidget(self.icon_label, alignment=Qt.AlignmentFlag.AlignCenter)\r\n-        main_layout.addWidget(self.result_label)\r\n-        main_layout.addWidget(self.status_label)\r\n-\r\n-        # ---------- панель настроек (режим \"settings\") ----------\r\n-        self.settings_backend_combo = QComboBox()\r\n-        self.settings_backend_combo.addItem(\"Groq\", userData=\"groq\")\r\n-        self.settings_backend_combo.addItem(\"OpenAI\", userData=\"openai\")\r\n-\r\n-        self.settings_groq_key = QLineEdit()\r\n-        self.settings_groq_key.setEchoMode(QLineEdit.EchoMode.Password)\r\n-\r\n-        self.settings_openai_key = QLineEdit()\r\n-        self.settings_openai_key.setEchoMode(QLineEdit.EchoMode.Password)\r\n-\r\n-        self.settings_openai_url = QLineEdit()\r\n-\r\n-        form = QFormLayout()\r\n-        form.addRow(\"Сервис распознавания:\", self.settings_backend_combo)\r\n-        form.addRow(\"Groq API key:\", self.settings_groq_key)\r\n-        form.addRow(\"OpenAI API key:\", self.settings_openai_key)\r\n-        form.addRow(\"OpenAI Base URL:\", self.settings_openai_url)\r\n-\r\n-        self.settings_save_button = QPushButton(\"Сохранить\")\r\n-        self.settings_save_button.clicked.connect(self._on_settings_save_clicked)\r\n-\r\n-        self.settings_cancel_button = QPushButton(\"Отмена\")\r\n-        self.settings_cancel_button.clicked.connect(self._on_settings_cancel_clicked)\r\n-\r\n-        buttons_layout = QHBoxLayout()\r\n-        buttons_layout.addStretch()\r\n-        buttons_layout.addWidget(self.settings_save_button)\r\n-        buttons_layout.addWidget(self.settings_cancel_button)\r\n-\r\n-        settings_page = QWidget()\r\n-        settings_layout = QVBoxLayout(settings_page)\r\n-        settings_layout.setContentsMargins(6, 6, 6, 6)\r\n-\r\n-        # отдельный top‑layout для страницы настроек\r\n-        settings_top_layout = QHBoxLayout()\r\n-        settings_top_layout.addWidget(self.menu_button)\r\n-        settings_top_layout.addStretch()\r\n-        settings_top_layout.addWidget(self.compact_button)\r\n-        settings_top_layout.addWidget(self.close_button)\r\n-\r\n-        settings_layout.addLayout(settings_top_layout)\r\n-        settings_layout.addLayout(form)\r\n-        settings_layout.addLayout(buttons_layout)\r\n-\r\n-        # ---------- стек страниц ----------\r\n-        self._stack = QStackedLayout()\r\n-        self._stack.addWidget(main_page)      # index 0: main\r\n-        self._stack.addWidget(settings_page)  # index 1: settings\r\n-\r\n-        container = QWidget()\r\n-        container.setLayout(self._stack)\r\n-        container.setObjectName(\"container\")\r\n-\r\n-        root_layout = QVBoxLayout(self)\r\n-        root_layout.setContentsMargins(0, 0, 0, 0)\r\n-        root_layout.addWidget(container)\r\n-\r\n-        self._apply_styles()\r\n-\r\n-    def _apply_styles(self) -> None:\r\n-        self.setStyleSheet(\r\n-            \"\"\"\r\n-            QWidget#container {\r\n-                background-color: rgba(30, 30, 30, 230);\r\n-                border-radius: 10px;\r\n-            }\r\n-            QLabel {\r\n-                color: white;\r\n-                font-size: 10pt;\r\n-            }\r\n-            QPushButton {\r\n-                background: transparent;\r\n-                color: white;\r\n-                border: none;\r\n-                font-size: 11pt;\r\n-            }\r\n-            QPushButton:hover {\r\n-                color: #00bcd4;\r\n-            }\r\n-            \"\"\"\r\n-        )\r\n-\r\n-    def _load_icons(self) -> None:\r\n-        \"\"\"Загружаем иконки микрофона, если они есть в assets/icons.\"\"\"\r\n-        icons_dir = Path(\"assets/icons\")\r\n-        idle_path = icons_dir / \"mic_idle.png\"\r\n-        rec_path = icons_dir / \"mic_recording.png\"\r\n-        proc_path = icons_dir / \"mic_processing.png\"\r\n-\r\n-        if idle_path.exists():\r\n-            self._icon_idle = QPixmap(str(idle_path))\r\n-        if rec_path.exists():\r\n-            self._icon_recording = QPixmap(str(rec_path))\r\n-        if proc_path.exists():\r\n-            self._icon_processing = QPixmap(str(proc_path))\r\n-\r\n-        app_icon_path = icons_dir / \"app_icon.ico\"\r\n-        if app_icon_path.exists():\r\n-            self.setWindowIcon(QIcon(str(app_icon_path)))\r\n-\r\n-    def _apply_config(self) -> None:\r\n-        w, h = self._ui_config.window_size\r\n-        self.resize(w, h)\r\n-        self.setWindowOpacity(self._ui_config.opacity)\r\n-        if self._ui_config.always_on_top:\r\n-            self.setWindowFlag(Qt.WindowType.WindowStaysOnTopHint, True)\r\n-\r\n-    # ------------------------------------------------------------------ state / mode\r\n-\r\n-    def set_state(self, state: str) -> None:\r\n-        self._state = state\r\n-\r\n-        # текст статуса\r\n-        if state == \"idle\":\r\n-            self.status_label.setText(\"Готово\")\r\n-        elif state == \"recording\":\r\n-            self.status_label.setText(\"Запись...\")\r\n-            # во время записи очищаем предыдущий результат\r\n-            self.result_label.setText(\"\")\r\n-        elif state == \"processing\":\r\n-            self.status_label.setText(\"Обработка...\")\r\n-        elif state == \"ready\":\r\n-            self.status_label.setText(\"Готово\")\r\n-            QTimer.singleShot(1000, lambda: self.set_state(\"idle\"))\r\n-        elif state == \"error\":\r\n-            self.status_label.setText(\"Ошибка\")\r\n-        else:\r\n-            self.status_label.setText(state)\r\n-\r\n-        # иконка микрофона\r\n-        # Логика:\r\n-        #   idle       -> серый микрофон (если есть PNG), иначе системная иконка\r\n-        #   recording  -> КРАСНЫЙ микрофон (если есть PNG), иначе системная иконка\r\n-        #   processing -> отдельная PNG (если есть), иначе системная иконка\r\n-        from PyQt6.QtWidgets import QApplication, QStyle\r\n-\r\n-        def _set_system_icon() -> None:\r\n-            app = QApplication.instance()\r\n-            if app is not None and app.style() is not None:\r\n-                sys_icon = app.style().standardIcon(QStyle.StandardPixmap.SP_MediaVolume)\r\n-                if not sys_icon.isNull():\r\n-                    self.icon_label.setPixmap(sys_icon.pixmap(24, 24))\r\n-\r\n-        if state == \"recording\" and self._icon_recording:\r\n-            self.icon_label.setPixmap(self._icon_recording)\r\n-        elif state == \"processing\" and self._icon_processing:\r\n-            self.icon_label.setPixmap(self._icon_processing)\r\n-        elif self._icon_idle:\r\n-            self.icon_label.setPixmap(self._icon_idle)\r\n-        else:\r\n-            # если PNG-иконок нет — показываем системную иконку, чтобы не было пустоты\r\n-            _set_system_icon()\r\n-\r\n-        # применяем текущий режим (compact/normal)\r\n-        self._apply_compact_mode()\r\n-\r\n-    def set_compact(self, compact: bool) -> None:\r\n-        \"\"\"Переключение между большим окном и компактным микрофоном.\"\"\"\r\n-        self._compact = compact\r\n-        self._apply_compact_mode()\r\n-\r\n-    def _apply_compact_mode(self) -> None:\r\n         \"\"\"\r\n-        Компактный режим = узкая полоска с иконкой микрофона и маленькой\r\n-        кнопкой-разворачивателем.\r\n+        Клик по иконке ⚙️.\r\n \r\n-        - Высота маленькая (например, 32 px).\r\n-        - Ширина фиксированная (например, 160 px).\r\n-        - Показываем icon_label + compact_button, остальное скрываем.\r\n-        \"\"\"\r\n-        if self._compact:\r\n-            # компактный режим: узкая полоска\r\n-            # Показываем только иконку микрофона и кнопку разворота.\r\n-            self.status_label.setVisible(False)\r\n-            self.result_label.setVisible(False)\r\n-            self.menu_button.setVisible(False)\r\n-            self.close_button.setVisible(False)\r\n+        Раньше окно само переключалось в режим настроек, из-за чего поля\r\n+        не заполнялись значениями из config.yaml.\r\n \r\n-            # в компактном режиме кнопка показывает значок \"▣\" (развернуть)\r\n-            self.compact_button.setVisible(True)\r\n-            self.compact_button.setText(\"▣\")\r\n-            # иконка микрофона всегда видна\r\n-            self.icon_label.setVisible(True)\r\n-\r\n-            # высота полоски\r\n-            height = 32\r\n-            width = 160\r\n-            self.setFixedSize(width, height)\r\n-        else:\r\n-            # нормальный режим: всё видно\r\n-            self.status_label.setVisible(True)\r\n-            self.result_label.setVisible(True)\r\n-            self.menu_button.setVisible(True)\r\n-            self.close_button.setVisible(True)\r\n-            self.compact_button.setVisible(True)\r\n-            self.compact_button.setText(\"▢\")  # кнопка свернуть\r\n-            # иконка микрофона тоже видна\r\n-            self.icon_label.setVisible(True)\r\n-            w, h = self._ui_config.window_size\r\n-            self.setFixedSize(w, h)\r\n-\r\n-    def show_message(self, text: str, timeout_ms: int = 2000) -> None:\r\n-        self.status_label.setText(text)\r\n-        if timeout_ms > 0:\r\n-            QTimer.singleShot(timeout_ms, lambda: self.set_state(self._state))\r\n-\r\n-    # ------------------------------------------------------------------ settings mode\r\n-\r\n-    def _enter_settings_mode(self) -> None:\r\n-        \"\"\"Показать панель настроек внутри этого же окна.\"\"\"\r\n-        from config.settings import AppSettings  # только для типа, настройки приходят из App\r\n-\r\n-        self._content_mode = \"settings\"\r\n-        self._stack.setCurrentIndex(1)\r\n-\r\n-    def leave_settings_mode(self) -> None:\r\n-        \"\"\"Вернуться в основной режим отображения.\"\"\"\r\n-        self._content_mode = \"main\"\r\n-        self._stack.setCurrentIndex(0)\r\n-\r\n-    def _on_settings_save_clicked(self) -> None:\r\n+        Теперь мы просто шлём сигнал наверх (в App), а App.open_settings_dialog():\r\n+        - читает текущий config.yaml через AppSettings,\r\n+        - заполняет все поля (backend, ключи, модели, base_url),\r\n+        - переключает окно в режим настроек.\r\n         \"\"\"\r\n-        Сигнал наверх о том, что пользователь хочет сохранить настройки.\r\n-        Здесь только выходим из режима настроек; само сохранение делает App.\r\n-        \"\"\"\r\n-        # Просто вернёмся в основной режим; App уже получил новые значения через signals/slots,\r\n-        # которые мы добавим на следующем шаге, если потребуется.\r\n-        self.leave_settings_mode()\r\n+        self.settings_requested.emit()\r\n \r\n-    def _on_settings_cancel_clicked(self) -> None:\r\n-        \"\"\"Отмена изменений и возврат в основной режим.\"\"\"\r\n-        self.leave_settings_mode()\r\n-\r\n-    # ------------------------------------------------------------------ events\r\n-\r\n-    def _on_menu_clicked(self) -> None:\r\n-        # Переключить содержимое на панель настроек в том же окне\r\n-        self._enter_settings_mode()\r\n-\r\n     def _on_compact_clicked(self) -> None:\r\n         # Переключить режим окна\r\n         self.set_compact(not self._compact)\r\n         self.toggle_compact_requested.emit()\r\n"
                },
                {
                    "date": 1764303107241,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -95,9 +95,10 @@\n         # верхняя иконка нам не нужна в обычном режиме — используем только для компактного\r\n         self.icon_label = QLabel()\r\n         self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n         self.icon_label.setText(\"🎙️\")\r\n-        self.icon_label.setStyleSheet(\"font-size: 20pt;\")\r\n+        # Чуть уменьшаем размер шрифта, чтобы красная точка не обрезалась\r\n+        self.icon_label.setStyleSheet(\"font-size: 16pt;\")\r\n         self.icon_label.setVisible(False)\r\n \r\n         # текст распознанного результата\r\n         self.result_label = QLabel(\"\")\r\n@@ -281,26 +282,34 @@\n \r\n     def _apply_compact_mode(self) -> None:\r\n         \"\"\"\r\n         Компактный режим: только одна иконка (эмодзи), без текста.\r\n+\r\n+        Требования по UX:\r\n+        - в компактном режиме всё равно должна быть понятная точка возврата;\r\n+        - красная точка записи не должна обрезаться.\r\n         \"\"\"\r\n         if self._compact:\r\n-            # скрываем всё, кроме иконки\r\n+            # скрываем текст, но оставляем маленькую кнопку ▢ для возврата\r\n             self.result_label.setVisible(False)\r\n             self.status_label.setVisible(False)\r\n \r\n+            # в компактном режиме:\r\n+            # - меню и крестик прячем,\r\n+            # - кнопку compact оставляем, чтобы можно было развернуть окно обратно.\r\n             self.menu_button.setVisible(False)\r\n             self.close_button.setVisible(False)\r\n-            self.compact_button.setVisible(False)\r\n+            self.compact_button.setVisible(True)\r\n \r\n-            # кнопки в шапке настроек тоже прячем\r\n+            # кнопки в шапке настроек тоже прячем, кроме compact\r\n             if hasattr(self, \"settings_menu_button\"):\r\n                 self.settings_menu_button.setVisible(False)\r\n                 self.settings_close_button.setVisible(False)\r\n-                self.settings_compact_button.setVisible(False)\r\n+                self.settings_compact_button.setVisible(True)\r\n \r\n             self.icon_label.setVisible(True)\r\n-            self.setFixedSize(40, 40)\r\n+            # чуть увеличиваем компактное окно, чтобы иконка и красная точка не обрезались\r\n+            self.setFixedSize(48, 48)\r\n         else:\r\n             # обычный режим\r\n             self.result_label.setVisible(True)\r\n             self.status_label.setVisible(True)\r\n"
                },
                {
                    "date": 1764303197786,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -281,35 +281,41 @@\n         self._apply_compact_mode()\r\n \r\n     def _apply_compact_mode(self) -> None:\r\n         \"\"\"\r\n-        Компактный режим: только одна иконка (эмодзи), без текста.\r\n+        Компактный режим.\r\n \r\n-        Требования по UX:\r\n-        - в компактном режиме всё равно должна быть понятная точка возврата;\r\n-        - красная точка записи не должна обрезаться.\r\n+        Делаем горизонтальную плашку:\r\n+        [ 🎙️ / 🔴 / ⏳ ]  [ ▢ ]\r\n+\r\n+        - слева — иконка микрофона/статуса,\r\n+        - справа — маленькая кнопка разворота,\r\n+        - без текста, чтобы не загромождать.\r\n         \"\"\"\r\n         if self._compact:\r\n-            # скрываем текст, но оставляем маленькую кнопку ▢ для возврата\r\n+            # скрываем текст\r\n             self.result_label.setVisible(False)\r\n             self.status_label.setVisible(False)\r\n \r\n             # в компактном режиме:\r\n             # - меню и крестик прячем,\r\n-            # - кнопку compact оставляем, чтобы можно было развернуть окно обратно.\r\n+            # - оставляем только кнопку compact (▢) как точку возврата.\r\n             self.menu_button.setVisible(False)\r\n             self.close_button.setVisible(False)\r\n             self.compact_button.setVisible(True)\r\n \r\n-            # кнопки в шапке настроек тоже прячем, кроме compact\r\n+            # в шапке настроек тоже прячем всё, кроме compact\r\n             if hasattr(self, \"settings_menu_button\"):\r\n                 self.settings_menu_button.setVisible(False)\r\n                 self.settings_close_button.setVisible(False)\r\n                 self.settings_compact_button.setVisible(True)\r\n \r\n+            # включаем иконку\r\n             self.icon_label.setVisible(True)\r\n-            # чуть увеличиваем компактное окно, чтобы иконка и красная точка не обрезались\r\n-            self.setFixedSize(48, 48)\r\n+\r\n+            # горизонтальная плашка: иконка слева, кнопка ▢ справа.\r\n+            # Для этого просто задаём размер окна пошире и пониже.\r\n+            self.setFixedSize(80, 32)\r\n         else:\r\n             # обычный режим\r\n             self.result_label.setVisible(True)\r\n             self.status_label.setVisible(True)\r\n"
                },
                {
                    "date": 1764303292624,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -87,8 +87,9 @@\n         top_layout.setContentsMargins(4, 4, 4, 4)\r\n         top_layout.setSpacing(4)\r\n         top_layout.addWidget(self.menu_button)\r\n         top_layout.addStretch()\r\n+        # В обычном режиме: ▢ и ✖️ справа\r\n         top_layout.addWidget(self.compact_button)\r\n         top_layout.addWidget(self.close_button)\r\n \r\n         # ---------- основное содержимое (режим \"main\") ----------\r\n@@ -283,14 +284,13 @@\n     def _apply_compact_mode(self) -> None:\r\n         \"\"\"\r\n         Компактный режим.\r\n \r\n-        Делаем горизонтальную плашку:\r\n+        Горизонтальная плашка:\r\n         [ 🎙️ / 🔴 / ⏳ ]  [ ▢ ]\r\n \r\n         - слева — иконка микрофона/статуса,\r\n-        - справа — маленькая кнопка разворота,\r\n-        - без текста, чтобы не загромождать.\r\n+        - справа — маленькая кнопка разворота.\r\n         \"\"\"\r\n         if self._compact:\r\n             # скрываем текст\r\n             self.result_label.setVisible(False)\r\n@@ -311,11 +311,11 @@\n \r\n             # включаем иконку\r\n             self.icon_label.setVisible(True)\r\n \r\n-            # горизонтальная плашка: иконка слева, кнопка ▢ справа.\r\n-            # Для этого просто задаём размер окна пошире и пониже.\r\n-            self.setFixedSize(80, 32)\r\n+            # Делаем окно чуть выше и шире, чтобы микрофон и ▢\r\n+            # стояли рядом и не слипались.\r\n+            self.setFixedSize(96, 40)\r\n         else:\r\n             # обычный режим\r\n             self.result_label.setVisible(True)\r\n             self.status_label.setVisible(True)\r\n"
                },
                {
                    "date": 1764303370991,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,12 +94,17 @@\n \r\n         # ---------- основное содержимое (режим \"main\") ----------\r\n         # верхняя иконка нам не нужна в обычном режиме — используем только для компактного\r\n         self.icon_label = QLabel()\r\n-        self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n+        # В обычном режиме иконка не видна, но в компактном хотим её\r\n+        # чуть смещённой вправо и вверх. Для этого используем отступы\r\n+        # в layout, а выравнивание оставляем по левому краю/верху.\r\n+        self.icon_label.setAlignment(\r\n+            Qt.AlignmentFlag.AlignLeft | Qt.AlignmentFlag.AlignTop\r\n+        )\r\n         self.icon_label.setText(\"🎙️\")\r\n         # Чуть уменьшаем размер шрифта, чтобы красная точка не обрезалась\r\n-        self.icon_label.setStyleSheet(\"font-size: 16pt;\")\r\n+        self.icon_label.setStyleSheet(\"font-size: 16pt; padding-left: 6px; padding-top: 2px;\")\r\n         self.icon_label.setVisible(False)\r\n \r\n         # текст распознанного результата\r\n         self.result_label = QLabel(\"\")\r\n"
                },
                {
                    "date": 1764303456145,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,17 +94,14 @@\n \r\n         # ---------- основное содержимое (режим \"main\") ----------\r\n         # верхняя иконка нам не нужна в обычном режиме — используем только для компактного\r\n         self.icon_label = QLabel()\r\n-        # В обычном режиме иконка не видна, но в компактном хотим её\r\n-        # чуть смещённой вправо и вверх. Для этого используем отступы\r\n-        # в layout, а выравнивание оставляем по левому краю/верху.\r\n-        self.icon_label.setAlignment(\r\n-            Qt.AlignmentFlag.AlignLeft | Qt.AlignmentFlag.AlignTop\r\n-        )\r\n+        # Держим иконку по центру по вертикали, чуть смещаем вправо паддингом.\r\n+        self.icon_label.setAlignment(Qt.AlignmentFlag.AlignVCenter | Qt.AlignmentFlag.AlignLeft)\r\n         self.icon_label.setText(\"🎙️\")\r\n-        # Чуть уменьшаем размер шрифта, чтобы красная точка не обрезалась\r\n-        self.icon_label.setStyleSheet(\"font-size: 16pt; padding-left: 6px; padding-top: 2px;\")\r\n+        # Чуть уменьшаем размер шрифта и сдвигаем вправо,\r\n+        # без смещения вверх, чтобы иконка не уезжала за границы.\r\n+        self.icon_label.setStyleSheet(\"font-size: 16pt; padding-left: 8px;\")\r\n         self.icon_label.setVisible(False)\r\n \r\n         # текст распознанного результата\r\n         self.result_label = QLabel(\"\")\r\n"
                },
                {
                    "date": 1764303541033,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,14 +94,17 @@\n \r\n         # ---------- основное содержимое (режим \"main\") ----------\r\n         # верхняя иконка нам не нужна в обычном режиме — используем только для компактного\r\n         self.icon_label = QLabel()\r\n-        # Держим иконку по центру по вертикали, чуть смещаем вправо паддингом.\r\n-        self.icon_label.setAlignment(Qt.AlignmentFlag.AlignVCenter | Qt.AlignmentFlag.AlignLeft)\r\n+        # В компактном режиме хотим микрофон чуть левее центра и немного выше.\r\n+        # Используем выравнивание по левому краю + верх и небольшие паддинги.\r\n+        self.icon_label.setAlignment(\r\n+            Qt.AlignmentFlag.AlignTop | Qt.AlignmentFlag.AlignLeft\r\n+        )\r\n         self.icon_label.setText(\"🎙️\")\r\n-        # Чуть уменьшаем размер шрифта и сдвигаем вправо,\r\n-        # без смещения вверх, чтобы иконка не уезжала за границы.\r\n-        self.icon_label.setStyleSheet(\"font-size: 16pt; padding-left: 8px;\")\r\n+        # Попиксельный сдвиг: чуть вправо и чуть вниз от самого верха,\r\n+        # чтобы иконка была \"на переднем плане\" и не пряталась под скругления.\r\n+        self.icon_label.setStyleSheet(\"font-size: 16pt; padding-left: 10px; padding-top: 4px;\")\r\n         self.icon_label.setVisible(False)\r\n \r\n         # текст распознанного результата\r\n         self.result_label = QLabel(\"\")\r\n"
                },
                {
                    "date": 1764303618856,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,17 +94,13 @@\n \r\n         # ---------- основное содержимое (режим \"main\") ----------\r\n         # верхняя иконка нам не нужна в обычном режиме — используем только для компактного\r\n         self.icon_label = QLabel()\r\n-        # В компактном режиме хотим микрофон чуть левее центра и немного выше.\r\n-        # Используем выравнивание по левому краю + верх и небольшие паддинги.\r\n-        self.icon_label.setAlignment(\r\n-            Qt.AlignmentFlag.AlignTop | Qt.AlignmentFlag.AlignLeft\r\n-        )\r\n+        # Возвращаемся к простому и надёжному варианту:\r\n+        # иконка по центру, без смещений, чтобы точно была видна.\r\n+        self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n         self.icon_label.setText(\"🎙️\")\r\n-        # Попиксельный сдвиг: чуть вправо и чуть вниз от самого верха,\r\n-        # чтобы иконка была \"на переднем плане\" и не пряталась под скругления.\r\n-        self.icon_label.setStyleSheet(\"font-size: 16pt; padding-left: 10px; padding-top: 4px;\")\r\n+        self.icon_label.setStyleSheet(\"font-size: 16pt;\")\r\n         self.icon_label.setVisible(False)\r\n \r\n         # текст распознанного результата\r\n         self.result_label = QLabel(\"\")\r\n"
                },
                {
                    "date": 1764303783470,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -312,11 +312,11 @@\n \r\n             # включаем иконку\r\n             self.icon_label.setVisible(True)\r\n \r\n-            # Делаем окно чуть выше и шире, чтобы микрофон и ▢\r\n-            # стояли рядом и не слипались.\r\n-            self.setFixedSize(96, 40)\r\n+            # Увеличиваем окно, чтобы микрофон и ▢ были на одной линии\r\n+            # и ничего не перекрывалось.\r\n+            self.setFixedSize(120, 48)\r\n         else:\r\n             # обычный режим\r\n             self.result_label.setVisible(True)\r\n             self.status_label.setVisible(True)\r\n"
                },
                {
                    "date": 1764303953675,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,13 +94,16 @@\n \r\n         # ---------- основное содержимое (режим \"main\") ----------\r\n         # верхняя иконка нам не нужна в обычном режиме — используем только для компактного\r\n         self.icon_label = QLabel()\r\n-        # Возвращаемся к простому и надёжному варианту:\r\n-        # иконка по центру, без смещений, чтобы точно была видна.\r\n-        self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n+        # В компактном режиме хотим аккуратный микрофон по центру по вертикали,\r\n+        # немного смещённый вправо, чтобы не прилипать к краю.\r\n+        self.icon_label.setAlignment(\r\n+            Qt.AlignmentFlag.AlignVCenter | Qt.AlignmentFlag.AlignLeft\r\n+        )\r\n         self.icon_label.setText(\"🎙️\")\r\n-        self.icon_label.setStyleSheet(\"font-size: 16pt;\")\r\n+        # Чуть уменьшаем размер шрифта и сдвигаем вправо.\r\n+        self.icon_label.setStyleSheet(\"font-size: 14pt; padding-left: 12px;\")\r\n         self.icon_label.setVisible(False)\r\n \r\n         # текст распознанного результата\r\n         self.result_label = QLabel(\"\")\r\n@@ -312,11 +315,11 @@\n \r\n             # включаем иконку\r\n             self.icon_label.setVisible(True)\r\n \r\n-            # Увеличиваем окно, чтобы микрофон и ▢ были на одной линии\r\n-            # и ничего не перекрывалось.\r\n-            self.setFixedSize(120, 48)\r\n+            # Делаем окно достаточно высоким и широким, чтобы\r\n+            # микрофон и красная точка не обрезались и были на одной линии с ▢.\r\n+            self.setFixedSize(140, 60)\r\n         else:\r\n             # обычный режим\r\n             self.result_label.setVisible(True)\r\n             self.status_label.setVisible(True)\r\n"
                },
                {
                    "date": 1764305011603,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -381,16 +381,17 @@\n     def _on_menu_clicked(self) -> None:\r\n         \"\"\"\r\n         Клик по иконке ⚙️.\r\n \r\n-        Раньше окно само переключалось в режим настроек, из-за чего поля\r\n-        не заполнялись значениями из config.yaml.\r\n+        Поведение:\r\n+        - если сейчас основной режим (main) → открыть настройки (как раньше);\r\n+        - если уже открыта панель настроек → свернуть её, как будто нажали «Отмена».\r\n+        \"\"\"\r\n+        if self._content_mode == \"settings\":\r\n+            # Поведение как у кнопки «Отмена»\r\n+            self._on_settings_cancel_clicked()\r\n+            return\r\n \r\n-        Теперь мы просто шлём сигнал наверх (в App), а App.open_settings_dialog():\r\n-        - читает текущий config.yaml через AppSettings,\r\n-        - заполняет все поля (backend, ключи, модели, base_url),\r\n-        - переключает окно в режим настроек.\r\n-        \"\"\"\r\n         self.settings_requested.emit()\r\n \r\n     def _on_compact_clicked(self) -> None:\r\n         # Переключить режим окна\r\n"
                },
                {
                    "date": 1764305146258,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,16 +94,13 @@\n \r\n         # ---------- основное содержимое (режим \"main\") ----------\r\n         # верхняя иконка нам не нужна в обычном режиме — используем только для компактного\r\n         self.icon_label = QLabel()\r\n-        # В компактном режиме хотим аккуратный микрофон по центру по вертикали,\r\n-        # немного смещённый вправо, чтобы не прилипать к краю.\r\n-        self.icon_label.setAlignment(\r\n-            Qt.AlignmentFlag.AlignVCenter | Qt.AlignmentFlag.AlignLeft\r\n-        )\r\n+        # В компактном режиме иконка должна быть строго по центру по вертикали и горизонтали.\r\n+        self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n         self.icon_label.setText(\"🎙️\")\r\n-        # Чуть уменьшаем размер шрифта и сдвигаем вправо.\r\n-        self.icon_label.setStyleSheet(\"font-size: 14pt; padding-left: 12px;\")\r\n+        # Без лишних отступов, только размер шрифта.\r\n+        self.icon_label.setStyleSheet(\"font-size: 16pt;\")\r\n         self.icon_label.setVisible(False)\r\n \r\n         # текст распознанного результата\r\n         self.result_label = QLabel(\"\")\r\n@@ -118,8 +115,9 @@\n         main_layout = QVBoxLayout(main_page)\r\n         main_layout.setContentsMargins(6, 6, 6, 6)\r\n         main_layout.setSpacing(6)\r\n         main_layout.addLayout(top_layout)\r\n+        # В обычном режиме иконка скрыта, в компактном — она по центру.\r\n         main_layout.addWidget(self.icon_label, alignment=Qt.AlignmentFlag.AlignCenter)\r\n         main_layout.addWidget(self.result_label)\r\n         main_layout.addWidget(self.status_label)\r\n \r\n@@ -289,11 +287,11 @@\n         \"\"\"\r\n         Компактный режим.\r\n \r\n         Горизонтальная плашка:\r\n-        [ 🎙️ / 🔴 / ⏳ ]  [ ▢ ]\r\n+        [   🎙️ / 🔴 / ⏳   ]      [ ▢ ]\r\n \r\n-        - слева — иконка микрофона/статуса,\r\n+        - по центру — иконка микрофона/статуса,\r\n         - справа — маленькая кнопка разворота.\r\n         \"\"\"\r\n         if self._compact:\r\n             # скрываем текст\r\n@@ -315,11 +313,11 @@\n \r\n             # включаем иконку\r\n             self.icon_label.setVisible(True)\r\n \r\n-            # Делаем окно достаточно высоким и широким, чтобы\r\n-            # микрофон и красная точка не обрезались и были на одной линии с ▢.\r\n-            self.setFixedSize(140, 60)\r\n+            # Компактное окно: невысокая горизонтальная плашка.\r\n+            # Высота подобрана так, чтобы иконка и ▢ были на одной линии и не обрезались.\r\n+            self.setFixedSize(180, 70)\r\n         else:\r\n             # обычный режим\r\n             self.result_label.setVisible(True)\r\n             self.status_label.setVisible(True)\r\n"
                },
                {
                    "date": 1764306428880,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -101,13 +101,18 @@\n         # Без лишних отступов, только размер шрифта.\r\n         self.icon_label.setStyleSheet(\"font-size: 16pt;\")\r\n         self.icon_label.setVisible(False)\r\n \r\n-        # текст распознанного результата\r\n-        self.result_label = QLabel(\"\")\r\n-        self.result_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n-        self.result_label.setWordWrap(True)\r\n+        # текст распознанного результата (сырой текст от Whisper)\r\n+        self.raw_label = QLabel(\"\")\r\n+        self.raw_label.setAlignment(Qt.AlignmentFlag.AlignLeft)\r\n+        self.raw_label.setWordWrap(True)\r\n \r\n+        # текст после постпроцессинга (LLM / regex)\r\n+        self.processed_label = QLabel(\"\")\r\n+        self.processed_label.setAlignment(Qt.AlignmentFlag.AlignLeft)\r\n+        self.processed_label.setWordWrap(True)\r\n+\r\n         # текст статуса\r\n         self.status_label = QLabel(\"\")\r\n         self.status_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n \r\n@@ -117,9 +122,12 @@\n         main_layout.setSpacing(6)\r\n         main_layout.addLayout(top_layout)\r\n         # В обычном режиме иконка скрыта, в компактном — она по центру.\r\n         main_layout.addWidget(self.icon_label, alignment=Qt.AlignmentFlag.AlignCenter)\r\n-        main_layout.addWidget(self.result_label)\r\n+\r\n+        # Два текста: сверху — сырой, снизу — после постпроцессинга.\r\n+        main_layout.addWidget(self.raw_label)\r\n+        main_layout.addWidget(self.processed_label)\r\n         main_layout.addWidget(self.status_label)\r\n \r\n         # ---------- панель настроек (режим \"settings\") ----------\r\n         self.settings_backend_combo = QComboBox()\r\n@@ -294,9 +302,10 @@\n         - справа — маленькая кнопка разворота.\r\n         \"\"\"\r\n         if self._compact:\r\n             # скрываем текст\r\n-            self.result_label.setVisible(False)\r\n+            self.raw_label.setVisible(False)\r\n+            self.processed_label.setVisible(False)\r\n             self.status_label.setVisible(False)\r\n \r\n             # в компактном режиме:\r\n             # - меню и крестик прячем,\r\n@@ -318,9 +327,10 @@\n             # Высота подобрана так, чтобы иконка и ▢ были на одной линии и не обрезались.\r\n             self.setFixedSize(180, 70)\r\n         else:\r\n             # обычный режим\r\n-            self.result_label.setVisible(True)\r\n+            self.raw_label.setVisible(True)\r\n+            self.processed_label.setVisible(True)\r\n             self.status_label.setVisible(True)\r\n \r\n             self.menu_button.setVisible(True)\r\n             self.close_button.setVisible(True)\r\n@@ -341,8 +351,18 @@\n         self.status_label.setText(text)\r\n         if timeout_ms > 0:\r\n             QTimer.singleShot(timeout_ms, lambda: self.set_state(self._state))\r\n \r\n+    # ------------------------------------------------------------------ text setters\r\n+\r\n+    def set_raw_text(self, text: str) -> None:\r\n+        \"\"\"Показать сырой текст от Whisper (верхний блок).\"\"\"\r\n+        self.raw_label.setText(text or \"\")\r\n+\r\n+    def set_processed_text(self, text: str) -> None:\r\n+        \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n+        self.processed_label.setText(text or \"\")\r\n+\r\n     # ------------------------------------------------------------------ settings mode\r\n \r\n     def _enter_settings_mode(self) -> None:\r\n         \"\"\"Показать панель настроек внутри этого же окна.\r\n"
                },
                {
                    "date": 1764306515437,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -361,8 +361,18 @@\n     def set_processed_text(self, text: str) -> None:\r\n         \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n         self.processed_label.setText(text or \"\")\r\n \r\n+    # ------------------------------------------------------------------ text setters\r\n+\r\n+    def set_raw_text(self, text: str) -> None:\r\n+        \"\"\"Показать сырой текст от Whisper (верхний блок).\"\"\"\r\n+        self.raw_label.setText(text or \"\")\r\n+\r\n+    def set_processed_text(self, text: str) -> None:\r\n+        \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n+        self.processed_label.setText(text or \"\")\r\n+\r\n     # ------------------------------------------------------------------ settings mode\r\n \r\n     def _enter_settings_mode(self) -> None:\r\n         \"\"\"Показать панель настроек внутри этого же окна.\r\n"
                },
                {
                    "date": 1764306592787,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -371,8 +371,18 @@\n     def set_processed_text(self, text: str) -> None:\r\n         \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n         self.processed_label.setText(text or \"\")\r\n \r\n+    # ------------------------------------------------------------------ text setters\r\n+\r\n+    def set_raw_text(self, text: str) -> None:\r\n+        \"\"\"Показать сырой текст от Whisper (верхний блок).\"\"\"\r\n+        self.raw_label.setText(text or \"\")\r\n+\r\n+    def set_processed_text(self, text: str) -> None:\r\n+        \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n+        self.processed_label.setText(text or \"\")\r\n+\r\n     # ------------------------------------------------------------------ settings mode\r\n \r\n     def _enter_settings_mode(self) -> None:\r\n         \"\"\"Показать панель настроек внутри этого же окна.\r\n"
                },
                {
                    "date": 1764306614460,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -381,8 +381,18 @@\n     def set_processed_text(self, text: str) -> None:\r\n         \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n         self.processed_label.setText(text or \"\")\r\n \r\n+    # ------------------------------------------------------------------ text setters\r\n+\r\n+    def set_raw_text(self, text: str) -> None:\r\n+        \"\"\"Показать сырой текст от Whisper (верхний блок).\"\"\"\r\n+        self.raw_label.setText(text or \"\")\r\n+\r\n+    def set_processed_text(self, text: str) -> None:\r\n+        \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n+        self.processed_label.setText(text or \"\")\r\n+\r\n     # ------------------------------------------------------------------ settings mode\r\n \r\n     def _enter_settings_mode(self) -> None:\r\n         \"\"\"Показать панель настроек внутри этого же окна.\r\n"
                },
                {
                    "date": 1764306788674,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,481 @@\n+from __future__ import annotations\r\n+\r\n+from pathlib import Path\r\n+from typing import Optional\r\n+\r\n+from PyQt6.QtCore import QPoint, Qt, QTimer, pyqtSignal\r\n+from PyQt6.QtGui import QMouseEvent\r\n+from PyQt6.QtWidgets import (\r\n+    QLabel,\r\n+    QHBoxLayout,\r\n+    QVBoxLayout,\r\n+    QWidget,\r\n+    QPushButton,\r\n+    QStackedLayout,\r\n+    QComboBox,\r\n+    QLineEdit,\r\n+    QFormLayout,\r\n+    QCheckBox,\r\n+)\r\n+\r\n+from config.settings import UIConfig\r\n+\r\n+\r\n+class FloatingWindow(QWidget):\r\n+    \"\"\"\r\n+    Главное плавающее окно VoiceCapture.\r\n+\r\n+    Режимы:\r\n+        - normal  — большое окно с текстом и кнопками\r\n+        - compact — маленький \"висячий микрофон\"\r\n+\r\n+    Состояния:\r\n+        - idle\r\n+        - recording\r\n+        - processing\r\n+        - ready\r\n+        - error\r\n+    \"\"\"\r\n+\r\n+    settings_requested = pyqtSignal()\r\n+    exit_requested = pyqtSignal()\r\n+    toggle_compact_requested = pyqtSignal()\r\n+    settings_save_requested = pyqtSignal()\r\n+\r\n+    def __init__(self, ui_config: UIConfig) -> None:\r\n+        super().__init__()\r\n+\r\n+        self._ui_config = ui_config\r\n+        self._drag_position: Optional[QPoint] = None\r\n+        self._state: str = \"idle\"\r\n+        self._compact: bool = False\r\n+\r\n+        # режимы содержимого: \"main\" (основной) / \"settings\" (панель настроек)\r\n+        self._content_mode: str = \"main\"\r\n+\r\n+        self._init_window_flags()\r\n+        self._init_ui()\r\n+        self._load_icons()\r\n+        self._apply_config()\r\n+        self.set_state(\"idle\")\r\n+\r\n+    # ------------------------------------------------------------------ setup\r\n+\r\n+    def _init_window_flags(self) -> None:\r\n+        self.setWindowFlags(\r\n+            Qt.WindowType.FramelessWindowHint\r\n+            | Qt.WindowType.WindowStaysOnTopHint\r\n+            | Qt.WindowType.Tool\r\n+        )\r\n+        self.setAttribute(Qt.WidgetAttribute.WA_TranslucentBackground, True)\r\n+\r\n+    def _init_ui(self) -> None:\r\n+        # верхняя панель (один набор кнопок для всех режимов)\r\n+        self.menu_button = QPushButton(\"⚙️\")\r\n+        self.menu_button.setFixedSize(24, 24)\r\n+        self.menu_button.clicked.connect(self._on_menu_clicked)\r\n+\r\n+        self.compact_button = QPushButton(\"▢\")\r\n+        self.compact_button.setFixedSize(24, 24)\r\n+        self.compact_button.clicked.connect(self._on_compact_clicked)\r\n+\r\n+        self.close_button = QPushButton(\"✖️\")\r\n+        self.close_button.setFixedSize(24, 24)\r\n+        self.close_button.clicked.connect(self._on_close_clicked)\r\n+\r\n+        top_layout = QHBoxLayout()\r\n+        top_layout.setContentsMargins(4, 4, 4, 4)\r\n+        top_layout.setSpacing(4)\r\n+        top_layout.addWidget(self.menu_button)\r\n+        top_layout.addStretch()\r\n+        # В обычном режиме: ▢ и ✖️ справа\r\n+        top_layout.addWidget(self.compact_button)\r\n+        top_layout.addWidget(self.close_button)\r\n+\r\n+        # ---------- основное содержимое (режим \"main\") ----------\r\n+        # верхняя иконка нам не нужна в обычном режиме — используем только для компактного\r\n+        self.icon_label = QLabel()\r\n+        # В компактном режиме иконка должна быть строго по центру по вертикали и горизонтали.\r\n+        self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n+        self.icon_label.setText(\"🎙️\")\r\n+        # Без лишних отступов, только размер шрифта.\r\n+        self.icon_label.setStyleSheet(\"font-size: 16pt;\")\r\n+        self.icon_label.setVisible(False)\r\n+\r\n+        # текст распознанного результата (сырой текст от Whisper)\r\n+        self.raw_label = QLabel(\"\")\r\n+        self.raw_label.setAlignment(Qt.AlignmentFlag.AlignLeft)\r\n+        self.raw_label.setWordWrap(True)\r\n+\r\n+        # текст после постпроцессинга (LLM / regex)\r\n+        self.processed_label = QLabel(\"\")\r\n+        self.processed_label.setAlignment(Qt.AlignmentFlag.AlignLeft)\r\n+        self.processed_label.setWordWrap(True)\r\n+\r\n+        # текст статуса\r\n+        self.status_label = QLabel(\"\")\r\n+        self.status_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n+\r\n+        main_page = QWidget()\r\n+        main_layout = QVBoxLayout(main_page)\r\n+        main_layout.setContentsMargins(6, 6, 6, 6)\r\n+        main_layout.setSpacing(6)\r\n+        main_layout.addLayout(top_layout)\r\n+        # В обычном режиме иконка скрыта, в компактном — она по центру.\r\n+        main_layout.addWidget(self.icon_label, alignment=Qt.AlignmentFlag.AlignCenter)\r\n+\r\n+        # Два текста: сверху — сырой, снизу — после постпроцессинга.\r\n+        main_layout.addWidget(self.raw_label)\r\n+        main_layout.addWidget(self.processed_label)\r\n+        main_layout.addWidget(self.status_label)\r\n+\r\n+        # ---------- панель настроек (режим \"settings\") ----------\r\n+        self.settings_backend_combo = QComboBox()\r\n+        self.settings_backend_combo.addItem(\"Groq\", userData=\"groq\")\r\n+        self.settings_backend_combo.addItem(\"OpenAI\", userData=\"openai\")\r\n+\r\n+        self.settings_groq_key = QLineEdit()\r\n+        self.settings_groq_key.setEchoMode(QLineEdit.EchoMode.Password)\r\n+\r\n+        self.settings_openai_key = QLineEdit()\r\n+        self.settings_openai_key.setEchoMode(QLineEdit.EchoMode.Password)\r\n+\r\n+        self.settings_openai_url = QLineEdit()\r\n+\r\n+        # постпроцессинг\r\n+        self.postprocess_enabled_checkbox = QCheckBox(\"Включить постпроцессинг\")\r\n+        self.postprocess_enabled_checkbox.setChecked(True)\r\n+        # сделать текст чекбокса белым, как у остальных QLabel\r\n+        self.postprocess_enabled_checkbox.setStyleSheet(\"color: white;\")\r\n+\r\n+        self.postprocess_groq_model = QLineEdit()\r\n+        self.postprocess_openai_model = QLineEdit()\r\n+\r\n+        form = QFormLayout()\r\n+        form.addRow(\"Сервис распознавания:\", self.settings_backend_combo)\r\n+        form.addRow(\"Groq API key:\", self.settings_groq_key)\r\n+        form.addRow(\"OpenAI API key:\", self.settings_openai_key)\r\n+        form.addRow(\"OpenAI Base URL:\", self.settings_openai_url)\r\n+        form.addRow(self.postprocess_enabled_checkbox)\r\n+        form.addRow(\"Groq postprocess model:\", self.postprocess_groq_model)\r\n+        form.addRow(\"OpenAI postprocess model:\", self.postprocess_openai_model)\r\n+\r\n+        self.settings_save_button = QPushButton(\"Сохранить\")\r\n+        self.settings_save_button.clicked.connect(self._on_settings_save_clicked)\r\n+\r\n+        self.settings_cancel_button = QPushButton(\"Отмена\")\r\n+        self.settings_cancel_button.clicked.connect(self._on_settings_cancel_clicked)\r\n+\r\n+        buttons_layout = QHBoxLayout()\r\n+        buttons_layout.addStretch()\r\n+        buttons_layout.addWidget(self.settings_save_button)\r\n+        buttons_layout.addWidget(self.settings_cancel_button)\r\n+\r\n+        settings_page = QWidget()\r\n+        settings_layout = QVBoxLayout(settings_page)\r\n+        settings_layout.setContentsMargins(6, 6, 6, 6)\r\n+        settings_layout.setSpacing(6)\r\n+\r\n+        # отдельная верхняя панель для настроек (своими кнопками)\r\n+        self.settings_menu_button = QPushButton(\"⚙️\")\r\n+        self.settings_menu_button.setFixedSize(24, 24)\r\n+        self.settings_menu_button.clicked.connect(self._on_menu_clicked)\r\n+\r\n+        self.settings_compact_button = QPushButton(\"▢\")\r\n+        self.settings_compact_button.setFixedSize(24, 24)\r\n+        self.settings_compact_button.clicked.connect(self._on_compact_clicked)\r\n+\r\n+        self.settings_close_button = QPushButton(\"✖️\")\r\n+        self.settings_close_button.setFixedSize(24, 24)\r\n+        self.settings_close_button.clicked.connect(self._on_close_clicked)\r\n+\r\n+        settings_top_layout = QHBoxLayout()\r\n+        settings_top_layout.setContentsMargins(4, 4, 4, 4)\r\n+        settings_top_layout.setSpacing(4)\r\n+        settings_top_layout.addWidget(self.settings_menu_button)\r\n+        settings_top_layout.addStretch()\r\n+        settings_top_layout.addWidget(self.settings_compact_button)\r\n+        settings_top_layout.addWidget(self.settings_close_button)\r\n+\r\n+        settings_layout.addLayout(settings_top_layout)\r\n+        settings_layout.addLayout(form)\r\n+        settings_layout.addLayout(buttons_layout)\r\n+\r\n+        # ---------- стек страниц ----------\r\n+        self._stack = QStackedLayout()\r\n+        self._stack.addWidget(main_page)      # index 0: main\r\n+        self._stack.addWidget(settings_page)  # index 1: settings\r\n+\r\n+        container = QWidget()\r\n+        container.setLayout(self._stack)\r\n+        container.setObjectName(\"container\")\r\n+\r\n+        root_layout = QVBoxLayout(self)\r\n+        root_layout.setContentsMargins(0, 0, 0, 0)\r\n+        root_layout.addWidget(container)\r\n+\r\n+        self._apply_styles()\r\n+\r\n+    def _apply_styles(self) -> None:\r\n+        self.setStyleSheet(\r\n+            \"\"\"\r\n+            QWidget#container {\r\n+                background-color: rgba(30, 30, 30, 230);\r\n+                border-radius: 10px;\r\n+            }\r\n+            QLabel {\r\n+                color: white;\r\n+                font-size: 10pt;\r\n+            }\r\n+            QPushButton {\r\n+                background: transparent;\r\n+                color: white;\r\n+                border: none;\r\n+                font-size: 11pt;\r\n+            }\r\n+            QPushButton:hover {\r\n+                color: #00bcd4;\r\n+            }\r\n+            \"\"\"\r\n+        )\r\n+\r\n+    def _load_icons(self) -> None:\r\n+        \"\"\"Иконки из файлов больше не используются — всё на эмодзи.\"\"\"\r\n+        # Оставлено на будущее, если понадобится системная иконка окна.\r\n+        return\r\n+\r\n+    def _apply_config(self) -> None:\r\n+        w, h = self._ui_config.window_size\r\n+        self.resize(w, h)\r\n+        self.setWindowOpacity(self._ui_config.opacity)\r\n+        if self._ui_config.always_on_top:\r\n+            self.setWindowFlag(Qt.WindowType.WindowStaysOnTopHint, True)\r\n+\r\n+    # ------------------------------------------------------------------ state / mode\r\n+\r\n+    def set_state(self, state: str) -> None:\r\n+        self._state = state\r\n+\r\n+        # обычный режим: только нижний индикатор\r\n+        if state == \"idle\":\r\n+            self.status_label.setText(\"\")\r\n+        elif state == \"recording\":\r\n+            self.status_label.setText(\"🔴\")\r\n+            self.result_label.setText(\"\")\r\n+        elif state == \"processing\":\r\n+            self.status_label.setText(\"⏳\")\r\n+        elif state == \"ready\":\r\n+            self.status_label.setText(\"✅\")\r\n+            QTimer.singleShot(1000, lambda: self.set_state(\"idle\"))\r\n+        elif state == \"error\":\r\n+            self.status_label.setText(\"⚠️\")\r\n+        else:\r\n+            self.status_label.setText(\"\")\r\n+\r\n+        # компактный режим: одна иконка\r\n+        if self._compact:\r\n+            if state == \"recording\":\r\n+                self.icon_label.setText(\"🔴\")\r\n+            elif state == \"processing\":\r\n+                self.icon_label.setText(\"⏳\")\r\n+            elif state == \"error\":\r\n+                self.icon_label.setText(\"⚠️\")\r\n+            else:\r\n+                self.icon_label.setText(\"🎙️\")\r\n+\r\n+        # применяем текущий режим (compact/normal)\r\n+        self._apply_compact_mode()\r\n+\r\n+    def set_compact(self, compact: bool) -> None:\r\n+        \"\"\"Переключение между большим окном и компактным микрофоном.\"\"\"\r\n+        self._compact = compact\r\n+        self._apply_compact_mode()\r\n+\r\n+    def _apply_compact_mode(self) -> None:\r\n+        \"\"\"\r\n+        Компактный режим.\r\n+\r\n+        Горизонтальная плашка:\r\n+        [   🎙️ / 🔴 / ⏳   ]      [ ▢ ]\r\n+\r\n+        - по центру — иконка микрофона/статуса,\r\n+        - справа — маленькая кнопка разворота.\r\n+        \"\"\"\r\n+        if self._compact:\r\n+            # скрываем текст\r\n+            self.raw_label.setVisible(False)\r\n+            self.processed_label.setVisible(False)\r\n+            self.status_label.setVisible(False)\r\n+\r\n+            # в компактном режиме:\r\n+            # - меню и крестик прячем,\r\n+            # - оставляем только кнопку compact (▢) как точку возврата.\r\n+            self.menu_button.setVisible(False)\r\n+            self.close_button.setVisible(False)\r\n+            self.compact_button.setVisible(True)\r\n+\r\n+            # в шапке настроек тоже прячем всё, кроме compact\r\n+            if hasattr(self, \"settings_menu_button\"):\r\n+                self.settings_menu_button.setVisible(False)\r\n+                self.settings_close_button.setVisible(False)\r\n+                self.settings_compact_button.setVisible(True)\r\n+\r\n+            # включаем иконку\r\n+            self.icon_label.setVisible(True)\r\n+\r\n+            # Компактное окно: невысокая горизонтальная плашка.\r\n+            # Высота подобрана так, чтобы иконка и ▢ были на одной линии и не обрезались.\r\n+            self.setFixedSize(180, 70)\r\n+        else:\r\n+            # обычный режим\r\n+            self.raw_label.setVisible(True)\r\n+            self.processed_label.setVisible(True)\r\n+            self.status_label.setVisible(True)\r\n+\r\n+            self.menu_button.setVisible(True)\r\n+            self.close_button.setVisible(True)\r\n+            self.compact_button.setVisible(True)\r\n+\r\n+            if hasattr(self, \"settings_menu_button\"):\r\n+                self.settings_menu_button.setVisible(True)\r\n+                self.settings_close_button.setVisible(True)\r\n+                self.settings_compact_button.setVisible(True)\r\n+\r\n+            # верхняя иконка в обычном режиме не нужна\r\n+            self.icon_label.setVisible(False)\r\n+\r\n+            w, h = self._ui_config.window_size\r\n+            self.setFixedSize(w, h)\r\n+\r\n+    def show_message(self, text: str, timeout_ms: int = 2000) -> None:\r\n+        self.status_label.setText(text)\r\n+        if timeout_ms > 0:\r\n+            QTimer.singleShot(timeout_ms, lambda: self.set_state(self._state))\r\n+\r\n+    # ------------------------------------------------------------------ text setters\r\n+\r\n+    def set_raw_text(self, text: str) -> None:\r\n+        self.raw_label.setText(text or \"\")\r\n+\r\n+    def set_processed_text(self, text: str) -> None:\r\n+        self.processed_label.setText(text or \"\")\r\n+\r\n+    # ------------------------------------------------------------------ text setters\r\n+\r\n+    def set_raw_text(self, text: str) -> None:\r\n+        \"\"\"Показать сырой текст от Whisper (верхний блок).\"\"\"\r\n+        self.raw_label.setText(text or \"\")\r\n+\r\n+    def set_processed_text(self, text: str) -> None:\r\n+        \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n+        self.processed_label.setText(text or \"\")\r\n+\r\n+    # ------------------------------------------------------------------ text setters\r\n+\r\n+    def set_raw_text(self, text: str) -> None:\r\n+        \"\"\"Показать сырой текст от Whisper (верхний блок).\"\"\"\r\n+        self.raw_label.setText(text or \"\")\r\n+\r\n+    def set_processed_text(self, text: str) -> None:\r\n+        \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n+        self.processed_label.setText(text or \"\")\r\n+\r\n+    # ------------------------------------------------------------------ text setters\r\n+\r\n+    def set_raw_text(self, text: str) -> None:\r\n+        \"\"\"Показать сырой текст от Whisper (верхний блок).\"\"\"\r\n+        self.raw_label.setText(text or \"\")\r\n+\r\n+    def set_processed_text(self, text: str) -> None:\r\n+        \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n+        self.processed_label.setText(text or \"\")\r\n+\r\n+    # ------------------------------------------------------------------ text setters\r\n+\r\n+    def set_raw_text(self, text: str) -> None:\r\n+        \"\"\"Показать сырой текст от Whisper (верхний блок).\"\"\"\r\n+        self.raw_label.setText(text or \"\")\r\n+\r\n+    def set_processed_text(self, text: str) -> None:\r\n+        \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n+        self.processed_label.setText(text or \"\")\r\n+\r\n+    # ------------------------------------------------------------------ settings mode\r\n+\r\n+    def _enter_settings_mode(self) -> None:\r\n+        \"\"\"Показать панель настроек внутри этого же окна.\r\n+\r\n+        ВАЖНО: здесь мы не читаем config.yaml и не трогаем AppSettings.\r\n+        Все реальные значения (backend, ключи, модели) заполняет App.open_settings_dialog().\r\n+        Эта функция только переключает страницу.\r\n+        \"\"\"\r\n+        self._content_mode = \"settings\"\r\n+        self._stack.setCurrentIndex(1)\r\n+\r\n+    def leave_settings_mode(self) -> None:\r\n+        \"\"\"Вернуться в основной режим отображения.\"\"\"\r\n+        self._content_mode = \"main\"\r\n+        self._stack.setCurrentIndex(0)\r\n+\r\n+    def _on_settings_save_clicked(self) -> None:\r\n+        \"\"\"\r\n+        Пользователь нажал «Сохранить» в панели настроек.\r\n+        Отправляем сигнал наверх (в App), чтобы он:\r\n+        - прочитал значения из полей,\r\n+        - сохранил их в config.yaml,\r\n+        - пересоздал recognizer/postprocessor.\r\n+        \"\"\"\r\n+        self.settings_save_requested.emit()\r\n+        self.leave_settings_mode()\r\n+\r\n+    def _on_settings_cancel_clicked(self) -> None:\r\n+        \"\"\"Отмена изменений и возврат в основной режим.\"\"\"\r\n+        self.leave_settings_mode()\r\n+\r\n+    # ------------------------------------------------------------------ events\r\n+\r\n+    def _on_menu_clicked(self) -> None:\r\n+        \"\"\"\r\n+        Клик по иконке ⚙️.\r\n+\r\n+        Поведение:\r\n+        - если сейчас основной режим (main) → открыть настройки (как раньше);\r\n+        - если уже открыта панель настроек → свернуть её, как будто нажали «Отмена».\r\n+        \"\"\"\r\n+        if self._content_mode == \"settings\":\r\n+            # Поведение как у кнопки «Отмена»\r\n+            self._on_settings_cancel_clicked()\r\n+            return\r\n+\r\n+        self.settings_requested.emit()\r\n+\r\n+    def _on_compact_clicked(self) -> None:\r\n+        # Переключить режим окна\r\n+        self.set_compact(not self._compact)\r\n+        self.toggle_compact_requested.emit()\r\n+\r\n+    def _on_close_clicked(self) -> None:\r\n+        # Кнопка закрытия: сигнал наверх (App решает — выйти или скрыть окно)\r\n+        self.exit_requested.emit()\r\n+\r\n+    def mousePressEvent(self, event: QMouseEvent) -> None:\r\n+        if event.button() == Qt.MouseButton.LeftButton:\r\n+            self._drag_position = event.globalPosition().toPoint() - self.frameGeometry().topLeft()\r\n+            event.accept()\r\n+        super().mousePressEvent(event)\r\n+\r\n+    def mouseMoveEvent(self, event: QMouseEvent) -> None:\r\n+        if event.buttons() & Qt.MouseButton.LeftButton and self._drag_position is not None:\r\n+            self.move(event.globalPosition().toPoint() - self._drag_position)\r\n+            event.accept()\r\n+        super().mouseMoveEvent(event)\r\n+\r\n+    def mouseReleaseEvent(self, event: QMouseEvent) -> None:\r\n+        self._drag_position = None\r\n+        super().mouseReleaseEvent(event)\r\n+\r\n+    def mouseDoubleClickEvent(self, event: QMouseEvent) -> None:\r\n+        if event.button() == Qt.MouseButton.LeftButton:\r\n+            # двойной клик по окну — тоже открыть настройки\r\n+            self._enter_settings_mode()\r\n+        super().mouseDoubleClickEvent(event)\n\\ No newline at end of file\n"
                },
                {
                    "date": 1764306874104,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -111,8 +111,11 @@\n         self.processed_label = QLabel(\"\")\r\n         self.processed_label.setAlignment(Qt.AlignmentFlag.AlignLeft)\r\n         self.processed_label.setWordWrap(True)\r\n \r\n+        # для обратной совместимости (старый код использует result_label)\r\n+        self.result_label = self.processed_label\r\n+\r\n         # текст статуса\r\n         self.status_label = QLabel(\"\")\r\n         self.status_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n \r\n"
                },
                {
                    "date": 1764306887683,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -357,53 +357,15 @@\n \r\n     # ------------------------------------------------------------------ text setters\r\n \r\n     def set_raw_text(self, text: str) -> None:\r\n-        self.raw_label.setText(text or \"\")\r\n-\r\n-    def set_processed_text(self, text: str) -> None:\r\n-        self.processed_label.setText(text or \"\")\r\n-\r\n-    # ------------------------------------------------------------------ text setters\r\n-\r\n-    def set_raw_text(self, text: str) -> None:\r\n         \"\"\"Показать сырой текст от Whisper (верхний блок).\"\"\"\r\n         self.raw_label.setText(text or \"\")\r\n \r\n     def set_processed_text(self, text: str) -> None:\r\n         \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n         self.processed_label.setText(text or \"\")\r\n \r\n-    # ------------------------------------------------------------------ text setters\r\n-\r\n-    def set_raw_text(self, text: str) -> None:\r\n-        \"\"\"Показать сырой текст от Whisper (верхний блок).\"\"\"\r\n-        self.raw_label.setText(text or \"\")\r\n-\r\n-    def set_processed_text(self, text: str) -> None:\r\n-        \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n-        self.processed_label.setText(text or \"\")\r\n-\r\n-    # ------------------------------------------------------------------ text setters\r\n-\r\n-    def set_raw_text(self, text: str) -> None:\r\n-        \"\"\"Показать сырой текст от Whisper (верхний блок).\"\"\"\r\n-        self.raw_label.setText(text or \"\")\r\n-\r\n-    def set_processed_text(self, text: str) -> None:\r\n-        \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n-        self.processed_label.setText(text or \"\")\r\n-\r\n-    # ------------------------------------------------------------------ text setters\r\n-\r\n-    def set_raw_text(self, text: str) -> None:\r\n-        \"\"\"Показать сырой текст от Whisper (верхний блок).\"\"\"\r\n-        self.raw_label.setText(text or \"\")\r\n-\r\n-    def set_processed_text(self, text: str) -> None:\r\n-        \"\"\"Показать текст после постпроцессинга (нижний блок).\"\"\"\r\n-        self.processed_label.setText(text or \"\")\r\n-\r\n     # ------------------------------------------------------------------ settings mode\r\n \r\n     def _enter_settings_mode(self) -> None:\r\n         \"\"\"Показать панель настроек внутри этого же окна.\r\n"
                },
                {
                    "date": 1764307028356,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -442,5 +442,5 @@\n     def mouseDoubleClickEvent(self, event: QMouseEvent) -> None:\r\n         if event.button() == Qt.MouseButton.LeftButton:\r\n             # двойной клик по окну — тоже открыть настройки\r\n             self._enter_settings_mode()\r\n-        super().mouseDouble\n\\ No newline at end of file\n+        super().mouseDoubleClickEvent(event)\n\\ No newline at end of file\n"
                },
                {
                    "date": 1764307035481,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -20,8 +20,17 @@\n \r\n from config.settings import UIConfig\r\n \r\n \r\n+class ClickableLabel(QLabel):\r\n+    clicked = pyqtSignal()\r\n+\r\n+    def mousePressEvent(self, event: QMouseEvent) -> None:\r\n+        if event.button() == Qt.MouseButton.LeftButton:\r\n+            self.clicked.emit()\r\n+        super().mousePressEvent(event)\r\n+\r\n+\r\n class FloatingWindow(QWidget):\r\n     \"\"\"\r\n     Главное плавающее окно VoiceCapture.\r\n \r\n"
                }
            ],
            "date": 1764289541744,
            "name": "Commit-0",
            "content": "from __future__ import annotations\r\n\r\nfrom pathlib import Path\r\nfrom typing import Optional\r\n\r\nfrom PyQt6.QtCore import QPoint, Qt, QTimer, pyqtSignal\r\nfrom PyQt6.QtGui import QIcon, QMouseEvent\r\nfrom PyQt6.QtWidgets import QLabel, QHBoxLayout, QVBoxLayout, QWidget, QPushButton\r\n\r\nfrom config.settings import UIConfig\r\n\r\n\r\nclass FloatingWindow(QWidget):\r\n    \"\"\"\r\n    Minimal floating window for MVP.\r\n\r\n    States:\r\n        - idle\r\n        - recording\r\n        - processing\r\n        - ready\r\n        - error\r\n    \"\"\"\r\n\r\n    settings_requested = pyqtSignal()\r\n    exit_requested = pyqtSignal()\r\n\r\n    def __init__(self, ui_config: UIConfig) -> None:\r\n        super().__init__()\r\n\r\n        self._ui_config = ui_config\r\n        self._drag_position: Optional[QPoint] = None\r\n        self._state: str = \"idle\"\r\n\r\n        self._init_window_flags()\r\n        self._init_ui()\r\n        self._apply_config()\r\n\r\n    # ------------------------------------------------------------------ setup\r\n\r\n    def _init_window_flags(self) -> None:\r\n        self.setWindowFlags(\r\n            Qt.WindowType.FramelessWindowHint\r\n            | Qt.WindowType.WindowStaysOnTopHint\r\n            | Qt.WindowType.Tool\r\n        )\r\n        self.setAttribute(Qt.WidgetAttribute.WA_TranslucentBackground, True)\r\n\r\n    def _init_ui(self) -> None:\r\n        self.icon_label = QLabel()\r\n        self.icon_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n\r\n        self.status_label = QLabel(\"\")\r\n        self.status_label.setAlignment(Qt.AlignmentFlag.AlignCenter)\r\n\r\n        self.menu_button = QPushButton(\"≡\")\r\n        self.menu_button.setFixedSize(24, 24)\r\n        self.menu_button.clicked.connect(self._on_menu_clicked)\r\n\r\n        top_layout = QHBoxLayout()\r\n        top_layout.addWidget(self.menu_button)\r\n        top_layout.addStretch()\r\n\r\n        main_layout = QVBoxLayout()\r\n        main_layout.setContentsMargins(6, 6, 6, 6)\r\n        main_layout.addLayout(top_layout)\r\n        main_layout.addWidget(self.icon_label, alignment=Qt.AlignmentFlag.AlignCenter)\r\n        main_layout.addWidget(self.status_label)\r\n\r\n        container = QWidget()\r\n        container.setLayout(main_layout)\r\n        container.setObjectName(\"container\")\r\n\r\n        root_layout = QVBoxLayout(self)\r\n        root_layout.setContentsMargins(0, 0, 0, 0)\r\n        root_layout.addWidget(container)\r\n\r\n        self._apply_styles()\r\n        self.set_state(\"idle\")\r\n\r\n    def _apply_styles(self) -> None:\r\n        self.setStyleSheet(\r\n            \"\"\"\r\n            QWidget#container {\r\n                background-color: rgba(30, 30, 30, 220);\r\n                border-radius: 10px;\r\n            }\r\n            QLabel {\r\n                color: white;\r\n                font-size: 10pt;\r\n            }\r\n            QPushButton {\r\n                background: transparent;\r\n                color: white;\r\n                border: none;\r\n                font-size: 12pt;\r\n            }\r\n            QPushButton:hover {\r\n                color: #00bcd4;\r\n            }\r\n            \"\"\"\r\n        )\r\n\r\n    def _apply_config(self) -> None:\r\n        w, h = self._ui_config.window_size\r\n        self.setFixedSize(w, h)\r\n        self.setWindowOpacity(self._ui_config.opacity)\r\n        if self._ui_config.always_on_top:\r\n            self.setWindowFlag(Qt.WindowType.WindowStaysOnTopHint, True)\r\n\r\n        # Set default icon if exists\r\n        icon_path = Path(\"assets/icons/app_icon.ico\")\r\n        if icon_path.exists():\r\n            self.setWindowIcon(QIcon(str(icon_path)))\r\n\r\n    # ------------------------------------------------------------------ state\r\n\r\n    def set_state(self, state: str) -> None:\r\n        self._state = state\r\n        if state == \"idle\":\r\n            self.status_label.setText(\"Idle\")\r\n        elif state == \"recording\":\r\n            self.status_label.setText(\"Recording...\")\r\n        elif state == \"processing\":\r\n            self.status_label.setText(\"Processing...\")\r\n        elif state == \"ready\":\r\n            self.status_label.setText(\"Done\")\r\n            # auto fade back to idle after short delay\r\n            QTimer.singleShot(1000, lambda: self.set_state(\"idle\"))\r\n        elif state == \"error\":\r\n            self.status_label.setText(\"Error\")\r\n        else:\r\n            self.status_label.setText(state)\r\n\r\n    def show_message(self, text: str, timeout_ms: int = 2000) -> None:\r\n        self.status_label.setText(text)\r\n        if timeout_ms > 0:\r\n            QTimer.singleShot(timeout_ms, lambda: self.set_state(self._state))\r\n\r\n    # ------------------------------------------------------------------ events\r\n\r\n    def _on_menu_clicked(self) -> None:\r\n        # For MVP: simple behavior - open settings on click\r\n        self.settings_requested.emit()\r\n\r\n    def mousePressEvent(self, event: QMouseEvent) -> None:\r\n        if event.button() == Qt.MouseButton.LeftButton:\r\n            self._drag_position = event.globalPosition().toPoint() - self.frameGeometry().topLeft()\r\n            event.accept()\r\n        super().mousePressEvent(event)\r\n\r\n    def mouseMoveEvent(self, event: QMouseEvent) -> None:\r\n        if event.buttons() & Qt.MouseButton.LeftButton and self._drag_position is not None:\r\n            self.move(event.globalPosition().toPoint() - self._drag_position)\r\n            event.accept()\r\n        super().mouseMoveEvent(event)\r\n\r\n    def mouseReleaseEvent(self, event: QMouseEvent) -> None:\r\n        self._drag_position = None\r\n        super().mouseReleaseEvent(event)\r\n\r\n    def mouseDoubleClickEvent(self, event: QMouseEvent) -> None:\r\n        if event.button() == Qt.MouseButton.LeftButton:\r\n            self.settings_requested.emit()\r\n        super().mouseDoubleClickEvent(event)"
        }
    ]
}