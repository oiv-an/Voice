{
    "sourceFile": "src/clipboard/clipboard_manager.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 4,
            "patches": [
                {
                    "date": 1764289629157,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764292747885,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -7,9 +7,9 @@\n \r\n \r\n class ClipboardManager:\r\n     \"\"\"\r\n-    Simple clipboard helper for MVP.\r\n+    Clipboard helper.\r\n \r\n     - copy(text): put text into Windows clipboard\r\n     - paste(): emulate Ctrl+V at current cursor position\r\n     \"\"\"\r\n@@ -18,14 +18,26 @@\n         self._keyboard = Controller()\r\n \r\n     def copy(self, text: str) -> None:\r\n         pyperclip.copy(text)\r\n-        # small delay to ensure clipboard is updated\r\n+        # небольшая пауза, чтобы ОС успела обновить буфер\r\n+        time.sleep(0.15)\r\n+\r\n+    def paste(self) -> None:\r\n+        \"\"\"\r\n+        Эмулирует Ctrl+V в текущем активном окне.\r\n+\r\n+        Важно:\r\n+        - фокус должен быть в текстовом поле целевого приложения;\r\n\\ No newline at end of file\n+        - сам VoiceCapture не должен быть активным окном.\r\n+        \"\"\"\r\n+        # Небольшая пауза перед вставкой\r\n         time.sleep(0.05)\r\n \r\n-    def paste(self) -> None:\r\n-        # emulate Ctrl+V\r\n-        with self._keyboard.pressed(Key.ctrl):\r\n-            self._keyboard.press(\"v\")\r\n-            self._keyboard.release(\"v\")\r\n-        # small delay to let target app process paste\r\n-        time.sleep(0.05)\n+        # Нажимаем и отпускаем Ctrl+V\r\n+        self._keyboard.press(Key.ctrl)\r\n+        self._keyboard.press(\"v\")\r\n+        self._keyboard.release(\"v\")\r\n+        self._keyboard.release(Key.ctrl)\r\n+\r\n+        # Пауза, чтобы целевое приложение обработало вставку\r\n+        time.sleep(0.15)\n\\ No newline at end of file\n"
                },
                {
                    "date": 1764292890917,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -32,12 +32,14 @@\n         \"\"\"\r\n         # Небольшая пауза перед вставкой\r\n         time.sleep(0.05)\r\n \r\n-        # Нажимаем и отпускаем Ctrl+V\r\n-        self._keyboard.press(Key.ctrl)\r\n-        self._keyboard.press(\"v\")\r\n-        self._keyboard.release(\"v\")\r\n-        self._keyboard.release(Key.ctrl)\r\n+        # Попробуем несколько раз на случай, если первое нажатие \"проглотилось\"\r\n+        for _ in range(3):\r\n+            # Нажимаем и отпускаем Ctrl+V\r\n\\ No newline at end of file\n+            self._keyboard.press(Key.ctrl)\r\n+            self._keyboard.press(\"v\")\r\n+            self._keyboard.release(\"v\")\r\n+            self._keyboard.release(Key.ctrl)\r\n \r\n-        # Пауза, чтобы целевое приложение обработало вставку\r\n-        time.sleep(0.15)\n+            # Пауза, чтобы целевое приложение обработало вставку\r\n+            time.sleep(0.1)\n\\ No newline at end of file\n"
                },
                {
                    "date": 1764293662067,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -2,44 +2,35 @@\n \r\n import time\r\n \r\n import pyperclip  # type: ignore[import]\r\n-from pynput.keyboard import Controller, Key  # type: ignore[import]\r\n \r\n \r\n class ClipboardManager:\r\n     \"\"\"\r\n     Clipboard helper.\r\n \r\n     - copy(text): put text into Windows clipboard\r\n-    - paste(): emulate Ctrl+V at current cursor position\r\n+    - paste(): (опционально) можно будет реализовать авто-вставку, сейчас отключено\r\n     \"\"\"\r\n \r\n     def __init__(self) -> None:\r\n-        self._keyboard = Controller()\r\n+        # Раньше здесь создавался pynput.Controller для эмуляции Ctrl+V.\r\n+        # Мы убираем это, чтобы не генерировать лишние нажатия Ctrl.\r\n+        pass\r\n \r\n     def copy(self, text: str) -> None:\r\n+        \"\"\"\r\n+        Кладёт текст в системный буфер обмена.\r\n+        \"\"\"\r\n         pyperclip.copy(text)\r\n         # небольшая пауза, чтобы ОС успела обновить буфер\r\n-        time.sleep(0.15)\r\n+        time.sleep(0.05)\r\n \r\n     def paste(self) -> None:\r\n         \"\"\"\r\n-        Эмулирует Ctrl+V в текущем активном окне.\r\n+        Заглушка: авто-вставка отключена, чтобы не эмулировать Ctrl и\r\n+        не конфликтовать с другими приложениями (двойной Ctrl и т.п.).\r\n \r\n-        Важно:\r\n-        - фокус должен быть в текстовом поле целевого приложения;\r\n-        - сам VoiceCapture не должен быть активным окном.\r\n+        Пользователь может вставить текст вручную через Ctrl+V.\r\n         \"\"\"\r\n-        # Небольшая пауза перед вставкой\r\n-        time.sleep(0.05)\r\n\\ No newline at end of file\n-\r\n-        # Попробуем несколько раз на случай, если первое нажатие \"проглотилось\"\r\n-        for _ in range(3):\r\n-            # Нажимаем и отпускаем Ctrl+V\r\n-            self._keyboard.press(Key.ctrl)\r\n-            self._keyboard.press(\"v\")\r\n-            self._keyboard.release(\"v\")\r\n-            self._keyboard.release(Key.ctrl)\r\n-\r\n-            # Пауза, чтобы целевое приложение обработало вставку\r\n-            time.sleep(0.1)\n+        return\n\\ No newline at end of file\n"
                },
                {
                    "date": 1764301601169,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -0,0 +1,68 @@\n+from __future__ import annotations\r\n+\r\n+import time\r\n+from typing import Optional\r\n+\r\n+import pyperclip  # type: ignore[import]\r\n+from loguru import logger  # type: ignore[import]\r\n+\r\n+try:\r\n+    # Используем keyboard для эмуляции Ctrl+V, чтобы не тащить ещё один контроллер.\r\n+    import keyboard  # type: ignore[import]\r\n+except Exception:  # noqa: BLE001\r\n+    keyboard = None  # type: ignore[assignment]\r\n+\r\n+\r\n+class ClipboardManager:\r\n+    \"\"\"\r\n+    Clipboard helper.\r\n+\r\n+    - copy(text): put text into Windows clipboard\r\n+    - paste(): авто-вставка через Ctrl+V с простыми ретраями и логированием ошибок.\r\n+    \"\"\"\r\n+\r\n+    def __init__(self, max_paste_retries: int = 3, paste_retry_delay: float = 0.15) -> None:\r\n+        \"\"\"\r\n+        :param max_paste_retries: сколько раз пробовать эмулировать Ctrl+V\r\n+        :param paste_retry_delay: задержка между попытками (секунды)\r\n+        \"\"\"\r\n+        self._max_paste_retries = max_paste_retries\r\n+        self._paste_retry_delay = paste_retry_delay\r\n+\r\n+    def copy(self, text: str) -> None:\r\n+        \"\"\"\r\n+        Кладёт текст в системный буфер обмена.\r\n+        \"\"\"\r\n+        try:\r\n+            pyperclip.copy(text)\r\n+        except Exception as exc:  # noqa: BLE001\r\n+            logger.exception(\"Clipboard copy failed: {}\", exc)\r\n+            return\r\n+\r\n+        # небольшая пауза, чтобы ОС успела обновить буфер\r\n+        time.sleep(0.05)\r\n+\r\n+    def paste(self) -> None:\r\n+        \"\"\"\r\n+        Авто-вставка текста через эмуляцию Ctrl+V.\r\n+\r\n+        Реализация максимально простая:\r\n+        - если библиотека keyboard недоступна — просто выходим (пользователь вставит вручную),\r\n+        - иначе несколько раз пробуем отправить Ctrl+V с небольшими паузами.\r\n+        \"\"\"\r\n+        if keyboard is None:\r\n+            logger.warning(\"keyboard library is not available; auto-paste is disabled.\")\r\n+            return\r\n+\r\n+        for attempt in range(1, self._max_paste_retries + 1):\r\n+            try:\r\n+                logger.debug(\"Auto-paste attempt {} / {}\", attempt, self._max_paste_retries)\r\n+                keyboard.send(\"ctrl+v\")\r\n+                # даём целевому приложению время обработать вставку\r\n+                time.sleep(self._paste_retry_delay)\r\n+                # На этом этапе мы не можем надёжно проверить, что текст действительно вставился\r\n+                # во внешнее приложение, поэтому просто выходим после успешной отправки.\r\n+                return\r\n+            except Exception as exc:  # noqa: BLE001\r\n+                logger.exception(\"Auto-paste attempt {} failed: {}\", attempt, exc)\r\n+                time.sleep(self._paste_retry_delay)\n\\ No newline at end of file\n"
                }
            ],
            "date": 1764289629157,
            "name": "Commit-0",
            "content": "from __future__ import annotations\r\n\r\nimport time\r\n\r\nimport pyperclip  # type: ignore[import]\r\nfrom pynput.keyboard import Controller, Key  # type: ignore[import]\r\n\r\n\r\nclass ClipboardManager:\r\n    \"\"\"\r\n    Simple clipboard helper for MVP.\r\n\r\n    - copy(text): put text into Windows clipboard\r\n    - paste(): emulate Ctrl+V at current cursor position\r\n    \"\"\"\r\n\r\n    def __init__(self) -> None:\r\n        self._keyboard = Controller()\r\n\r\n    def copy(self, text: str) -> None:\r\n        pyperclip.copy(text)\r\n        # small delay to ensure clipboard is updated\r\n        time.sleep(0.05)\r\n\r\n    def paste(self) -> None:\r\n        # emulate Ctrl+V\r\n        with self._keyboard.pressed(Key.ctrl):\r\n            self._keyboard.press(\"v\")\r\n            self._keyboard.release(\"v\")\r\n        # small delay to let target app process paste\r\n        time.sleep(0.05)"
        }
    ]
}