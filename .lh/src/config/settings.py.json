{
    "sourceFile": "src/config/settings.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 7,
            "patches": [
                {
                    "date": 1764289495266,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1764290068358,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -53,8 +53,9 @@\n class OpenAIRecognitionConfig:\r\n     api_key: str = \"sk-...\"\r\n     model: str = \"whisper-1\"\r\n     language: str = \"ru\"\r\n+    base_url: str = \"https://api.openai.com/v1\"  # кастомный/дефолтный URL\r\n \r\n \r\n @dataclass\r\n class GroqRecognitionConfig:\r\n@@ -80,8 +81,9 @@\n @dataclass\r\n class OpenAIPostprocessConfig:\r\n     api_key: str = \"sk-...\"\r\n     model: str = \"gpt-4\"\r\n+    base_url: str = \"https://api.openai.com/v1\"  # кастомный/дефолтный URL\r\n \r\n \r\n @dataclass\r\n class PostprocessConfig:\r\n"
                },
                {
                    "date": 1764291361887,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -189,5 +189,9 @@\n         return cls(\r\n             app=app_cfg,\r\n             hotkeys=hotkeys_cfg,\r\n             audio=audio_cfg,\r\n-            recognition=recognition_cfg,\r\n\\ No newline at end of file\n+            recognition=recognition_cfg,\r\n+            postprocess=postprocess_cfg,\r\n+            ui=ui_cfg,\r\n+            logging=logging_cfg,\r\n+        )\n\\ No newline at end of file\n"
                },
                {
                    "date": 1764291390441,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,7 +1,7 @@\n from __future__ import annotations\r\n \r\n-from dataclasses import dataclass\r\n+from dataclasses import dataclass, field\r\n from pathlib import Path\r\n from typing import Any, Dict\r\n \r\n import yaml\r\n@@ -91,10 +91,10 @@\n class PostprocessConfig:\r\n     enabled: bool = True\r\n     mode: str = \"llm\"  # simple, llm\r\n     llm_backend: str = \"groq\"  # groq, openai\r\n-    groq: GroqPostprocessConfig = GroqPostprocessConfig()\r\n-    openai: OpenAIPostprocessConfig = OpenAIPostprocessConfig()\r\n+    groq: GroqPostprocessConfig = field(default_factory=GroqPostprocessConfig)\r\n+    openai: OpenAIPostprocessConfig = field(default_factory=OpenAIPostprocessConfig)\r\n \r\n \r\n @dataclass\r\n class UIConfig:\r\n"
                },
                {
                    "date": 1764300509520,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -193,5 +193,39 @@\n             recognition=recognition_cfg,\r\n             postprocess=postprocess_cfg,\r\n             ui=ui_cfg,\r\n             logging=logging_cfg,\r\n-        )\n\\ No newline at end of file\n+        )\r\n+\r\n+    # ------------------------------------------------------------------ save\r\n+\r\n+    @classmethod\r\n+    def save_default(cls, settings: \"AppSettings\") -> None:\r\n+        \"\"\"\r\n+        Save current settings back to src/config/config.yaml.\r\n+        \"\"\"\r\n+        base_dir = Path(__file__).resolve().parents[2]\r\n+        config_path = base_dir / \"src\" / \"config\" / \"config.yaml\"\r\n+\r\n+        data: Dict[str, Any] = {\r\n+            \"app\": settings.app.__dict__,\r\n+            \"hotkeys\": settings.hotkeys.__dict__,\r\n+            \"audio\": settings.audio.__dict__,\r\n+            \"recognition\": {\r\n+                \"backend\": settings.recognition.backend,\r\n+                \"local\": settings.recognition.local.__dict__,\r\n+                \"openai\": settings.recognition.openai.__dict__,\r\n+                \"groq\": settings.recognition.groq.__dict__,\r\n+            },\r\n+            \"postprocess\": {\r\n+                \"enabled\": settings.postprocess.enabled,\r\n+                \"mode\": settings.postprocess.mode,\r\n+                \"llm_backend\": settings.postprocess.llm_backend,\r\n+                \"groq\": settings.postprocess.groq.__dict__,\r\n+                \"openai\": settings.postprocess.openai.__dict__,\r\n+            },\r\n+            \"ui\": settings.ui.__dict__,\r\n+            \"logging\": settings.logging.__dict__,\r\n+        }\r\n+\r\n+        with config_path.open(\"w\", encoding=\"utf-8\") as f:\r\n+            yaml.safe_dump(data, f, allow_unicode=True, sort_keys=False)\n\\ No newline at end of file\n"
                },
                {
                    "date": 1764304349499,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -63,19 +63,22 @@\n     model: str = \"whisper-large-v3\"\r\n     language: str = \"ru\"\r\n \r\n \r\n+from dataclasses import dataclass, field\r\n+...\r\n @dataclass\r\n class RecognitionConfig:\r\n     backend: str = \"local\"  # local, openai, groq\r\n-    local: LocalRecognitionConfig = LocalRecognitionConfig()\r\n-    openai: OpenAIRecognitionConfig = OpenAIRecognitionConfig()\r\n-    groq: GroqRecognitionConfig = GroqRecognitionConfig()\r\n+    local: LocalRecognitionConfig = field(default_factory=LocalRecognitionConfig)\r\n+    openai: OpenAIRecognitionConfig = field(default_factory=OpenAIRecognitionConfig)\r\n+    groq: GroqRecognitionConfig = field(default_factory=GroqRecognitionConfig)\r\n \r\n \r\n @dataclass\r\n class GroqPostprocessConfig:\r\n-    api_key: str = \"gsk-...\"\r\n+    # Ключ для Groq LLM больше не хранится отдельно.\r\n+    # Используется тот же ключ, что и для распознавания: recognition.groq.api_key.\r\n     model: str = \"mixtral-8x7b-32768\"\r\n \r\n \r\n @dataclass\r\n@@ -217,17 +220,14 @@\n             \"postprocess\": {\r\n                 \"enabled\": settings.postprocess.enabled,\r\n                 \"mode\": settings.postprocess.mode,\r\n                 \"llm_backend\": settings.postprocess.llm_backend,\r\n-                \"groq\": settings.postprocess.groq.__dict__,\r\n+                # В groq больше нет api_key — используем только модель.\r\n+                \"groq\": {\"model\": settings.postprocess.groq.model},\r\n                 \"openai\": settings.postprocess.openai.__dict__,\r\n             },\r\n             \"ui\": settings.ui.__dict__,\r\n             \"logging\": settings.logging.__dict__,\r\n         }\r\n \r\n         with config_path.open(\"w\", encoding=\"utf-8\") as f:\r\n-            yaml.safe_dump(data, f, allow_unicode=True, sort_keys=False)\n-            postprocess=postprocess_cfg,\r\n-            ui=ui_cfg,\r\n\\ No newline at end of file\n-            logging=logging_cfg,\r\n-        )\n+            yaml.safe_dump(data, f, allow_unicode=True, sort_keys=False)\n\\ No newline at end of file\n"
                },
                {
                    "date": 1764304914932,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -171,8 +171,14 @@\n \r\n         post_raw = get_section(\"postprocess\", {})\r\n         groq_post_raw = post_raw.get(\"groq\", {}) or {}\r\n         openai_post_raw = post_raw.get(\"openai\", {}) or {}\r\n+\r\n+        # GroqPostprocessConfig больше не имеет поля api_key, поэтому\r\n+        # при мердже отбрасываем лишние ключи (если они остались в старом config.yaml).\r\n+        if \"api_key\" in groq_post_raw:\r\n+            groq_post_raw = {k: v for k, v in groq_post_raw.items() if k != \"api_key\"}\r\n+\r\n         postprocess_cfg = PostprocessConfig(\r\n             enabled=post_raw.get(\"enabled\", True),\r\n             mode=post_raw.get(\"mode\", \"llm\"),\r\n             llm_backend=post_raw.get(\"llm_backend\", \"groq\"),\r\n"
                },
                {
                    "date": 1764305420110,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -52,16 +52,20 @@\n @dataclass\r\n class OpenAIRecognitionConfig:\r\n     api_key: str = \"sk-...\"\r\n     model: str = \"whisper-1\"\r\n+    # Модель для постобработки текста (LLM), чтобы не плодить отдельные блоки.\r\n+    model_process: str = \"gpt-4\"\r\n     language: str = \"ru\"\r\n     base_url: str = \"https://api.openai.com/v1\"  # кастомный/дефолтный URL\r\n \r\n \r\n @dataclass\r\n class GroqRecognitionConfig:\r\n     api_key: str = \"gsk-...\"\r\n     model: str = \"whisper-large-v3\"\r\n+    # Модель для постобработки текста (LLM) — одно поле рядом с моделью распознавания.\r\n+    model_process: str = \"mixtral-8x7b-32768\"\r\n     language: str = \"ru\"\r\n \r\n \r\n from dataclasses import dataclass, field\r\n@@ -73,18 +77,17 @@\n     openai: OpenAIRecognitionConfig = field(default_factory=OpenAIRecognitionConfig)\r\n     groq: GroqRecognitionConfig = field(default_factory=GroqRecognitionConfig)\r\n \r\n \r\n+# Блоки постпроцессинга больше не хранят свои ключи — только для обратной\r\n+# совместимости структуры. Модели LLM берём из recognition.*.model_process.\r\n @dataclass\r\n class GroqPostprocessConfig:\r\n-    # Ключ для Groq LLM больше не хранится отдельно.\r\n-    # Используется тот же ключ, что и для распознавания: recognition.groq.api_key.\r\n     model: str = \"mixtral-8x7b-32768\"\r\n \r\n \r\n @dataclass\r\n class OpenAIPostprocessConfig:\r\n-    api_key: str = \"sk-...\"\r\n     model: str = \"gpt-4\"\r\n     base_url: str = \"https://api.openai.com/v1\"  # кастомный/дефолтный URL\r\n \r\n \r\n@@ -172,12 +175,15 @@\n         post_raw = get_section(\"postprocess\", {})\r\n         groq_post_raw = post_raw.get(\"groq\", {}) or {}\r\n         openai_post_raw = post_raw.get(\"openai\", {}) or {}\r\n \r\n-        # GroqPostprocessConfig больше не имеет поля api_key, поэтому\r\n-        # при мердже отбрасываем лишние ключи (если они остались в старом config.yaml).\r\n-        if \"api_key\" in groq_post_raw:\r\n-            groq_post_raw = {k: v for k, v in groq_post_raw.items() if k != \"api_key\"}\r\n+        # Старые поля api_key/model в postprocess.* игнорируем — ключи и модели\r\n+        # живут в recognition.*.api_key / recognition.*.model_process.\r\n+        for k in (\"api_key\",):\r\n+            if k in groq_post_raw:\r\n+                groq_post_raw.pop(k, None)\r\n+            if k in openai_post_raw:\r\n+                openai_post_raw.pop(k, None)\r\n \r\n         postprocess_cfg = PostprocessConfig(\r\n             enabled=post_raw.get(\"enabled\", True),\r\n             mode=post_raw.get(\"mode\", \"llm\"),\r\n@@ -226,11 +232,14 @@\n             \"postprocess\": {\r\n                 \"enabled\": settings.postprocess.enabled,\r\n                 \"mode\": settings.postprocess.mode,\r\n                 \"llm_backend\": settings.postprocess.llm_backend,\r\n-                # В groq больше нет api_key — используем только модель.\r\n+                # В groq/openai больше нет своих api_key — только модель и base_url.\r\n                 \"groq\": {\"model\": settings.postprocess.groq.model},\r\n-                \"openai\": settings.postprocess.openai.__dict__,\r\n+                \"openai\": {\r\n+                    \"model\": settings.postprocess.openai.model,\r\n+                    \"base_url\": settings.postprocess.openai.base_url,\r\n+                },\r\n             },\r\n             \"ui\": settings.ui.__dict__,\r\n             \"logging\": settings.logging.__dict__,\r\n         }\r\n"
                }
            ],
            "date": 1764289495266,
            "name": "Commit-0",
            "content": "from __future__ import annotations\r\n\r\nfrom dataclasses import dataclass\r\nfrom pathlib import Path\r\nfrom typing import Any, Dict\r\n\r\nimport yaml\r\n\r\n\r\n# ---------------------------------------------------------------------------#\r\n# Dataclasses for structured settings\r\n# ---------------------------------------------------------------------------#\r\n\r\n\r\n@dataclass\r\nclass AppInfoConfig:\r\n    name: str = \"VoiceCapture\"\r\n    version: str = \"1.0.0\"\r\n    language: str = \"ru\"\r\n    debug: bool = False\r\n\r\n\r\n@dataclass\r\nclass HotkeysConfig:\r\n    record: str = \"ctrl+win\"\r\n    cancel: str = \"esc\"\r\n    toggle_window: str = \"ctrl+alt+s\"\r\n    toggle_debug: str = \"ctrl+alt+d\"\r\n\r\n\r\n@dataclass\r\nclass AudioConfig:\r\n    device: str | int = \"default\"\r\n    sample_rate: int = 16000\r\n    channels: int = 1\r\n    format: str = \"float32\"\r\n    max_duration: int = 60\r\n    vad_threshold: float = 0.5\r\n    vad_min_duration: float = 0.1\r\n\r\n\r\n@dataclass\r\nclass LocalRecognitionConfig:\r\n    model: str = \"large-v3\"\r\n    device: str = \"cuda\"\r\n    compute_type: str = \"float16\"\r\n    language: str = \"ru\"\r\n    beam_size: int = 5\r\n    temperature: float = 0.0\r\n\r\n\r\n@dataclass\r\nclass OpenAIRecognitionConfig:\r\n    api_key: str = \"sk-...\"\r\n    model: str = \"whisper-1\"\r\n    language: str = \"ru\"\r\n\r\n\r\n@dataclass\r\nclass GroqRecognitionConfig:\r\n    api_key: str = \"gsk-...\"\r\n    model: str = \"whisper-large-v3\"\r\n    language: str = \"ru\"\r\n\r\n\r\n@dataclass\r\nclass RecognitionConfig:\r\n    backend: str = \"local\"  # local, openai, groq\r\n    local: LocalRecognitionConfig = LocalRecognitionConfig()\r\n    openai: OpenAIRecognitionConfig = OpenAIRecognitionConfig()\r\n    groq: GroqRecognitionConfig = GroqRecognitionConfig()\r\n\r\n\r\n@dataclass\r\nclass GroqPostprocessConfig:\r\n    api_key: str = \"gsk-...\"\r\n    model: str = \"mixtral-8x7b-32768\"\r\n\r\n\r\n@dataclass\r\nclass OpenAIPostprocessConfig:\r\n    api_key: str = \"sk-...\"\r\n    model: str = \"gpt-4\"\r\n\r\n\r\n@dataclass\r\nclass PostprocessConfig:\r\n    enabled: bool = True\r\n    mode: str = \"llm\"  # simple, llm\r\n    llm_backend: str = \"groq\"  # groq, openai\r\n    groq: GroqPostprocessConfig = GroqPostprocessConfig()\r\n    openai: OpenAIPostprocessConfig = OpenAIPostprocessConfig()\r\n\r\n\r\n@dataclass\r\nclass UIConfig:\r\n    always_on_top: bool = True\r\n    opacity: float = 0.8\r\n    window_size: tuple[int, int] = (120, 120)\r\n    auto_hide_after_paste: bool = True\r\n    hide_delay: int = 2000  # ms\r\n\r\n\r\n@dataclass\r\nclass LoggingConfig:\r\n    level: str = \"INFO\"\r\n    file: str = \"app.log\"\r\n    max_file_size: int = 10 * 1024 * 1024\r\n    backup_count: int = 3\r\n\r\n\r\n@dataclass\r\nclass AppSettings:\r\n    app: AppInfoConfig\r\n    hotkeys: HotkeysConfig\r\n    audio: AudioConfig\r\n    recognition: RecognitionConfig\r\n    postprocess: PostprocessConfig\r\n    ui: UIConfig\r\n    logging: LoggingConfig\r\n\r\n    # ------------------------------------------------------------------ factory\r\n\r\n    @classmethod\r\n    def load_default(cls) -> \"AppSettings\":\r\n        \"\"\"\r\n        Load settings from config/config.yaml if exists, otherwise use defaults.\r\n        \"\"\"\r\n        base_dir = Path(__file__).resolve().parents[2]\r\n        config_path = base_dir / \"src\" / \"config\" / \"config.yaml\"\r\n\r\n        if not config_path.exists():\r\n            # Pure defaults\r\n            return cls(\r\n                app=AppInfoConfig(),\r\n                hotkeys=HotkeysConfig(),\r\n                audio=AudioConfig(),\r\n                recognition=RecognitionConfig(),\r\n                postprocess=PostprocessConfig(),\r\n                ui=UIConfig(),\r\n                logging=LoggingConfig(),\r\n            )\r\n\r\n        with config_path.open(\"r\", encoding=\"utf-8\") as f:\r\n            raw: Dict[str, Any] = yaml.safe_load(f) or {}\r\n\r\n        def get_section(name: str, default: Dict[str, Any]) -> Dict[str, Any]:\r\n            return raw.get(name, {}) or default\r\n\r\n        app_cfg = AppInfoConfig(**get_section(\"app\", AppInfoConfig().__dict__))\r\n        hotkeys_cfg = HotkeysConfig(**get_section(\"hotkeys\", HotkeysConfig().__dict__))\r\n        audio_cfg = AudioConfig(**get_section(\"audio\", AudioConfig().__dict__))\r\n\r\n        rec_raw = get_section(\"recognition\", {})\r\n        local_raw = rec_raw.get(\"local\", {}) or {}\r\n        openai_raw = rec_raw.get(\"openai\", {}) or {}\r\n        groq_raw = rec_raw.get(\"groq\", {}) or {}\r\n        recognition_cfg = RecognitionConfig(\r\n            backend=rec_raw.get(\"backend\", \"local\"),\r\n            local=LocalRecognitionConfig(**{**LocalRecognitionConfig().__dict__, **local_raw}),\r\n            openai=OpenAIRecognitionConfig(\r\n                **{**OpenAIRecognitionConfig().__dict__, **openai_raw}\r\n            ),\r\n            groq=GroqRecognitionConfig(**{**GroqRecognitionConfig().__dict__, **groq_raw}),\r\n        )\r\n\r\n        post_raw = get_section(\"postprocess\", {})\r\n        groq_post_raw = post_raw.get(\"groq\", {}) or {}\r\n        openai_post_raw = post_raw.get(\"openai\", {}) or {}\r\n        postprocess_cfg = PostprocessConfig(\r\n            enabled=post_raw.get(\"enabled\", True),\r\n            mode=post_raw.get(\"mode\", \"llm\"),\r\n            llm_backend=post_raw.get(\"llm_backend\", \"groq\"),\r\n            groq=GroqPostprocessConfig(\r\n                **{**GroqPostprocessConfig().__dict__, **groq_post_raw}\r\n            ),\r\n            openai=OpenAIPostprocessConfig(\r\n                **{**OpenAIPostprocessConfig().__dict__, **openai_post_raw}\r\n            ),\r\n        )\r\n\r\n        ui_cfg = UIConfig(**get_section(\"ui\", UIConfig().__dict__))\r\n        logging_cfg = LoggingConfig(**get_section(\"logging\", LoggingConfig().__dict__))\r\n\r\n        return cls(\r\n            app=app_cfg,\r\n            hotkeys=hotkeys_cfg,\r\n            audio=audio_cfg,\r\n            recognition=recognition_cfg,\r\n            postprocess=postprocess_cfg,\r\n            ui=ui_cfg,\r\n            logging=logging_cfg,\r\n        )"
        }
    ]
}